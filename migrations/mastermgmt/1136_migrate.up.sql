-- init config_key default value for chat thread launching phase 2
INSERT INTO public.configuration_key
(value_type, default_value, configuration_type, created_at, updated_at, config_key)
VALUES
('boolean', 'false', 'CONFIGURATION_TYPE_LOCATION_EXTERNAL', NOW(), NOW(), 'communication.chat.enable_student_chat_v2'),
('boolean', 'false', 'CONFIGURATION_TYPE_LOCATION_EXTERNAL', NOW(), NOW(), 'communication.chat.enable_parent_chat_v2')
ON CONFLICT DO NOTHING;

-- ENABLE config for all locations for each tenant
INSERT INTO public.location_configuration_value_v2 (location_config_id, config_key, location_id, config_value_type, config_value, created_at, updated_at, resource_path)
SELECT uuid_generate_v4() AS uuid_generate_v4, 'communication.chat.enable_student_chat_v2', l.location_id, 'boolean', 'true', now(), now(), l.resource_path 
FROM (
	SELECT l.location_id , l.resource_path
    FROM locations l
        JOIN locations l1 ON l1.access_path ~ l.access_path AND l.resource_path = l1.resource_path
    WHERE l.deleted_at IS NULL
        AND l1.deleted_at IS NULL
    GROUP BY l.location_id , l.resource_path
) l;

INSERT INTO public.location_configuration_value_v2 (location_config_id, config_key, location_id, config_value_type, config_value, created_at, updated_at, resource_path)
SELECT uuid_generate_v4() AS uuid_generate_v4, 'communication.chat.enable_parent_chat_v2', l.location_id, 'boolean', 'true', now(), now(), l.resource_path 
FROM (
	SELECT l.location_id , l.resource_path
    FROM locations l
        JOIN locations l1 ON l1.access_path ~ l.access_path AND l.resource_path = l1.resource_path
    WHERE l.deleted_at IS NULL
        AND l1.deleted_at IS NULL
    GROUP BY l.location_id , l.resource_path
) l;

-- manually DISABLE location config for specific targets
-- Synersia disable for Parent chat
UPDATE public.location_configuration_value_v2 SET config_value = 'false' WHERE config_key = 'communication.chat.enable_parent_chat_v2' AND resource_path = '-2147483646';

-- JPREP disable for Student and Parent chat
UPDATE public.location_configuration_value_v2 SET config_value = 'false'
WHERE config_key = ANY(ARRAY['communication.chat.enable_student_chat_v2', 'communication.chat.enable_parent_chat_v2']) AND resource_path = '-2147483647';

-- Renseikai disable Student and Parent chat for the following locations
UPDATE public.location_configuration_value_v2 SET config_value = 'false'
WHERE config_key = ANY(ARRAY['communication.chat.enable_student_chat_v2', 'communication.chat.enable_parent_chat_v2'])
AND resource_path = '-2147483645'
AND location_id = ANY(ARRAY['01GW3TFRWD9CBEWF713M9JJYYC','01GW3TFRWQV69S6A5C773MQPB6','01GW3TFRX1QBZEQBCT37QQ2SZS','01GW3TFRZAQWXQ7VXCH9Q5VFKX','01GW3TFRZJFYNTYFFK4FMXFZV9','01GW3TFRZV586NKX4YPCK4077F','01GW3TFS03ZM4GF2TDC5NE8PQ5','01GW3TFS0MW2FJMNC2CNJNVG9J','01GRX3P8B14D9JXBMTDQ041NP8','01GW3TFS3Q08NATBWY01BJ15DH','01GW3TFS3ZZPKWG2178A62FVTK','01GW3TFSD7YA7KFH5G3T5JFRR9','01GW3TFSDFRAC39BV3CNP0E2M3','01GW3TFSDRXF6RRM79ABDHPX9Z','01GW3TFSE1DXNFMBBZSSZZQKBR','01GW3TFSE93DEYQ06YS34RHKHK','01GW3TFS494KBQP2DXYKNC5M1T','01GW3TFS4J37VR2Q6SQ5VTW2RP','01GW3TFS4TYX05N5PTD93GV79Q','01GW3TFS54WQWQ172PJ1RQ4QFP','01GW3TFS5D0QCKSY03ANBTS15G','01GW3TFS5QB2NWWP25KG9PK181','01GW3TFS64PW3YYBR2GV94DMT9','01GW3TFS6KT2QTPNFRN1GM7BGG','01GW3TFS6XYP3H7BHV4WYJEP0B','01GW3TFS76D911KE22CGK1X0FD','01GW3TFS8CC26ES4VYW1NE1MX3','01GW3TFS8P95SFXJYAGP2PDC92','01GW3TFS8ZFF1N0G0NX2X5AF8C','01GRX3P8BNXNZ92MFSE7PJX58T','01GRX3P8C007KRBY68WNYS3H12','01GW3TFSBKETWZXHR6GX96WYM7','01GW3TFSBVPEDJKW88DFG105EA','01GW3TFSC33NFSDKYZQG32ZP84','01GW3TFSCCVPMW3KZ76HRJAHWD','01FXH4EKPACQXTEK2KTDZHGNRV','01FXH4EKQWX5Z2DAQ3ZB4X6K3S','01FXH4EKR8QAVRJCY06FCBTGYA','01FXH4EKSNVXW168HGNCGH17ZE','01GW3TFRRJ27GXTGWV66QGNTPT','01GRX3P896DZJ07F80VXK56JFF','01GW3TFRSEQR3GK6NT772VR3JM','01GW3TFRT7QA6QFR1FRQ4H94PN','01GW3TFRTR6Z21ZYPB5PDXY63M','01GW3TFRVWSVY3HQ2M3Y3QQAGA','01GW3TFRW59KZPF5MGG0HCGFHZ','01GW3TFRXBFAY656WXJAAKK1CG','01GW3TFRXN42VC53TATMV51WZG','01GW3TFRXY52FXERES5N7RY4VN','01GRX3P89JTPC4RKNPP8V592CM','01GW3TFRYG5PP24151700YP3HN','01GRX3P89XF0WRYQ216M1KJ60B','01GW3TFRYRHZ62QKBB2CVH94CZ','01FXH4EKQFVXYCXQE583CVQP58','01GW3TFRV1MG4MPY16JPB203ZB','01GW3TFRVAXAECH015PCDTQSG6','01GW3TFS0CT1Q0CFSGRR20V0G1','01GW3TFS0WN25QYVYZ9VDHMEE1','01GW3TFS2MB8EKN1MHH44NTFMB','01GW3TFS33MJABCGBBW9DWEN3G','01GW3TFS3E3N5GFS0MK1RW7Q7H','01FXH4EKQ4Z3X6J8XMGJRHRF5N','01FXH4EKRMZBH6A1VSSSBXZZ0V','01FXH4EKS0B84XAF7NNXXEA0HS','01FXH4EKSAPT92MP3C32K05VR3','01GW3TFRVKPMH90TFX9HVKDX91','01GW3TFSCNC6YHAFAVYXYERQM1','01GW3TFSCYVHMSPXGXXWGA2NPB','01GRX3P8CAYTHBRKNZBAP0C43B','01GW3TFSEKT5YTZ0MDAZRPEM61','01GW3TFSEWVGD0HEYYGY1Q8M4D','01GW3TFS83ZMGBSSHT954X4WDA','01GW3TFS7FFADVHZSZHZZ116JX','01GW3TFS7SSW1ZEK9Q858RDNQK','01GRX3P8BB464DESX8JK14Z1FX','01FXH4EKPQ0NNHMGKJ51TBYNWZ','01FXH4EKT0M8F0KB7S5TFT4KBX','01GW3TFS164EH2KF7JA5513SN1','01GW3TFS1FG45078YD2VMRHR3K','01GW3TFS2ADEVPE34985FEN9EZ','01GRX3P889JYR96YME3S70QZ1V','01GW3TFS98CEPXPWPJHKPHZVEV','01GW3TFS9HC47RF4BST3NKQTKA','01GW3TFS9TBY4J1EYAC86ZX625','01GW3TFSA2D7Z5BG3TX9XKH8QP','01GW3TFSAB9QWGX6QB9PDSNJD7','01GW3TFSAMP63HW01R1SV0ME8X','01GW3TFSAYHPHG8MAA8EP05J2E','01GW3TFSBAFFJ58E805K07649M']);

-- Eishinkan disable Student and Parent chat for the following locations
UPDATE public.location_configuration_value_v2 SET config_value = 'false'
WHERE config_key = ANY(ARRAY['communication.chat.enable_student_chat_v2', 'communication.chat.enable_parent_chat_v2'])
AND resource_path = '-2147483631'
AND location_id = ANY(ARRAY['01H25WC4NKTJ30DC2GS51E507Z','01H25WC4NY02TMJCFE7E4Z9N0D','01H25WC4PJ5W76C15H9Z5100YH','01H25WC4Q2DRFCBDCZB2KH8092','01H25WC4QNBTFE5TZHMQJYR5JB','01H25WC4RDYWZZQW2VF3DST604','01H3GTBCJKCY8KDP1166RHRH6V']);