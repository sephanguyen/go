[
    {
        "filename": "accesscontrol/auth/master.location.yaml",
        "service": "auth",
        "revision": 1,
        "table_name": "locations",
        "created_at": "2023-05-29T15:58:52.08638443+07:00",
        "updated_at": "2023-05-29T15:58:52.086384482+07:00",
        "stages": [
            {
                "template": "1",
                "hasura": null,
                "postgres": null,
                "accessPathTable": null,
                "locationCol": null,
                "permissionPrefix": null,
                "permissions": null,
                "ownerCol": null,
                "use_custom_policy": true,
                "hasura_policies": null,
                "postgres_policies": [
                    {
                        "name": "rls_locations_location",
                        "using": "location_id in (\n  select\t\t\t\n    p.location_id\n  from\n          granted_permissions p\n  where\n    p.user_id = current_setting('app.user_id')\n    and p.permission_id = (\n      select\n        p2.permission_id\n      from\n        \"permission\" p2\n      where\n        p2.permission_name = 'master.location.read'\n        and p2.resource_path = current_setting('permission.resource_path'))\n  )\n",
                        "with_check": "exists (\n  select\t\t\t\n    true\n  from\n          granted_permissions p\n  where\n    p.user_id = current_setting('app.user_id')\n    and p.permission_id = (\n      select\n        p2.permission_id\n      from\n        \"permission\" p2\n      where\n        p2.permission_name = 'master.location.write'\n        and p2.resource_path = current_setting('permission.resource_path'))\n  )\n",
                        "for": "all"
                    }
                ],
                "use_custom_hasura_policy": null
            }
        ]
    },
    {
        "filename": "accesscontrol/auth/users.user_access_paths.yaml",
        "service": "auth",
        "revision": 1,
        "table_name": "user_access_paths",
        "created_at": "2023-05-29T15:58:52.086638138+07:00",
        "updated_at": "2023-05-29T15:58:52.086638183+07:00",
        "stages": [
            {
                "template": "1",
                "hasura": null,
                "postgres": {
                    "stage_dir": "migrations/auth/1005_migrate.up.sql",
                    "policies": [
                        {
                            "name": "rls_user_access_paths_location",
                            "content": "DROP POLICY IF EXISTS rls_user_access_paths on \"user_access_paths\";\nCREATE POLICY rls_user_access_paths_location ON \"user_access_paths\" AS PERMISSIVE FOR ALL TO PUBLIC\nusing (\n\tlocation_id in (\n\t\tselect\t\t\t\n\t\t\tp.location_id\n\t\tfrom\n\t\t\t\t\t\tgranted_permissions p\n\t\twhere\n\t\t\tp.user_id = current_setting('app.user_id')\n\t\t\tand p.permission_id = (\n\t\t\t\tselect\n\t\t\t\t\tp2.permission_id\n\t\t\t\tfrom\n\t\t\t\t\t\"permission\" p2\n\t\t\t\twhere\n\t\t\t\t\tp2.permission_name = 'user.user.read'\n\t\t\t\t\tand p2.resource_path = current_setting('permission.resource_path'))\n\t\t)\n)\nwith check (\n\tlocation_id in (\n\t\tselect\t\t\t\n\t\t\tp.location_id\n\t\tfrom\n\t\t\t\t\t\tgranted_permissions p\n\t\twhere\n\t\t\tp.user_id = current_setting('app.user_id')\n\t\t\tand p.permission_id = (\n\t\t\t\tselect\n\t\t\t\t\tp2.permission_id\n\t\t\t\tfrom\n\t\t\t\t\t\"permission\" p2\n\t\t\t\twhere\n\t\t\t\t\tp2.permission_name = 'user.user.write'\n\t\t\t\t\tand p2.resource_path = current_setting('permission.resource_path'))\n\t\t)\n);"
                        }
                    ]
                },
                "accessPathTable": null,
                "locationCol": null,
                "permissionPrefix": "user.user",
                "permissions": {
                    "postgres": [],
                    "hasura": null
                },
                "ownerCol": null,
                "use_custom_policy": null,
                "hasura_policies": null,
                "postgres_policies": null,
                "use_custom_hasura_policy": null
            }
        ]
    },
    {
        "filename": "accesscontrol/auth/users.users.yaml",
        "service": "auth",
        "revision": 1,
        "table_name": "users",
        "created_at": "2023-05-29T15:58:52.086820495+07:00",
        "updated_at": "2023-05-29T15:58:52.086820522+07:00",
        "stages": [
            {
                "template": "1.1",
                "hasura": null,
                "postgres": {
                    "stage_dir": "migrations/auth/1006_migrate.up.sql",
                    "policies": [
                        {
                            "name": "rls_users_select_location",
                            "content": "CREATE POLICY rls_users_select_location ON \"users\" AS PERMISSIVE FOR select TO PUBLIC\nusing (\nuser_id in (\n\tselect\t\t\t\n\t\tusp.\"user_id\"\n\tfrom\n\t\t\t\t\tgranted_permissions p\n\tjoin user_access_paths usp on\n\t\t\t\t\tusp.location_id = p.location_id\n\twhere\n\t\tp.user_id = current_setting('app.user_id')\n\t\tand p.permission_id = (\n\t\t\tselect\n\t\t\t\tp2.permission_id\n\t\t\tfrom\n\t\t\t\t\"permission\" p2\n\t\t\twhere\n\t\t\t\tp2.permission_name = 'user.user.read'\n\t\t\t\tand p2.resource_path = current_setting('permission.resource_path'))\n\t\tand usp.deleted_at is null\n\t)\n)\n;"
                        },
                        {
                            "name": "rls_users_update_location",
                            "content": "CREATE POLICY rls_users_update_location ON \"users\" AS PERMISSIVE FOR update TO PUBLIC\nusing (\nuser_id in (\n\tselect\t\t\t\n\t\tusp.\"user_id\"\n\tfrom\n\t\t\t\t\tgranted_permissions p\n\tjoin user_access_paths usp on\n\t\t\t\t\tusp.location_id = p.location_id\n\twhere\n\t\tp.user_id = current_setting('app.user_id')\n\t\tand p.permission_id = (\n\t\t\tselect\n\t\t\t\tp2.permission_id\n\t\t\tfrom\n\t\t\t\t\"permission\" p2\n\t\t\twhere\n\t\t\t\tp2.permission_name = 'user.user.write'\n\t\t\t\tand p2.resource_path = current_setting('permission.resource_path'))\n\t\tand usp.deleted_at is null\n\t)\n)with check (\nuser_id in (\n\tselect\t\t\t\n\t\tusp.\"user_id\"\n\tfrom\n\t\t\t\t\tgranted_permissions p\n\tjoin user_access_paths usp on\n\t\t\t\t\tusp.location_id = p.location_id\n\twhere\n\t\tp.user_id = current_setting('app.user_id')\n\t\tand p.permission_id = (\n\t\t\tselect\n\t\t\t\tp2.permission_id\n\t\t\tfrom\n\t\t\t\t\"permission\" p2\n\t\t\twhere\n\t\t\t\tp2.permission_name = 'user.user.write'\n\t\t\t\tand p2.resource_path = current_setting('permission.resource_path'))\n\t\tand usp.deleted_at is null\n\t)\n)\n;"
                        },
                        {
                            "name": "rls_users_delete_location",
                            "content": "CREATE POLICY rls_users_delete_location ON \"users\" AS PERMISSIVE FOR delete TO PUBLIC\nusing (\nuser_id in (\n\tselect\t\t\t\n\t\tusp.\"user_id\"\n\tfrom\n\t\t\t\t\tgranted_permissions p\n\tjoin user_access_paths usp on\n\t\t\t\t\tusp.location_id = p.location_id\n\twhere\n\t\tp.user_id = current_setting('app.user_id')\n\t\tand p.permission_id = (\n\t\t\tselect\n\t\t\t\tp2.permission_id\n\t\t\tfrom\n\t\t\t\t\"permission\" p2\n\t\t\twhere\n\t\t\t\tp2.permission_name = 'user.user.write'\n\t\t\t\tand p2.resource_path = current_setting('permission.resource_path'))\n\t\tand usp.deleted_at is null\n\t)\n)\n;"
                        },
                        {
                            "name": "rls_users_insert_location",
                            "content": "CREATE POLICY rls_users_insert_location ON \"users\" AS PERMISSIVE FOR INSERT TO PUBLIC\nwith check (\n\t1 = 1\n);\n"
                        }
                    ]
                },
                "accessPathTable": {
                    "name": "user_access_paths",
                    "columnMapping": {
                        "user_id": "user_id"
                    }
                },
                "locationCol": "location_id",
                "permissionPrefix": "user.user",
                "permissions": {
                    "postgres": [],
                    "hasura": null
                },
                "ownerCol": null,
                "use_custom_policy": null,
                "hasura_policies": null,
                "postgres_policies": null,
                "use_custom_hasura_policy": null
            },
            {
                "template": "4",
                "hasura": null,
                "postgres": {
                    "stage_dir": "migrations/auth/1007_migrate.up.sql",
                    "policies": [
                        {
                            "name": "rls_users_permission_v4",
                            "content": "DROP POLICY IF EXISTS rls_users on \"users\";\nCREATE POLICY rls_users_permission_v4 ON \"users\" AS PERMISSIVE FOR ALL TO PUBLIC\nusing (\n\tcurrent_setting('app.user_id') = user_id\n)\nwith check (\n\tcurrent_setting('app.user_id') = user_id\n);"
                        }
                    ]
                },
                "accessPathTable": null,
                "locationCol": null,
                "permissionPrefix": null,
                "permissions": {
                    "postgres": [],
                    "hasura": null
                },
                "ownerCol": "user_id",
                "use_custom_policy": null,
                "hasura_policies": null,
                "postgres_policies": null,
                "use_custom_hasura_policy": null
            }
        ]
    },
    {
        "filename": "accesscontrol/bob/lesson.lesson.yaml",
        "service": "bob",
        "revision": 1,
        "table_name": "lessons",
        "created_at": "2022-12-07T11:24:11.426960757+07:00",
        "updated_at": "2022-12-07T11:24:11.426960791+07:00",
        "stages": [
            {
                "template": "1",
                "hasura": {
                    "stage_dir": "deployments/helm/manabie-all-in-one/charts/bob/files/hasura/metadata/tables.yaml",
                    "permissions": [
                        "SELECT",
                        "INSERT",
                        "UPDATE",
                        "DELETE"
                    ],
                    "relationship": "lessons_location_permission",
                    "first_level_query": "lessons_location_permission",
                    "hasura_policies": {
                        "select_permission": [
                            {
                                "name": "MANABIE",
                                "filter": {
                                    "lessons_location_permission": {
                                        "_and": [
                                            {
                                                "user_id": {
                                                    "_eq": "X-Hasura-User-Id"
                                                }
                                            },
                                            {
                                                "permission_name": {
                                                    "_eq": "lesson.lesson.read"
                                                }
                                            }
                                        ]
                                    }
                                }
                            },
                            {
                                "name": "USER_GROUP_ADMIN",
                                "filter": {
                                    "lessons_location_permission": {
                                        "_and": [
                                            {
                                                "user_id": {
                                                    "_eq": "X-Hasura-User-Id"
                                                }
                                            },
                                            {
                                                "permission_name": {
                                                    "_eq": "lesson.lesson.read"
                                                }
                                            }
                                        ]
                                    }
                                }
                            },
                            {
                                "name": "USER_GROUP_SCHOOL_ADMIN",
                                "filter": {
                                    "lessons_location_permission": {
                                        "_and": [
                                            {
                                                "user_id": {
                                                    "_eq": "X-Hasura-User-Id"
                                                }
                                            },
                                            {
                                                "permission_name": {
                                                    "_eq": "lesson.lesson.read"
                                                }
                                            }
                                        ]
                                    }
                                }
                            },
                            {
                                "name": "USER_GROUP_SCHOOL_STAFF",
                                "filter": {
                                    "lessons_location_permission": {
                                        "_and": [
                                            {
                                                "user_id": {
                                                    "_eq": "X-Hasura-User-Id"
                                                }
                                            },
                                            {
                                                "permission_name": {
                                                    "_eq": "lesson.lesson.read"
                                                }
                                            }
                                        ]
                                    }
                                }
                            },
                            {
                                "name": "USER_GROUP_TEACHER",
                                "filter": {
                                    "lessons_location_permission": {
                                        "_and": [
                                            {
                                                "user_id": {
                                                    "_eq": "X-Hasura-User-Id"
                                                }
                                            },
                                            {
                                                "permission_name": {
                                                    "_eq": "lesson.lesson.read"
                                                }
                                            }
                                        ]
                                    }
                                }
                            }
                        ],
                        "insert_permission": [],
                        "delete_permission": [],
                        "update_permission": []
                    }
                },
                "postgres": {
                    "stage_dir": "migrations/bob/1414_migrate.up.sql",
                    "policies": [
                        {
                            "name": "rls_lessons_location",
                            "content": "DROP POLICY IF EXISTS rls_lessons on \"lessons\";\nCREATE POLICY rls_lessons_location ON \"lessons\" AS PERMISSIVE FOR ALL TO PUBLIC\nusing (\n\tcenter_id in (\n\t\tselect\t\t\t\n\t\t\tp.location_id\n\t\tfrom\n\t\t\t\t\t\tgranted_permissions p\n\t\twhere\n\t\t\tp.user_id = current_setting('app.user_id')\n\t\t\tand p.permission_id = (\n\t\t\t\tselect\n\t\t\t\t\tp2.permission_id\n\t\t\t\tfrom\n\t\t\t\t\t\"permission\" p2\n\t\t\t\twhere\n\t\t\t\t\tp2.permission_name = 'lesson.lesson.read'\n\t\t\t\t\tand p2.resource_path = current_setting('permission.resource_path'))\n\t\t)\n)\nwith check (\n\tcenter_id in (\n\t\tselect\t\t\t\n\t\t\tp.location_id\n\t\tfrom\n\t\t\t\t\t\tgranted_permissions p\n\t\twhere\n\t\t\tp.user_id = current_setting('app.user_id')\n\t\t\tand p.permission_id = (\n\t\t\t\tselect\n\t\t\t\t\tp2.permission_id\n\t\t\t\tfrom\n\t\t\t\t\t\"permission\" p2\n\t\t\t\twhere\n\t\t\t\t\tp2.permission_name = 'lesson.lesson.write'\n\t\t\t\t\tand p2.resource_path = current_setting('permission.resource_path'))\n\t\t)\n);"
                        }
                    ]
                },
                "accessPathTable": null,
                "locationCol": "center_id",
                "permissionPrefix": "lesson.lesson",
                "permissions": {
                    "postgres": [],
                    "hasura": []
                },
                "ownerCol": null,
                "use_custom_policy": null,
                "hasura_policies": null,
                "postgres_policies": null,
                "use_custom_hasura_policy": null
            }
        ]
    },
    {
        "filename": "accesscontrol/bob/master.course.yaml",
        "service": "bob",
        "revision": 1,
        "table_name": "courses",
        "created_at": "2022-12-08T10:13:19.508211517+07:00",
        "updated_at": "2022-12-08T10:13:19.508211569+07:00",
        "stages": [
            {
                "template": "3",
                "hasura": {
                    "stage_dir": "deployments/helm/manabie-all-in-one/charts/bob/files/hasura/metadata/tables.yaml",
                    "permissions": [
                        "SELECT",
                        "INSERT",
                        "UPDATE",
                        "DELETE"
                    ],
                    "relationship": "courses_location_permission",
                    "first_level_query": "_exists",
                    "hasura_policies": {
                        "select_permission": [
                            {
                                "name": "MANABIE",
                                "filter": {
                                    "_exists": {
                                        "_table": {
                                            "name": "granted_permissions",
                                            "schema": "public"
                                        },
                                        "_where": {
                                            "_and": [
                                                {
                                                    "user_id": {
                                                        "_eq": "X-Hasura-User-Id"
                                                    }
                                                },
                                                {
                                                    "permission_name": {
                                                        "_eq": "master.course.read"
                                                    }
                                                }
                                            ]
                                        }
                                    }
                                }
                            },
                            {
                                "name": "USER_GROUP_ADMIN",
                                "filter": {
                                    "_exists": {
                                        "_table": {
                                            "name": "granted_permissions",
                                            "schema": "public"
                                        },
                                        "_where": {
                                            "_and": [
                                                {
                                                    "user_id": {
                                                        "_eq": "X-Hasura-User-Id"
                                                    }
                                                },
                                                {
                                                    "permission_name": {
                                                        "_eq": "master.course.read"
                                                    }
                                                }
                                            ]
                                        }
                                    }
                                }
                            },
                            {
                                "name": "USER_GROUP_SCHOOL_ADMIN",
                                "filter": {
                                    "_exists": {
                                        "_table": {
                                            "name": "granted_permissions",
                                            "schema": "public"
                                        },
                                        "_where": {
                                            "_and": [
                                                {
                                                    "user_id": {
                                                        "_eq": "X-Hasura-User-Id"
                                                    }
                                                },
                                                {
                                                    "permission_name": {
                                                        "_eq": "master.course.read"
                                                    }
                                                }
                                            ]
                                        }
                                    }
                                }
                            },
                            {
                                "name": "USER_GROUP_SCHOOL_STAFF",
                                "filter": {
                                    "_exists": {
                                        "_table": {
                                            "name": "granted_permissions",
                                            "schema": "public"
                                        },
                                        "_where": {
                                            "_and": [
                                                {
                                                    "user_id": {
                                                        "_eq": "X-Hasura-User-Id"
                                                    }
                                                },
                                                {
                                                    "permission_name": {
                                                        "_eq": "master.course.read"
                                                    }
                                                }
                                            ]
                                        }
                                    }
                                }
                            },
                            {
                                "name": "USER_GROUP_TEACHER",
                                "filter": {
                                    "_exists": {
                                        "_table": {
                                            "name": "granted_permissions",
                                            "schema": "public"
                                        },
                                        "_where": {
                                            "_and": [
                                                {
                                                    "user_id": {
                                                        "_eq": "X-Hasura-User-Id"
                                                    }
                                                },
                                                {
                                                    "permission_name": {
                                                        "_eq": "master.course.read"
                                                    }
                                                }
                                            ]
                                        }
                                    }
                                }
                            }
                        ],
                        "insert_permission": [],
                        "delete_permission": [],
                        "update_permission": []
                    }
                },
                "postgres": {
                    "stage_dir": "migrations/bob/1424_migrate.up.sql",
                    "policies": [
                        {
                            "name": "rls_courses_permission_v3",
                            "content": "DROP POLICY IF EXISTS rls_courses on \"courses\";\nCREATE POLICY rls_courses_permission_v3 ON \"courses\" AS PERMISSIVE FOR ALL TO PUBLIC\nusing (\n\ttrue \u003c= (\n\t\tselect\t\t\t\n\t\t\ttrue\n\t\tfrom\n\t\t\tgranted_permissions p\n\t\twhere\n\t\t\tp.user_id = current_setting('app.user_id')\n\t\t\tand p.permission_id = (\n\t\t\t\tselect\n\t\t\t\t\tp2.permission_id\n\t\t\t\tfrom\n\t\t\t\t\t\"permission\" p2\n\t\t\t\twhere\n\t\t\t\t\tp2.permission_name = 'master.course.read'\n\t\t\t\t\tand p2.resource_path = current_setting('permission.resource_path'))\n\t\tlimit 1\n\t\t)\n)\nwith check (\n\ttrue \u003c= (\n\t\tselect\t\t\t\n\t\t\ttrue\n\t\tfrom\n\t\t\tgranted_permissions p\n\t\twhere\n\t\t\tp.user_id = current_setting('app.user_id')\n\t\t\tand p.permission_id = (\n\t\t\t\tselect\n\t\t\t\t\tp2.permission_id\n\t\t\t\tfrom\n\t\t\t\t\t\"permission\" p2\n\t\t\t\twhere\n\t\t\t\t\tp2.permission_name = 'master.course.write'\n\t\t\t\t\tand p2.resource_path = current_setting('permission.resource_path'))\n\t\tlimit 1\n\t\t)\n);"
                        }
                    ]
                },
                "accessPathTable": null,
                "locationCol": null,
                "permissionPrefix": "master.course",
                "permissions": {
                    "postgres": [],
                    "hasura": []
                },
                "ownerCol": null,
                "use_custom_policy": null,
                "hasura_policies": null,
                "postgres_policies": null,
                "use_custom_hasura_policy": null
            }
        ]
    },
    {
        "filename": "accesscontrol/bob/master.location.yaml",
        "service": "bob",
        "revision": 1,
        "table_name": "locations",
        "created_at": "2022-12-13T16:34:40.588468978+07:00",
        "updated_at": "2022-12-13T16:34:40.588469298+07:00",
        "stages": [
            {
                "template": "1",
                "hasura": {
                    "stage_dir": "deployments/helm/manabie-all-in-one/charts/bob/files/hasura/metadata/tables.yaml",
                    "permissions": [
                        "SELECT",
                        "INSERT",
                        "UPDATE",
                        "DELETE"
                    ],
                    "relationship": "",
                    "first_level_query": "",
                    "hasura_policies": {
                        "select_permission": [
                            {
                                "name": "MANABIE",
                                "filter": [
                                    {
                                        "locations_location_permission": {
                                            "_and": [
                                                {
                                                    "user_id": {
                                                        "_eq": "X-Hasura-User-Id"
                                                    }
                                                },
                                                {
                                                    "permission_name": {
                                                        "_eq": "master.location.read"
                                                    }
                                                }
                                            ]
                                        }
                                    }
                                ]
                            },
                            {
                                "name": "USER_GROUP_ADMIN",
                                "filter": [
                                    {
                                        "locations_location_permission": {
                                            "_and": [
                                                {
                                                    "user_id": {
                                                        "_eq": "X-Hasura-User-Id"
                                                    }
                                                },
                                                {
                                                    "permission_name": {
                                                        "_eq": "master.location.read"
                                                    }
                                                }
                                            ]
                                        }
                                    }
                                ]
                            },
                            {
                                "name": "USER_GROUP_SCHOOL_ADMIN",
                                "filter": [
                                    {
                                        "locations_location_permission": {
                                            "_and": [
                                                {
                                                    "user_id": {
                                                        "_eq": "X-Hasura-User-Id"
                                                    }
                                                },
                                                {
                                                    "permission_name": {
                                                        "_eq": "master.location.read"
                                                    }
                                                }
                                            ]
                                        }
                                    }
                                ]
                            },
                            {
                                "name": "USER_GROUP_SCHOOL_STAFF",
                                "filter": [
                                    {
                                        "locations_location_permission": {
                                            "_and": [
                                                {
                                                    "user_id": {
                                                        "_eq": "X-Hasura-User-Id"
                                                    }
                                                },
                                                {
                                                    "permission_name": {
                                                        "_eq": "master.location.read"
                                                    }
                                                }
                                            ]
                                        }
                                    }
                                ]
                            },
                            {
                                "name": "USER_GROUP_TEACHER",
                                "filter": [
                                    {
                                        "locations_location_permission": {
                                            "_and": [
                                                {
                                                    "user_id": {
                                                        "_eq": "X-Hasura-User-Id"
                                                    }
                                                },
                                                {
                                                    "permission_name": {
                                                        "_eq": "master.location.read"
                                                    }
                                                }
                                            ]
                                        }
                                    }
                                ]
                            }
                        ],
                        "insert_permission": [],
                        "delete_permission": [],
                        "update_permission": []
                    }
                },
                "postgres": {
                    "stage_dir": "migrations/bob/1425_migrate.up.sql",
                    "policies": [
                        {
                            "name": "rls_locations_location",
                            "content": "DROP POLICY IF EXISTS rls_locations on \"locations\";\nCREATE POLICY rls_locations_location ON \"locations\" AS PERMISSIVE FOR ALL TO PUBLIC\nusing (\n\tlocation_id in (\n\t\tselect\t\t\t\n\t\t\tp.location_id\n\t\tfrom\n\t\t\t\t\t\tgranted_permissions p\n\t\twhere\n\t\t\tp.user_id = current_setting('app.user_id')\n\t\t\tand p.permission_id = (\n\t\t\t\tselect\n\t\t\t\t\tp2.permission_id\n\t\t\t\tfrom\n\t\t\t\t\t\"permission\" p2\n\t\t\t\twhere\n\t\t\t\t\tp2.permission_name = 'master.location.read'\n\t\t\t\t\tand p2.resource_path = current_setting('permission.resource_path'))\n\t\t)\n)\nwith check (\n\tlocation_id in (\n\t\tselect\t\t\t\n\t\t\tp.location_id\n\t\tfrom\n\t\t\t\t\t\tgranted_permissions p\n\t\twhere\n\t\t\tp.user_id = current_setting('app.user_id')\n\t\t\tand p.permission_id = (\n\t\t\t\tselect\n\t\t\t\t\tp2.permission_id\n\t\t\t\tfrom\n\t\t\t\t\t\"permission\" p2\n\t\t\t\twhere\n\t\t\t\t\tp2.permission_name = 'master.location.write'\n\t\t\t\t\tand p2.resource_path = current_setting('permission.resource_path'))\n\t\t)\n);"
                        }
                    ]
                },
                "accessPathTable": null,
                "locationCol": null,
                "permissionPrefix": null,
                "permissions": null,
                "ownerCol": null,
                "use_custom_policy": true,
                "hasura_policies": {
                    "select_permission": [
                        {
                            "name": "MANABIE",
                            "filter": [
                                {
                                    "locations_location_permission": {
                                        "_and": [
                                            {
                                                "user_id": {
                                                    "_eq": "X-Hasura-User-Id"
                                                }
                                            },
                                            {
                                                "permission_name": {
                                                    "_eq": "master.location.read"
                                                }
                                            }
                                        ]
                                    }
                                }
                            ]
                        },
                        {
                            "name": "USER_GROUP_ADMIN",
                            "filter": [
                                {
                                    "locations_location_permission": {
                                        "_and": [
                                            {
                                                "user_id": {
                                                    "_eq": "X-Hasura-User-Id"
                                                }
                                            },
                                            {
                                                "permission_name": {
                                                    "_eq": "master.location.read"
                                                }
                                            }
                                        ]
                                    }
                                }
                            ]
                        },
                        {
                            "name": "USER_GROUP_SCHOOL_ADMIN",
                            "filter": [
                                {
                                    "locations_location_permission": {
                                        "_and": [
                                            {
                                                "user_id": {
                                                    "_eq": "X-Hasura-User-Id"
                                                }
                                            },
                                            {
                                                "permission_name": {
                                                    "_eq": "master.location.read"
                                                }
                                            }
                                        ]
                                    }
                                }
                            ]
                        },
                        {
                            "name": "USER_GROUP_SCHOOL_STAFF",
                            "filter": [
                                {
                                    "locations_location_permission": {
                                        "_and": [
                                            {
                                                "user_id": {
                                                    "_eq": "X-Hasura-User-Id"
                                                }
                                            },
                                            {
                                                "permission_name": {
                                                    "_eq": "master.location.read"
                                                }
                                            }
                                        ]
                                    }
                                }
                            ]
                        },
                        {
                            "name": "USER_GROUP_TEACHER",
                            "filter": [
                                {
                                    "locations_location_permission": {
                                        "_and": [
                                            {
                                                "user_id": {
                                                    "_eq": "X-Hasura-User-Id"
                                                }
                                            },
                                            {
                                                "permission_name": {
                                                    "_eq": "master.location.read"
                                                }
                                            }
                                        ]
                                    }
                                }
                            ]
                        }
                    ],
                    "insert_permission": null,
                    "delete_permission": null,
                    "update_permission": null,
                    "object_custom_relationship": [
                        {
                            "table_name": "locations",
                            "manual_config": {
                                "Name": "locations_location_permission",
                                "Using": {
                                    "ForeignKeyConstraintOn": "",
                                    "ManualConfiguration": {
                                        "RemoteTable": {
                                            "Schema": "public",
                                            "Name": "granted_permissions"
                                        },
                                        "ColumnMapping": {
                                            "location_id": "location_id"
                                        }
                                    }
                                }
                            }
                        },
                        {
                            "table_name": "granted_permissions",
                            "manual_config": {
                                "Name": "locations_location_permission",
                                "Using": {
                                    "ForeignKeyConstraintOn": "",
                                    "ManualConfiguration": {
                                        "RemoteTable": {
                                            "Schema": "public",
                                            "Name": "locations"
                                        },
                                        "ColumnMapping": {
                                            "location_id": "location_id"
                                        }
                                    }
                                }
                            }
                        }
                    ]
                },
                "postgres_policies": [
                    {
                        "name": "rls_locations_location",
                        "using": "location_id in (\n  select\t\t\t\n    p.location_id\n  from\n          granted_permissions p\n  where\n    p.user_id = current_setting('app.user_id')\n    and p.permission_id = (\n      select\n        p2.permission_id\n      from\n        \"permission\" p2\n      where\n        p2.permission_name = 'master.location.read'\n        and p2.resource_path = current_setting('permission.resource_path'))\n  )\n",
                        "with_check": "exists (\n  select\t\t\t\n    true\n  from\n          granted_permissions p\n  where\n    p.user_id = current_setting('app.user_id')\n    and p.permission_id = (\n      select\n        p2.permission_id\n      from\n        \"permission\" p2\n      where\n        p2.permission_name = 'master.location.write'\n        and p2.resource_path = current_setting('permission.resource_path'))\n  )\n",
                        "for": "all"
                    }
                ],
                "use_custom_hasura_policy": true
            }
        ]
    },
    {
        "filename": "accesscontrol/bob/notification.info_notifications.yaml",
        "service": "bob",
        "revision": 1,
        "table_name": "info_notifications",
        "created_at": "2022-12-08T16:15:37.089841684+07:00",
        "updated_at": "2022-12-08T16:15:37.089841731+07:00",
        "stages": [
            {
                "template": "1.1",
                "hasura": {
                    "stage_dir": "deployments/helm/manabie-all-in-one/charts/bob/files/hasura/metadata/tables.yaml",
                    "permissions": [
                        "SELECT",
                        "INSERT",
                        "UPDATE",
                        "DELETE"
                    ],
                    "relationship": "",
                    "first_level_query": "",
                    "hasura_policies": {
                        "select_permission": [
                            {
                                "name": "MANABIE",
                                "filter": [
                                    {
                                        "_or": [
                                            {
                                                "info_notifications_access_paths": {
                                                    "info_notifications_location_permission": {
                                                        "_and": [
                                                            {
                                                                "permission_name": {
                                                                    "_eq": "communication.notification.read"
                                                                }
                                                            },
                                                            {
                                                                "user_id": {
                                                                    "_eq": "X-Hasura-User-Id"
                                                                }
                                                            }
                                                        ]
                                                    }
                                                }
                                            },
                                            {
                                                "created_user_id": {
                                                    "_eq": "X-Hasura-User-Id"
                                                }
                                            }
                                        ]
                                    }
                                ]
                            },
                            {
                                "name": "USER_GROUP_ADMIN",
                                "filter": [
                                    {
                                        "_or": [
                                            {
                                                "info_notifications_access_paths": {
                                                    "info_notifications_location_permission": {
                                                        "_and": [
                                                            {
                                                                "permission_name": {
                                                                    "_eq": "communication.notification.read"
                                                                }
                                                            },
                                                            {
                                                                "user_id": {
                                                                    "_eq": "X-Hasura-User-Id"
                                                                }
                                                            }
                                                        ]
                                                    }
                                                }
                                            },
                                            {
                                                "created_user_id": {
                                                    "_eq": "X-Hasura-User-Id"
                                                }
                                            }
                                        ]
                                    }
                                ]
                            },
                            {
                                "name": "USER_GROUP_SCHOOL_ADMIN",
                                "filter": [
                                    {
                                        "_or": [
                                            {
                                                "info_notifications_access_paths": {
                                                    "info_notifications_location_permission": {
                                                        "_and": [
                                                            {
                                                                "permission_name": {
                                                                    "_eq": "communication.notification.read"
                                                                }
                                                            },
                                                            {
                                                                "user_id": {
                                                                    "_eq": "X-Hasura-User-Id"
                                                                }
                                                            }
                                                        ]
                                                    }
                                                }
                                            },
                                            {
                                                "created_user_id": {
                                                    "_eq": "X-Hasura-User-Id"
                                                }
                                            }
                                        ]
                                    }
                                ]
                            },
                            {
                                "name": "USER_GROUP_TEACHER",
                                "filter": [
                                    {
                                        "_or": [
                                            {
                                                "info_notifications_access_paths": {
                                                    "info_notifications_location_permission": {
                                                        "_and": [
                                                            {
                                                                "permission_name": {
                                                                    "_eq": "communication.notification.read"
                                                                }
                                                            },
                                                            {
                                                                "user_id": {
                                                                    "_eq": "X-Hasura-User-Id"
                                                                }
                                                            }
                                                        ]
                                                    }
                                                }
                                            },
                                            {
                                                "created_user_id": {
                                                    "_eq": "X-Hasura-User-Id"
                                                }
                                            }
                                        ]
                                    }
                                ]
                            }
                        ],
                        "insert_permission": [],
                        "delete_permission": [],
                        "update_permission": []
                    }
                },
                "postgres": null,
                "accessPathTable": null,
                "locationCol": null,
                "permissionPrefix": null,
                "permissions": null,
                "ownerCol": null,
                "use_custom_policy": true,
                "hasura_policies": {
                    "select_permission": [
                        {
                            "name": "MANABIE",
                            "filter": [
                                {
                                    "_or": [
                                        {
                                            "info_notifications_access_paths": {
                                                "info_notifications_location_permission": {
                                                    "_and": [
                                                        {
                                                            "permission_name": {
                                                                "_eq": "communication.notification.read"
                                                            }
                                                        },
                                                        {
                                                            "user_id": {
                                                                "_eq": "X-Hasura-User-Id"
                                                            }
                                                        }
                                                    ]
                                                }
                                            }
                                        },
                                        {
                                            "created_user_id": {
                                                "_eq": "X-Hasura-User-Id"
                                            }
                                        }
                                    ]
                                }
                            ]
                        },
                        {
                            "name": "USER_GROUP_ADMIN",
                            "filter": [
                                {
                                    "_or": [
                                        {
                                            "info_notifications_access_paths": {
                                                "info_notifications_location_permission": {
                                                    "_and": [
                                                        {
                                                            "permission_name": {
                                                                "_eq": "communication.notification.read"
                                                            }
                                                        },
                                                        {
                                                            "user_id": {
                                                                "_eq": "X-Hasura-User-Id"
                                                            }
                                                        }
                                                    ]
                                                }
                                            }
                                        },
                                        {
                                            "created_user_id": {
                                                "_eq": "X-Hasura-User-Id"
                                            }
                                        }
                                    ]
                                }
                            ]
                        },
                        {
                            "name": "USER_GROUP_SCHOOL_ADMIN",
                            "filter": [
                                {
                                    "_or": [
                                        {
                                            "info_notifications_access_paths": {
                                                "info_notifications_location_permission": {
                                                    "_and": [
                                                        {
                                                            "permission_name": {
                                                                "_eq": "communication.notification.read"
                                                            }
                                                        },
                                                        {
                                                            "user_id": {
                                                                "_eq": "X-Hasura-User-Id"
                                                            }
                                                        }
                                                    ]
                                                }
                                            }
                                        },
                                        {
                                            "created_user_id": {
                                                "_eq": "X-Hasura-User-Id"
                                            }
                                        }
                                    ]
                                }
                            ]
                        },
                        {
                            "name": "USER_GROUP_TEACHER",
                            "filter": [
                                {
                                    "_or": [
                                        {
                                            "info_notifications_access_paths": {
                                                "info_notifications_location_permission": {
                                                    "_and": [
                                                        {
                                                            "permission_name": {
                                                                "_eq": "communication.notification.read"
                                                            }
                                                        },
                                                        {
                                                            "user_id": {
                                                                "_eq": "X-Hasura-User-Id"
                                                            }
                                                        }
                                                    ]
                                                }
                                            }
                                        },
                                        {
                                            "created_user_id": {
                                                "_eq": "X-Hasura-User-Id"
                                            }
                                        }
                                    ]
                                }
                            ]
                        }
                    ],
                    "insert_permission": null,
                    "delete_permission": null,
                    "update_permission": null
                },
                "postgres_policies": [
                    {
                        "name": "rls_info_notifications_insert_location",
                        "using": "",
                        "with_check": "1 = 1\n",
                        "for": "insert"
                    },
                    {
                        "name": "rls_info_notifications_insert_permission_v4",
                        "using": "",
                        "with_check": "1 = 1\n",
                        "for": "insert"
                    },
                    {
                        "name": "rls_info_notifications_select_location",
                        "using": "true \u003c= (\n    select\n        true\n    from\n        granted_permissions p\n        join info_notifications_access_paths inap on inap.location_id = p.location_id\n    where\n        p.user_id = current_setting('app.user_id')\n        and p.permission_id = (\n          select p2.permission_id \n          from permission p2\n          where p2.permission_name = 'communication.notification.read' and p2.resource_path = current_setting('permission.resource_path')\n        )\n        and inap.\"notification_id\" = info_notifications.notification_id\n        and inap.\"deleted_at\" is null\n    limit\n        1\n)\n",
                        "with_check": "",
                        "for": "select"
                    },
                    {
                        "name": "rls_info_notifications_select_permission_v4",
                        "using": "info_notifications.created_user_id = current_setting('app.user_id')\n",
                        "with_check": "",
                        "for": "select"
                    },
                    {
                        "name": "rls_info_notifications_update_location",
                        "using": "true \u003c= (\n    select\n        true\n    from\n        granted_permissions p\n        join info_notifications_access_paths inap on inap.location_id = p.location_id\n    where\n        p.user_id = current_setting('app.user_id')\n        and p.permission_id = (\n          select p2.permission_id \n          from permission p2\n          where p2.permission_name = 'communication.notification.read' and p2.resource_path = current_setting('permission.resource_path')\n        )\n        and inap.\"notification_id\" = info_notifications.notification_id\n        and inap.\"deleted_at\" is null\n    limit\n        1\n)\n",
                        "with_check": "true \u003c= (\n    select\n        true\n    from\n        granted_permissions p\n        join info_notifications_access_paths inap on inap.location_id = p.location_id\n    where\n        p.user_id = current_setting('app.user_id')\n        and p.permission_id = (\n          select p2.permission_id \n          from permission p2\n          where p2.permission_name = 'communication.notification.write' and p2.resource_path = current_setting('permission.resource_path')\n        )\n        and inap.\"notification_id\" = info_notifications.notification_id\n        and inap.\"deleted_at\" is null\n    limit\n        1\n)\n",
                        "for": "update"
                    },
                    {
                        "name": "rls_info_notifications_update_permission_v4",
                        "using": "info_notifications.created_user_id = current_setting('app.user_id')\n",
                        "with_check": "info_notifications.created_user_id = current_setting('app.user_id')\n",
                        "for": "update"
                    },
                    {
                        "name": "rls_info_notifications_delete_location",
                        "using": "true \u003c= (\n  select\n      true\n  from\n      granted_permissions p\n      join info_notifications_access_paths inap on inap.location_id = p.location_id\n  where\n      p.user_id = current_setting('app.user_id')\n      and p.permission_id = (\n        select p2.permission_id \n        from permission p2\n        where p2.permission_name = 'communication.notification.write' and p2.resource_path = current_setting('permission.resource_path')\n      )\n      and inap.\"notification_id\" = info_notifications.notification_id\n      and inap.\"deleted_at\" is null\n  limit\n      1\n)\n",
                        "with_check": "",
                        "for": "delete"
                    },
                    {
                        "name": "rls_info_notifications_delete_permission_v4",
                        "using": "info_notifications.created_user_id = current_setting('app.user_id')\n",
                        "with_check": "",
                        "for": "delete"
                    }
                ],
                "use_custom_hasura_policy": true
            }
        ]
    },
    {
        "filename": "accesscontrol/bob/notification.info_notifications_access_paths.yaml",
        "service": "bob",
        "revision": 1,
        "table_name": "info_notifications_access_paths",
        "created_at": "2022-12-08T16:15:37.115998742+07:00",
        "updated_at": "2022-12-08T16:15:37.115998797+07:00",
        "stages": [
            {
                "template": "1",
                "hasura": {
                    "stage_dir": "deployments/helm/manabie-all-in-one/charts/bob/files/hasura/metadata/tables.yaml",
                    "permissions": [
                        "SELECT",
                        "INSERT",
                        "UPDATE",
                        "DELETE"
                    ],
                    "relationship": "",
                    "first_level_query": "",
                    "hasura_policies": {
                        "select_permission": [
                            {
                                "name": "MANABIE",
                                "filter": [
                                    {
                                        "_or": [
                                            {
                                                "info_notifications_location_permission": {
                                                    "_and": [
                                                        {
                                                            "permission_name": {
                                                                "_eq": "communication.notification.read"
                                                            }
                                                        },
                                                        {
                                                            "user_id": {
                                                                "_eq": "X-Hasura-User-Id"
                                                            }
                                                        }
                                                    ]
                                                }
                                            },
                                            {
                                                "_and": [
                                                    {
                                                        "info_notifications_location_permission": {
                                                            "_and": [
                                                                {
                                                                    "permission_name": {
                                                                        "_eq": "communication.notification.owner"
                                                                    }
                                                                },
                                                                {
                                                                    "user_id": {
                                                                        "_eq": "X-Hasura-User-Id"
                                                                    }
                                                                }
                                                            ]
                                                        }
                                                    },
                                                    {
                                                        "created_user_id": {
                                                            "_eq": "X-Hasura-User-Id"
                                                        }
                                                    }
                                                ]
                                            }
                                        ]
                                    }
                                ]
                            },
                            {
                                "name": "USER_GROUP_ADMIN",
                                "filter": [
                                    {
                                        "_or": [
                                            {
                                                "info_notifications_location_permission": {
                                                    "_and": [
                                                        {
                                                            "permission_name": {
                                                                "_eq": "communication.notification.read"
                                                            }
                                                        },
                                                        {
                                                            "user_id": {
                                                                "_eq": "X-Hasura-User-Id"
                                                            }
                                                        }
                                                    ]
                                                }
                                            },
                                            {
                                                "_and": [
                                                    {
                                                        "info_notifications_location_permission": {
                                                            "_and": [
                                                                {
                                                                    "permission_name": {
                                                                        "_eq": "communication.notification.owner"
                                                                    }
                                                                },
                                                                {
                                                                    "user_id": {
                                                                        "_eq": "X-Hasura-User-Id"
                                                                    }
                                                                }
                                                            ]
                                                        }
                                                    },
                                                    {
                                                        "created_user_id": {
                                                            "_eq": "X-Hasura-User-Id"
                                                        }
                                                    }
                                                ]
                                            }
                                        ]
                                    }
                                ]
                            },
                            {
                                "name": "USER_GROUP_SCHOOL_ADMIN",
                                "filter": [
                                    {
                                        "_or": [
                                            {
                                                "info_notifications_location_permission": {
                                                    "_and": [
                                                        {
                                                            "permission_name": {
                                                                "_eq": "communication.notification.read"
                                                            }
                                                        },
                                                        {
                                                            "user_id": {
                                                                "_eq": "X-Hasura-User-Id"
                                                            }
                                                        }
                                                    ]
                                                }
                                            },
                                            {
                                                "_and": [
                                                    {
                                                        "info_notifications_location_permission": {
                                                            "_and": [
                                                                {
                                                                    "permission_name": {
                                                                        "_eq": "communication.notification.owner"
                                                                    }
                                                                },
                                                                {
                                                                    "user_id": {
                                                                        "_eq": "X-Hasura-User-Id"
                                                                    }
                                                                }
                                                            ]
                                                        }
                                                    },
                                                    {
                                                        "created_user_id": {
                                                            "_eq": "X-Hasura-User-Id"
                                                        }
                                                    }
                                                ]
                                            }
                                        ]
                                    }
                                ]
                            },
                            {
                                "name": "USER_GROUP_TEACHER",
                                "filter": [
                                    {
                                        "_or": [
                                            {
                                                "info_notifications_location_permission": {
                                                    "_and": [
                                                        {
                                                            "permission_name": {
                                                                "_eq": "communication.notification.read"
                                                            }
                                                        },
                                                        {
                                                            "user_id": {
                                                                "_eq": "X-Hasura-User-Id"
                                                            }
                                                        }
                                                    ]
                                                }
                                            },
                                            {
                                                "_and": [
                                                    {
                                                        "info_notifications_location_permission": {
                                                            "_and": [
                                                                {
                                                                    "permission_name": {
                                                                        "_eq": "communication.notification.owner"
                                                                    }
                                                                },
                                                                {
                                                                    "user_id": {
                                                                        "_eq": "X-Hasura-User-Id"
                                                                    }
                                                                }
                                                            ]
                                                        }
                                                    },
                                                    {
                                                        "created_user_id": {
                                                            "_eq": "X-Hasura-User-Id"
                                                        }
                                                    }
                                                ]
                                            }
                                        ]
                                    }
                                ]
                            }
                        ],
                        "insert_permission": [],
                        "delete_permission": [],
                        "update_permission": []
                    }
                },
                "postgres": null,
                "accessPathTable": null,
                "locationCol": null,
                "permissionPrefix": null,
                "permissions": null,
                "ownerCol": null,
                "use_custom_policy": true,
                "hasura_policies": {
                    "select_permission": [
                        {
                            "name": "MANABIE",
                            "filter": [
                                {
                                    "_or": [
                                        {
                                            "info_notifications_location_permission": {
                                                "_and": [
                                                    {
                                                        "permission_name": {
                                                            "_eq": "communication.notification.read"
                                                        }
                                                    },
                                                    {
                                                        "user_id": {
                                                            "_eq": "X-Hasura-User-Id"
                                                        }
                                                    }
                                                ]
                                            }
                                        },
                                        {
                                            "_and": [
                                                {
                                                    "info_notifications_location_permission": {
                                                        "_and": [
                                                            {
                                                                "permission_name": {
                                                                    "_eq": "communication.notification.owner"
                                                                }
                                                            },
                                                            {
                                                                "user_id": {
                                                                    "_eq": "X-Hasura-User-Id"
                                                                }
                                                            }
                                                        ]
                                                    }
                                                },
                                                {
                                                    "created_user_id": {
                                                        "_eq": "X-Hasura-User-Id"
                                                    }
                                                }
                                            ]
                                        }
                                    ]
                                }
                            ]
                        },
                        {
                            "name": "USER_GROUP_ADMIN",
                            "filter": [
                                {
                                    "_or": [
                                        {
                                            "info_notifications_location_permission": {
                                                "_and": [
                                                    {
                                                        "permission_name": {
                                                            "_eq": "communication.notification.read"
                                                        }
                                                    },
                                                    {
                                                        "user_id": {
                                                            "_eq": "X-Hasura-User-Id"
                                                        }
                                                    }
                                                ]
                                            }
                                        },
                                        {
                                            "_and": [
                                                {
                                                    "info_notifications_location_permission": {
                                                        "_and": [
                                                            {
                                                                "permission_name": {
                                                                    "_eq": "communication.notification.owner"
                                                                }
                                                            },
                                                            {
                                                                "user_id": {
                                                                    "_eq": "X-Hasura-User-Id"
                                                                }
                                                            }
                                                        ]
                                                    }
                                                },
                                                {
                                                    "created_user_id": {
                                                        "_eq": "X-Hasura-User-Id"
                                                    }
                                                }
                                            ]
                                        }
                                    ]
                                }
                            ]
                        },
                        {
                            "name": "USER_GROUP_SCHOOL_ADMIN",
                            "filter": [
                                {
                                    "_or": [
                                        {
                                            "info_notifications_location_permission": {
                                                "_and": [
                                                    {
                                                        "permission_name": {
                                                            "_eq": "communication.notification.read"
                                                        }
                                                    },
                                                    {
                                                        "user_id": {
                                                            "_eq": "X-Hasura-User-Id"
                                                        }
                                                    }
                                                ]
                                            }
                                        },
                                        {
                                            "_and": [
                                                {
                                                    "info_notifications_location_permission": {
                                                        "_and": [
                                                            {
                                                                "permission_name": {
                                                                    "_eq": "communication.notification.owner"
                                                                }
                                                            },
                                                            {
                                                                "user_id": {
                                                                    "_eq": "X-Hasura-User-Id"
                                                                }
                                                            }
                                                        ]
                                                    }
                                                },
                                                {
                                                    "created_user_id": {
                                                        "_eq": "X-Hasura-User-Id"
                                                    }
                                                }
                                            ]
                                        }
                                    ]
                                }
                            ]
                        },
                        {
                            "name": "USER_GROUP_TEACHER",
                            "filter": [
                                {
                                    "_or": [
                                        {
                                            "info_notifications_location_permission": {
                                                "_and": [
                                                    {
                                                        "permission_name": {
                                                            "_eq": "communication.notification.read"
                                                        }
                                                    },
                                                    {
                                                        "user_id": {
                                                            "_eq": "X-Hasura-User-Id"
                                                        }
                                                    }
                                                ]
                                            }
                                        },
                                        {
                                            "_and": [
                                                {
                                                    "info_notifications_location_permission": {
                                                        "_and": [
                                                            {
                                                                "permission_name": {
                                                                    "_eq": "communication.notification.owner"
                                                                }
                                                            },
                                                            {
                                                                "user_id": {
                                                                    "_eq": "X-Hasura-User-Id"
                                                                }
                                                            }
                                                        ]
                                                    }
                                                },
                                                {
                                                    "created_user_id": {
                                                        "_eq": "X-Hasura-User-Id"
                                                    }
                                                }
                                            ]
                                        }
                                    ]
                                }
                            ]
                        }
                    ],
                    "insert_permission": null,
                    "delete_permission": null,
                    "update_permission": null,
                    "object_custom_relationship": [
                        {
                            "table_name": "info_notifications_access_paths",
                            "manual_config": {
                                "Name": "info_notifications_location_permission",
                                "Using": {
                                    "ForeignKeyConstraintOn": "",
                                    "ManualConfiguration": {
                                        "RemoteTable": {
                                            "Schema": "public",
                                            "Name": "granted_permissions"
                                        },
                                        "ColumnMapping": {
                                            "location_id": "location_id"
                                        }
                                    }
                                }
                            }
                        },
                        {
                            "table_name": "granted_permissions",
                            "manual_config": {
                                "Name": "info_notifications_location_permission",
                                "Using": {
                                    "ForeignKeyConstraintOn": "",
                                    "ManualConfiguration": {
                                        "RemoteTable": {
                                            "Schema": "public",
                                            "Name": "info_notifications_access_paths"
                                        },
                                        "ColumnMapping": {
                                            "location_id": "location_id"
                                        }
                                    }
                                }
                            }
                        }
                    ]
                },
                "postgres_policies": [
                    {
                        "name": "rls_info_notifications_access_paths_location_permission_v4",
                        "using": "true \u003c= (\n  select\n      true\n  from\n      granted_permissions p\n  where\n      p.user_id = current_setting('app.user_id')\n      and p.location_id = info_notifications_access_paths.location_id\n      and (\n          p.permission_id = (\n            select p2.permission_id \n            from permission p2\n            where p2.permission_name = 'communication.notification.read' and p2.resource_path = current_setting('permission.resource_path')\n          )\n          or (\n              p.permission_id = (\n                select p2.permission_id \n                from permission p2\n                where p2.permission_name = 'communication.notification.owner' and p2.resource_path = current_setting('permission.resource_path')\n              )\n              and info_notifications_access_paths.created_user_id = current_setting('app.user_id')\n          )\n      )\n  limit 1\n)\n",
                        "with_check": "true \u003c= (\n    select\n        true\n    from\n        granted_permissions p\n    where\n        p.user_id = current_setting('app.user_id')\n        and p.location_id = info_notifications_access_paths.location_id\n        and (\n            p.permission_id = (\n              select p2.permission_id \n              from permission p2\n              where p2.permission_name = 'communication.notification.write' and p2.resource_path = current_setting('permission.resource_path')\n            )\n            or (\n                p.permission_id = (\n                  select p2.permission_id \n                  from permission p2\n                  where p2.permission_name = 'communication.notification.owner' and p2.resource_path = current_setting('permission.resource_path')\n                )\n                and info_notifications_access_paths.created_user_id = current_setting('app.user_id')\n            )\n        )\n    limit 1\n)\n",
                        "for": "all"
                    }
                ],
                "use_custom_hasura_policy": true
            }
        ]
    },
    {
        "filename": "accesscontrol/bob/users.parents.yaml",
        "service": "bob",
        "revision": 1,
        "table_name": "parents",
        "created_at": "2022-12-07T15:22:00.122296373+07:00",
        "updated_at": "2022-12-07T15:22:00.122296418+07:00",
        "stages": [
            {
                "template": "1.1",
                "hasura": {
                    "stage_dir": "deployments/helm/manabie-all-in-one/charts/bob/files/hasura/metadata/tables.yaml",
                    "permissions": [
                        "SELECT",
                        "INSERT",
                        "UPDATE",
                        "DELETE"
                    ],
                    "relationship": "parents_location_permission",
                    "first_level_query": "user_access_paths",
                    "hasura_policies": {
                        "select_permission": [
                            {
                                "name": "MANABIE",
                                "filter": {
                                    "user_access_paths": {
                                        "_and": [
                                            {
                                                "parents_location_permission": {
                                                    "_and": [
                                                        {
                                                            "user_id": {
                                                                "_eq": "X-Hasura-User-Id"
                                                            }
                                                        },
                                                        {
                                                            "permission_name": {
                                                                "_eq": "user.parent.read"
                                                            }
                                                        }
                                                    ]
                                                }
                                            },
                                            {
                                                "deleted_at": {
                                                    "_is_null": true
                                                }
                                            }
                                        ]
                                    }
                                }
                            },
                            {
                                "name": "USER_GROUP_ADMIN",
                                "filter": {
                                    "user_access_paths": {
                                        "_and": [
                                            {
                                                "parents_location_permission": {
                                                    "_and": [
                                                        {
                                                            "user_id": {
                                                                "_eq": "X-Hasura-User-Id"
                                                            }
                                                        },
                                                        {
                                                            "permission_name": {
                                                                "_eq": "user.parent.read"
                                                            }
                                                        }
                                                    ]
                                                }
                                            },
                                            {
                                                "deleted_at": {
                                                    "_is_null": true
                                                }
                                            }
                                        ]
                                    }
                                }
                            },
                            {
                                "name": "USER_GROUP_SCHOOL_ADMIN",
                                "filter": {
                                    "user_access_paths": {
                                        "_and": [
                                            {
                                                "parents_location_permission": {
                                                    "_and": [
                                                        {
                                                            "user_id": {
                                                                "_eq": "X-Hasura-User-Id"
                                                            }
                                                        },
                                                        {
                                                            "permission_name": {
                                                                "_eq": "user.parent.read"
                                                            }
                                                        }
                                                    ]
                                                }
                                            },
                                            {
                                                "deleted_at": {
                                                    "_is_null": true
                                                }
                                            }
                                        ]
                                    }
                                }
                            },
                            {
                                "name": "USER_GROUP_TEACHER",
                                "filter": {
                                    "user_access_paths": {
                                        "_and": [
                                            {
                                                "parents_location_permission": {
                                                    "_and": [
                                                        {
                                                            "user_id": {
                                                                "_eq": "X-Hasura-User-Id"
                                                            }
                                                        },
                                                        {
                                                            "permission_name": {
                                                                "_eq": "user.parent.read"
                                                            }
                                                        }
                                                    ]
                                                }
                                            },
                                            {
                                                "deleted_at": {
                                                    "_is_null": true
                                                }
                                            }
                                        ]
                                    }
                                }
                            }
                        ],
                        "insert_permission": [],
                        "delete_permission": [],
                        "update_permission": []
                    }
                },
                "postgres": {
                    "stage_dir": "migrations/bob/1417_migrate.up.sql",
                    "policies": [
                        {
                            "name": "rls_parents_select_location",
                            "content": "CREATE POLICY rls_parents_select_location ON \"parents\" AS PERMISSIVE FOR select TO PUBLIC\nusing (\ntrue \u003c= (\n\tselect\t\t\t\n\t\ttrue\n\tfrom\n\t\t\t\t\tgranted_permissions p\n\tjoin user_access_paths usp on\n\t\t\t\t\tusp.location_id = p.location_id\n\twhere\n\t\tp.user_id = current_setting('app.user_id')\n\t\tand p.permission_id = (\n\t\t\tselect\n\t\t\t\tp2.permission_id\n\t\t\tfrom\n\t\t\t\t\"permission\" p2\n\t\t\twhere\n\t\t\t\tp2.permission_name = 'user.parent.read'\n\t\t\t\tand p2.resource_path = current_setting('permission.resource_path'))\n\t\tand usp.\"user_id\" = parents.parent_id\n\t\tand usp.deleted_at is null\n\tlimit 1\n\t)\n)\n;"
                        },
                        {
                            "name": "rls_parents_update_location",
                            "content": "CREATE POLICY rls_parents_update_location ON \"parents\" AS PERMISSIVE FOR update TO PUBLIC\nusing (\ntrue \u003c= (\n\tselect\t\t\t\n\t\ttrue\n\tfrom\n\t\t\t\t\tgranted_permissions p\n\tjoin user_access_paths usp on\n\t\t\t\t\tusp.location_id = p.location_id\n\twhere\n\t\tp.user_id = current_setting('app.user_id')\n\t\tand p.permission_id = (\n\t\t\tselect\n\t\t\t\tp2.permission_id\n\t\t\tfrom\n\t\t\t\t\"permission\" p2\n\t\t\twhere\n\t\t\t\tp2.permission_name = 'user.parent.write'\n\t\t\t\tand p2.resource_path = current_setting('permission.resource_path'))\n\t\tand usp.\"user_id\" = parents.parent_id\n\t\tand usp.deleted_at is null\n\tlimit 1\n\t)\n)with check (\ntrue \u003c= (\n\tselect\t\t\t\n\t\ttrue\n\tfrom\n\t\t\t\t\tgranted_permissions p\n\tjoin user_access_paths usp on\n\t\t\t\t\tusp.location_id = p.location_id\n\twhere\n\t\tp.user_id = current_setting('app.user_id')\n\t\tand p.permission_id = (\n\t\t\tselect\n\t\t\t\tp2.permission_id\n\t\t\tfrom\n\t\t\t\t\"permission\" p2\n\t\t\twhere\n\t\t\t\tp2.permission_name = 'user.parent.write'\n\t\t\t\tand p2.resource_path = current_setting('permission.resource_path'))\n\t\tand usp.\"user_id\" = parents.parent_id\n\t\tand usp.deleted_at is null\n\tlimit 1\n\t)\n)\n;"
                        },
                        {
                            "name": "rls_parents_delete_location",
                            "content": "CREATE POLICY rls_parents_delete_location ON \"parents\" AS PERMISSIVE FOR delete TO PUBLIC\nusing (\ntrue \u003c= (\n\tselect\t\t\t\n\t\ttrue\n\tfrom\n\t\t\t\t\tgranted_permissions p\n\tjoin user_access_paths usp on\n\t\t\t\t\tusp.location_id = p.location_id\n\twhere\n\t\tp.user_id = current_setting('app.user_id')\n\t\tand p.permission_id = (\n\t\t\tselect\n\t\t\t\tp2.permission_id\n\t\t\tfrom\n\t\t\t\t\"permission\" p2\n\t\t\twhere\n\t\t\t\tp2.permission_name = 'user.parent.write'\n\t\t\t\tand p2.resource_path = current_setting('permission.resource_path'))\n\t\tand usp.\"user_id\" = parents.parent_id\n\t\tand usp.deleted_at is null\n\tlimit 1\n\t)\n)\n;"
                        },
                        {
                            "name": "rls_parents_insert_location",
                            "content": "CREATE POLICY rls_parents_insert_location ON \"parents\" AS PERMISSIVE FOR INSERT TO PUBLIC\nwith check (\n\t1 = 1\n);\n"
                        }
                    ]
                },
                "accessPathTable": {
                    "name": "user_access_paths",
                    "columnMapping": {
                        "parent_id": "user_id"
                    }
                },
                "locationCol": "location_id",
                "permissionPrefix": "user.parent",
                "permissions": {
                    "postgres": [],
                    "hasura": []
                },
                "ownerCol": null,
                "use_custom_policy": null,
                "hasura_policies": null,
                "postgres_policies": null,
                "use_custom_hasura_policy": null
            }
        ]
    },
    {
        "filename": "accesscontrol/bob/users.staff.yaml",
        "service": "bob",
        "revision": 1,
        "table_name": "staff",
        "created_at": "2022-12-07T15:22:00.144849161+07:00",
        "updated_at": "2022-12-07T15:22:00.144849232+07:00",
        "stages": [
            {
                "template": "1.1",
                "hasura": {
                    "stage_dir": "deployments/helm/manabie-all-in-one/charts/bob/files/hasura/metadata/tables.yaml",
                    "permissions": [
                        "SELECT",
                        "INSERT",
                        "UPDATE",
                        "DELETE"
                    ],
                    "relationship": "staff_location_permission",
                    "first_level_query": "user_access_paths",
                    "hasura_policies": {
                        "select_permission": [
                            {
                                "name": "MANABIE",
                                "filter": {
                                    "user_access_paths": {
                                        "_and": [
                                            {
                                                "staff_location_permission": {
                                                    "_and": [
                                                        {
                                                            "user_id": {
                                                                "_eq": "X-Hasura-User-Id"
                                                            }
                                                        },
                                                        {
                                                            "permission_name": {
                                                                "_eq": "user.staff.read"
                                                            }
                                                        }
                                                    ]
                                                }
                                            },
                                            {
                                                "deleted_at": {
                                                    "_is_null": true
                                                }
                                            }
                                        ]
                                    }
                                }
                            },
                            {
                                "name": "USER_GROUP_SCHOOL_ADMIN",
                                "filter": {
                                    "user_access_paths": {
                                        "_and": [
                                            {
                                                "staff_location_permission": {
                                                    "_and": [
                                                        {
                                                            "user_id": {
                                                                "_eq": "X-Hasura-User-Id"
                                                            }
                                                        },
                                                        {
                                                            "permission_name": {
                                                                "_eq": "user.staff.read"
                                                            }
                                                        }
                                                    ]
                                                }
                                            },
                                            {
                                                "deleted_at": {
                                                    "_is_null": true
                                                }
                                            }
                                        ]
                                    }
                                }
                            },
                            {
                                "name": "USER_GROUP_TEACHER",
                                "filter": {
                                    "user_access_paths": {
                                        "_and": [
                                            {
                                                "staff_location_permission": {
                                                    "_and": [
                                                        {
                                                            "user_id": {
                                                                "_eq": "X-Hasura-User-Id"
                                                            }
                                                        },
                                                        {
                                                            "permission_name": {
                                                                "_eq": "user.staff.read"
                                                            }
                                                        }
                                                    ]
                                                }
                                            },
                                            {
                                                "deleted_at": {
                                                    "_is_null": true
                                                }
                                            }
                                        ]
                                    }
                                }
                            }
                        ],
                        "insert_permission": [],
                        "delete_permission": [],
                        "update_permission": []
                    }
                },
                "postgres": {
                    "stage_dir": "migrations/bob/1418_migrate.up.sql",
                    "policies": [
                        {
                            "name": "rls_staff_select_location",
                            "content": "CREATE POLICY rls_staff_select_location ON \"staff\" AS PERMISSIVE FOR select TO PUBLIC\nusing (\ntrue \u003c= (\n\tselect\t\t\t\n\t\ttrue\n\tfrom\n\t\t\t\t\tgranted_permissions p\n\tjoin user_access_paths usp on\n\t\t\t\t\tusp.location_id = p.location_id\n\twhere\n\t\tp.user_id = current_setting('app.user_id')\n\t\tand p.permission_id = (\n\t\t\tselect\n\t\t\t\tp2.permission_id\n\t\t\tfrom\n\t\t\t\t\"permission\" p2\n\t\t\twhere\n\t\t\t\tp2.permission_name = 'user.staff.read'\n\t\t\t\tand p2.resource_path = current_setting('permission.resource_path'))\n\t\tand usp.\"user_id\" = staff.staff_id\n\t\tand usp.deleted_at is null\n\tlimit 1\n\t)\n)\n;"
                        },
                        {
                            "name": "rls_staff_update_location",
                            "content": "CREATE POLICY rls_staff_update_location ON \"staff\" AS PERMISSIVE FOR update TO PUBLIC\nusing (\ntrue \u003c= (\n\tselect\t\t\t\n\t\ttrue\n\tfrom\n\t\t\t\t\tgranted_permissions p\n\tjoin user_access_paths usp on\n\t\t\t\t\tusp.location_id = p.location_id\n\twhere\n\t\tp.user_id = current_setting('app.user_id')\n\t\tand p.permission_id = (\n\t\t\tselect\n\t\t\t\tp2.permission_id\n\t\t\tfrom\n\t\t\t\t\"permission\" p2\n\t\t\twhere\n\t\t\t\tp2.permission_name = 'user.staff.write'\n\t\t\t\tand p2.resource_path = current_setting('permission.resource_path'))\n\t\tand usp.\"user_id\" = staff.staff_id\n\t\tand usp.deleted_at is null\n\tlimit 1\n\t)\n)with check (\ntrue \u003c= (\n\tselect\t\t\t\n\t\ttrue\n\tfrom\n\t\t\t\t\tgranted_permissions p\n\tjoin user_access_paths usp on\n\t\t\t\t\tusp.location_id = p.location_id\n\twhere\n\t\tp.user_id = current_setting('app.user_id')\n\t\tand p.permission_id = (\n\t\t\tselect\n\t\t\t\tp2.permission_id\n\t\t\tfrom\n\t\t\t\t\"permission\" p2\n\t\t\twhere\n\t\t\t\tp2.permission_name = 'user.staff.write'\n\t\t\t\tand p2.resource_path = current_setting('permission.resource_path'))\n\t\tand usp.\"user_id\" = staff.staff_id\n\t\tand usp.deleted_at is null\n\tlimit 1\n\t)\n)\n;"
                        },
                        {
                            "name": "rls_staff_delete_location",
                            "content": "CREATE POLICY rls_staff_delete_location ON \"staff\" AS PERMISSIVE FOR delete TO PUBLIC\nusing (\ntrue \u003c= (\n\tselect\t\t\t\n\t\ttrue\n\tfrom\n\t\t\t\t\tgranted_permissions p\n\tjoin user_access_paths usp on\n\t\t\t\t\tusp.location_id = p.location_id\n\twhere\n\t\tp.user_id = current_setting('app.user_id')\n\t\tand p.permission_id = (\n\t\t\tselect\n\t\t\t\tp2.permission_id\n\t\t\tfrom\n\t\t\t\t\"permission\" p2\n\t\t\twhere\n\t\t\t\tp2.permission_name = 'user.staff.write'\n\t\t\t\tand p2.resource_path = current_setting('permission.resource_path'))\n\t\tand usp.\"user_id\" = staff.staff_id\n\t\tand usp.deleted_at is null\n\tlimit 1\n\t)\n)\n;"
                        },
                        {
                            "name": "rls_staff_insert_location",
                            "content": "CREATE POLICY rls_staff_insert_location ON \"staff\" AS PERMISSIVE FOR INSERT TO PUBLIC\nwith check (\n\t1 = 1\n);\n"
                        }
                    ]
                },
                "accessPathTable": {
                    "name": "user_access_paths",
                    "columnMapping": {
                        "staff_id": "user_id"
                    }
                },
                "locationCol": "location_id",
                "permissionPrefix": "user.staff",
                "permissions": {
                    "postgres": [],
                    "hasura": []
                },
                "ownerCol": null,
                "use_custom_policy": null,
                "hasura_policies": null,
                "postgres_policies": null,
                "use_custom_hasura_policy": null
            }
        ]
    },
    {
        "filename": "accesscontrol/bob/users.students.yaml",
        "service": "bob",
        "revision": 1,
        "table_name": "students",
        "created_at": "2022-12-07T15:22:00.168886961+07:00",
        "updated_at": "2022-12-07T15:22:00.168887018+07:00",
        "stages": [
            {
                "template": "1.1",
                "hasura": {
                    "stage_dir": "deployments/helm/manabie-all-in-one/charts/bob/files/hasura/metadata/tables.yaml",
                    "permissions": [
                        "SELECT",
                        "INSERT",
                        "UPDATE",
                        "DELETE"
                    ],
                    "relationship": "students_location_permission",
                    "first_level_query": "user_access_paths",
                    "hasura_policies": {
                        "select_permission": [
                            {
                                "name": "MANABIE",
                                "filter": {
                                    "user_access_paths": {
                                        "_and": [
                                            {
                                                "students_location_permission": {
                                                    "_and": [
                                                        {
                                                            "user_id": {
                                                                "_eq": "X-Hasura-User-Id"
                                                            }
                                                        },
                                                        {
                                                            "permission_name": {
                                                                "_eq": "user.student.read"
                                                            }
                                                        }
                                                    ]
                                                }
                                            },
                                            {
                                                "deleted_at": {
                                                    "_is_null": true
                                                }
                                            }
                                        ]
                                    }
                                }
                            },
                            {
                                "name": "USER_GROUP_ADMIN",
                                "filter": {
                                    "user_access_paths": {
                                        "_and": [
                                            {
                                                "students_location_permission": {
                                                    "_and": [
                                                        {
                                                            "user_id": {
                                                                "_eq": "X-Hasura-User-Id"
                                                            }
                                                        },
                                                        {
                                                            "permission_name": {
                                                                "_eq": "user.student.read"
                                                            }
                                                        }
                                                    ]
                                                }
                                            },
                                            {
                                                "deleted_at": {
                                                    "_is_null": true
                                                }
                                            }
                                        ]
                                    }
                                }
                            },
                            {
                                "name": "USER_GROUP_SCHOOL_ADMIN",
                                "filter": {
                                    "user_access_paths": {
                                        "_and": [
                                            {
                                                "students_location_permission": {
                                                    "_and": [
                                                        {
                                                            "user_id": {
                                                                "_eq": "X-Hasura-User-Id"
                                                            }
                                                        },
                                                        {
                                                            "permission_name": {
                                                                "_eq": "user.student.read"
                                                            }
                                                        }
                                                    ]
                                                }
                                            },
                                            {
                                                "deleted_at": {
                                                    "_is_null": true
                                                }
                                            }
                                        ]
                                    }
                                }
                            },
                            {
                                "name": "USER_GROUP_TEACHER",
                                "filter": {
                                    "user_access_paths": {
                                        "_and": [
                                            {
                                                "students_location_permission": {
                                                    "_and": [
                                                        {
                                                            "user_id": {
                                                                "_eq": "X-Hasura-User-Id"
                                                            }
                                                        },
                                                        {
                                                            "permission_name": {
                                                                "_eq": "user.student.read"
                                                            }
                                                        }
                                                    ]
                                                }
                                            },
                                            {
                                                "deleted_at": {
                                                    "_is_null": true
                                                }
                                            }
                                        ]
                                    }
                                }
                            }
                        ],
                        "insert_permission": [],
                        "delete_permission": [],
                        "update_permission": []
                    }
                },
                "postgres": {
                    "stage_dir": "migrations/bob/1419_migrate.up.sql",
                    "policies": [
                        {
                            "name": "rls_students_select_location",
                            "content": "CREATE POLICY rls_students_select_location ON \"students\" AS PERMISSIVE FOR select TO PUBLIC\nusing (\ntrue \u003c= (\n\tselect\t\t\t\n\t\ttrue\n\tfrom\n\t\t\t\t\tgranted_permissions p\n\tjoin user_access_paths usp on\n\t\t\t\t\tusp.location_id = p.location_id\n\twhere\n\t\tp.user_id = current_setting('app.user_id')\n\t\tand p.permission_id = (\n\t\t\tselect\n\t\t\t\tp2.permission_id\n\t\t\tfrom\n\t\t\t\t\"permission\" p2\n\t\t\twhere\n\t\t\t\tp2.permission_name = 'user.student.read'\n\t\t\t\tand p2.resource_path = current_setting('permission.resource_path'))\n\t\tand usp.\"user_id\" = students.student_id\n\t\tand usp.deleted_at is null\n\tlimit 1\n\t)\n)\n;"
                        },
                        {
                            "name": "rls_students_update_location",
                            "content": "CREATE POLICY rls_students_update_location ON \"students\" AS PERMISSIVE FOR update TO PUBLIC\nusing (\ntrue \u003c= (\n\tselect\t\t\t\n\t\ttrue\n\tfrom\n\t\t\t\t\tgranted_permissions p\n\tjoin user_access_paths usp on\n\t\t\t\t\tusp.location_id = p.location_id\n\twhere\n\t\tp.user_id = current_setting('app.user_id')\n\t\tand p.permission_id = (\n\t\t\tselect\n\t\t\t\tp2.permission_id\n\t\t\tfrom\n\t\t\t\t\"permission\" p2\n\t\t\twhere\n\t\t\t\tp2.permission_name = 'user.student.write'\n\t\t\t\tand p2.resource_path = current_setting('permission.resource_path'))\n\t\tand usp.\"user_id\" = students.student_id\n\t\tand usp.deleted_at is null\n\tlimit 1\n\t)\n)with check (\ntrue \u003c= (\n\tselect\t\t\t\n\t\ttrue\n\tfrom\n\t\t\t\t\tgranted_permissions p\n\tjoin user_access_paths usp on\n\t\t\t\t\tusp.location_id = p.location_id\n\twhere\n\t\tp.user_id = current_setting('app.user_id')\n\t\tand p.permission_id = (\n\t\t\tselect\n\t\t\t\tp2.permission_id\n\t\t\tfrom\n\t\t\t\t\"permission\" p2\n\t\t\twhere\n\t\t\t\tp2.permission_name = 'user.student.write'\n\t\t\t\tand p2.resource_path = current_setting('permission.resource_path'))\n\t\tand usp.\"user_id\" = students.student_id\n\t\tand usp.deleted_at is null\n\tlimit 1\n\t)\n)\n;"
                        },
                        {
                            "name": "rls_students_delete_location",
                            "content": "CREATE POLICY rls_students_delete_location ON \"students\" AS PERMISSIVE FOR delete TO PUBLIC\nusing (\ntrue \u003c= (\n\tselect\t\t\t\n\t\ttrue\n\tfrom\n\t\t\t\t\tgranted_permissions p\n\tjoin user_access_paths usp on\n\t\t\t\t\tusp.location_id = p.location_id\n\twhere\n\t\tp.user_id = current_setting('app.user_id')\n\t\tand p.permission_id = (\n\t\t\tselect\n\t\t\t\tp2.permission_id\n\t\t\tfrom\n\t\t\t\t\"permission\" p2\n\t\t\twhere\n\t\t\t\tp2.permission_name = 'user.student.write'\n\t\t\t\tand p2.resource_path = current_setting('permission.resource_path'))\n\t\tand usp.\"user_id\" = students.student_id\n\t\tand usp.deleted_at is null\n\tlimit 1\n\t)\n)\n;"
                        },
                        {
                            "name": "rls_students_insert_location",
                            "content": "CREATE POLICY rls_students_insert_location ON \"students\" AS PERMISSIVE FOR INSERT TO PUBLIC\nwith check (\n\t1 = 1\n);\n"
                        }
                    ]
                },
                "accessPathTable": {
                    "name": "user_access_paths",
                    "columnMapping": {
                        "student_id": "user_id"
                    }
                },
                "locationCol": "location_id",
                "permissionPrefix": "user.student",
                "permissions": {
                    "postgres": [],
                    "hasura": []
                },
                "ownerCol": null,
                "use_custom_policy": null,
                "hasura_policies": null,
                "postgres_policies": null,
                "use_custom_hasura_policy": null
            }
        ]
    },
    {
        "filename": "accesscontrol/bob/users.user_access_paths.yaml",
        "service": "bob",
        "revision": 1,
        "table_name": "user_access_paths",
        "created_at": "2022-12-07T15:22:00.190600774+07:00",
        "updated_at": "2022-12-07T15:22:00.190600861+07:00",
        "stages": [
            {
                "template": "1",
                "hasura": {
                    "stage_dir": "deployments/helm/manabie-all-in-one/charts/bob/files/hasura/metadata/tables.yaml",
                    "permissions": [
                        "SELECT",
                        "INSERT",
                        "UPDATE",
                        "DELETE"
                    ],
                    "relationship": "user_access_paths_location_permission",
                    "first_level_query": "user_access_paths_location_permission",
                    "hasura_policies": {
                        "select_permission": [
                            {
                                "name": "MANABIE",
                                "filter": {
                                    "user_access_paths_location_permission": {
                                        "_and": [
                                            {
                                                "user_id": {
                                                    "_eq": "X-Hasura-User-Id"
                                                }
                                            },
                                            {
                                                "permission_name": {
                                                    "_eq": "user.user.read"
                                                }
                                            }
                                        ]
                                    }
                                }
                            },
                            {
                                "name": "USER_GROUP_SCHOOL_ADMIN",
                                "filter": {
                                    "user_access_paths_location_permission": {
                                        "_and": [
                                            {
                                                "user_id": {
                                                    "_eq": "X-Hasura-User-Id"
                                                }
                                            },
                                            {
                                                "permission_name": {
                                                    "_eq": "user.user.read"
                                                }
                                            }
                                        ]
                                    }
                                }
                            },
                            {
                                "name": "USER_GROUP_TEACHER",
                                "filter": {
                                    "user_access_paths_location_permission": {
                                        "_and": [
                                            {
                                                "user_id": {
                                                    "_eq": "X-Hasura-User-Id"
                                                }
                                            },
                                            {
                                                "permission_name": {
                                                    "_eq": "user.user.read"
                                                }
                                            }
                                        ]
                                    }
                                }
                            }
                        ],
                        "insert_permission": [],
                        "delete_permission": [],
                        "update_permission": []
                    }
                },
                "postgres": {
                    "stage_dir": "migrations/bob/1420_migrate.up.sql",
                    "policies": [
                        {
                            "name": "rls_user_access_paths_location",
                            "content": "DROP POLICY IF EXISTS rls_user_access_paths on \"user_access_paths\";\nCREATE POLICY rls_user_access_paths_location ON \"user_access_paths\" AS PERMISSIVE FOR ALL TO PUBLIC\nusing (\n\tlocation_id in (\n\t\tselect\t\t\t\n\t\t\tp.location_id\n\t\tfrom\n\t\t\t\t\t\tgranted_permissions p\n\t\twhere\n\t\t\tp.user_id = current_setting('app.user_id')\n\t\t\tand p.permission_id = (\n\t\t\t\tselect\n\t\t\t\t\tp2.permission_id\n\t\t\t\tfrom\n\t\t\t\t\t\"permission\" p2\n\t\t\t\twhere\n\t\t\t\t\tp2.permission_name = 'user.user.read'\n\t\t\t\t\tand p2.resource_path = current_setting('permission.resource_path'))\n\t\t)\n)\nwith check (\n\tlocation_id in (\n\t\tselect\t\t\t\n\t\t\tp.location_id\n\t\tfrom\n\t\t\t\t\t\tgranted_permissions p\n\t\twhere\n\t\t\tp.user_id = current_setting('app.user_id')\n\t\t\tand p.permission_id = (\n\t\t\t\tselect\n\t\t\t\t\tp2.permission_id\n\t\t\t\tfrom\n\t\t\t\t\t\"permission\" p2\n\t\t\t\twhere\n\t\t\t\t\tp2.permission_name = 'user.user.write'\n\t\t\t\t\tand p2.resource_path = current_setting('permission.resource_path'))\n\t\t)\n);"
                        }
                    ]
                },
                "accessPathTable": null,
                "locationCol": null,
                "permissionPrefix": "user.user",
                "permissions": {
                    "postgres": [],
                    "hasura": []
                },
                "ownerCol": null,
                "use_custom_policy": null,
                "hasura_policies": null,
                "postgres_policies": null,
                "use_custom_hasura_policy": null
            }
        ]
    },
    {
        "filename": "accesscontrol/bob/users.users.yaml",
        "service": "bob",
        "revision": 1,
        "table_name": "users",
        "created_at": "2022-12-07T15:22:00.228588379+07:00",
        "updated_at": "2022-12-07T15:22:00.228588454+07:00",
        "stages": [
            {
                "template": "1.1",
                "hasura": {
                    "stage_dir": "deployments/helm/manabie-all-in-one/charts/bob/files/hasura/metadata/tables.yaml",
                    "permissions": [
                        "SELECT",
                        "INSERT",
                        "UPDATE",
                        "DELETE"
                    ],
                    "relationship": "users_location_permission",
                    "first_level_query": "user_access_paths",
                    "hasura_policies": {
                        "select_permission": [
                            {
                                "name": "USER_GROUP_ADMIN",
                                "filter": {
                                    "user_access_paths": {
                                        "_and": [
                                            {
                                                "users_location_permission": {
                                                    "_and": [
                                                        {
                                                            "user_id": {
                                                                "_eq": "X-Hasura-User-Id"
                                                            }
                                                        },
                                                        {
                                                            "permission_name": {
                                                                "_eq": "user.user.read"
                                                            }
                                                        }
                                                    ]
                                                }
                                            },
                                            {
                                                "deleted_at": {
                                                    "_is_null": true
                                                }
                                            }
                                        ]
                                    }
                                }
                            },
                            {
                                "name": "USER_GROUP_SCHOOL_ADMIN",
                                "filter": {
                                    "user_access_paths": {
                                        "_and": [
                                            {
                                                "users_location_permission": {
                                                    "_and": [
                                                        {
                                                            "user_id": {
                                                                "_eq": "X-Hasura-User-Id"
                                                            }
                                                        },
                                                        {
                                                            "permission_name": {
                                                                "_eq": "user.user.read"
                                                            }
                                                        }
                                                    ]
                                                }
                                            },
                                            {
                                                "deleted_at": {
                                                    "_is_null": true
                                                }
                                            }
                                        ]
                                    }
                                }
                            },
                            {
                                "name": "USER_GROUP_TEACHER",
                                "filter": {
                                    "user_access_paths": {
                                        "_and": [
                                            {
                                                "users_location_permission": {
                                                    "_and": [
                                                        {
                                                            "user_id": {
                                                                "_eq": "X-Hasura-User-Id"
                                                            }
                                                        },
                                                        {
                                                            "permission_name": {
                                                                "_eq": "user.user.read"
                                                            }
                                                        }
                                                    ]
                                                }
                                            },
                                            {
                                                "deleted_at": {
                                                    "_is_null": true
                                                }
                                            }
                                        ]
                                    }
                                }
                            }
                        ],
                        "insert_permission": [],
                        "delete_permission": [],
                        "update_permission": []
                    }
                },
                "postgres": {
                    "stage_dir": "migrations/bob/1421_migrate.up.sql",
                    "policies": [
                        {
                            "name": "rls_users_select_location",
                            "content": "CREATE POLICY rls_users_select_location ON \"users\" AS PERMISSIVE FOR select TO PUBLIC\nusing (\ntrue \u003c= (\n\tselect\t\t\t\n\t\ttrue\n\tfrom\n\t\t\t\t\tgranted_permissions p\n\tjoin user_access_paths usp on\n\t\t\t\t\tusp.location_id = p.location_id\n\twhere\n\t\tp.user_id = current_setting('app.user_id')\n\t\tand p.permission_id = (\n\t\t\tselect\n\t\t\t\tp2.permission_id\n\t\t\tfrom\n\t\t\t\t\"permission\" p2\n\t\t\twhere\n\t\t\t\tp2.permission_name = 'user.user.read'\n\t\t\t\tand p2.resource_path = current_setting('permission.resource_path'))\n\t\tand usp.\"user_id\" = users.user_id\n\t\tand usp.deleted_at is null\n\tlimit 1\n\t)\n)\n;"
                        },
                        {
                            "name": "rls_users_update_location",
                            "content": "CREATE POLICY rls_users_update_location ON \"users\" AS PERMISSIVE FOR update TO PUBLIC\nusing (\ntrue \u003c= (\n\tselect\t\t\t\n\t\ttrue\n\tfrom\n\t\t\t\t\tgranted_permissions p\n\tjoin user_access_paths usp on\n\t\t\t\t\tusp.location_id = p.location_id\n\twhere\n\t\tp.user_id = current_setting('app.user_id')\n\t\tand p.permission_id = (\n\t\t\tselect\n\t\t\t\tp2.permission_id\n\t\t\tfrom\n\t\t\t\t\"permission\" p2\n\t\t\twhere\n\t\t\t\tp2.permission_name = 'user.user.write'\n\t\t\t\tand p2.resource_path = current_setting('permission.resource_path'))\n\t\tand usp.\"user_id\" = users.user_id\n\t\tand usp.deleted_at is null\n\tlimit 1\n\t)\n)with check (\ntrue \u003c= (\n\tselect\t\t\t\n\t\ttrue\n\tfrom\n\t\t\t\t\tgranted_permissions p\n\tjoin user_access_paths usp on\n\t\t\t\t\tusp.location_id = p.location_id\n\twhere\n\t\tp.user_id = current_setting('app.user_id')\n\t\tand p.permission_id = (\n\t\t\tselect\n\t\t\t\tp2.permission_id\n\t\t\tfrom\n\t\t\t\t\"permission\" p2\n\t\t\twhere\n\t\t\t\tp2.permission_name = 'user.user.write'\n\t\t\t\tand p2.resource_path = current_setting('permission.resource_path'))\n\t\tand usp.\"user_id\" = users.user_id\n\t\tand usp.deleted_at is null\n\tlimit 1\n\t)\n)\n;"
                        },
                        {
                            "name": "rls_users_delete_location",
                            "content": "CREATE POLICY rls_users_delete_location ON \"users\" AS PERMISSIVE FOR delete TO PUBLIC\nusing (\ntrue \u003c= (\n\tselect\t\t\t\n\t\ttrue\n\tfrom\n\t\t\t\t\tgranted_permissions p\n\tjoin user_access_paths usp on\n\t\t\t\t\tusp.location_id = p.location_id\n\twhere\n\t\tp.user_id = current_setting('app.user_id')\n\t\tand p.permission_id = (\n\t\t\tselect\n\t\t\t\tp2.permission_id\n\t\t\tfrom\n\t\t\t\t\"permission\" p2\n\t\t\twhere\n\t\t\t\tp2.permission_name = 'user.user.write'\n\t\t\t\tand p2.resource_path = current_setting('permission.resource_path'))\n\t\tand usp.\"user_id\" = users.user_id\n\t\tand usp.deleted_at is null\n\tlimit 1\n\t)\n)\n;"
                        },
                        {
                            "name": "rls_users_insert_location",
                            "content": "CREATE POLICY rls_users_insert_location ON \"users\" AS PERMISSIVE FOR INSERT TO PUBLIC\nwith check (\n\t1 = 1\n);\n"
                        }
                    ]
                },
                "accessPathTable": {
                    "name": "user_access_paths",
                    "columnMapping": {
                        "user_id": "user_id"
                    }
                },
                "locationCol": "location_id",
                "permissionPrefix": "user.user",
                "permissions": {
                    "postgres": [],
                    "hasura": []
                },
                "ownerCol": null,
                "use_custom_policy": null,
                "hasura_policies": null,
                "postgres_policies": null,
                "use_custom_hasura_policy": null
            },
            {
                "template": "4",
                "hasura": {
                    "stage_dir": "deployments/helm/manabie-all-in-one/charts/bob/files/hasura/metadata/tables.yaml",
                    "permissions": [
                        "SELECT",
                        "INSERT",
                        "UPDATE",
                        "DELETE"
                    ],
                    "relationship": "users_location_permission",
                    "first_level_query": "user_id",
                    "hasura_policies": {
                        "select_permission": [
                            {
                                "name": "USER_GROUP_ADMIN",
                                "filter": {
                                    "user_id": {
                                        "_eq": "X-Hasura-User-Id"
                                    }
                                }
                            },
                            {
                                "name": "USER_GROUP_SCHOOL_ADMIN",
                                "filter": {
                                    "user_id": {
                                        "_eq": "X-Hasura-User-Id"
                                    }
                                }
                            },
                            {
                                "name": "USER_GROUP_TEACHER",
                                "filter": {
                                    "user_id": {
                                        "_eq": "X-Hasura-User-Id"
                                    }
                                }
                            }
                        ],
                        "insert_permission": [],
                        "delete_permission": [],
                        "update_permission": []
                    }
                },
                "postgres": {
                    "stage_dir": "migrations/bob/1422_migrate.up.sql",
                    "policies": [
                        {
                            "name": "rls_users_permission_v4",
                            "content": "DROP POLICY IF EXISTS rls_users on \"users\";\nCREATE POLICY rls_users_permission_v4 ON \"users\" AS PERMISSIVE FOR ALL TO PUBLIC\nusing (\n\tcurrent_setting('app.user_id') = user_id\n)\nwith check (\n\tcurrent_setting('app.user_id') = user_id\n);"
                        }
                    ]
                },
                "accessPathTable": null,
                "locationCol": null,
                "permissionPrefix": null,
                "permissions": {
                    "postgres": [],
                    "hasura": []
                },
                "ownerCol": "user_id",
                "use_custom_policy": null,
                "hasura_policies": null,
                "postgres_policies": null,
                "use_custom_hasura_policy": null
            }
        ]
    },
    {
        "filename": "accesscontrol/entryexitmgmt/entryexit.student_entryexit_records.yaml",
        "service": "entryexitmgmt",
        "revision": 1,
        "table_name": "student_entryexit_records",
        "created_at": "2022-12-20T09:07:11.852492594+08:00",
        "updated_at": "2022-12-20T09:07:11.852492673+08:00",
        "stages": [
            {
                "template": "1",
                "hasura": {
                    "stage_dir": "deployments/helm/manabie-all-in-one/charts/entryexitmgmt/files/hasura/metadata/tables.yaml",
                    "permissions": [
                        "SELECT",
                        "INSERT",
                        "UPDATE",
                        "DELETE"
                    ],
                    "relationship": "student_entryexit_records_location_permission",
                    "first_level_query": "user_access_paths",
                    "hasura_policies": {
                        "select_permission": [
                            {
                                "name": "MANABIE",
                                "filter": {
                                    "user_access_paths": {
                                        "_and": [
                                            {
                                                "student_entryexit_records_location_permission": {
                                                    "_and": [
                                                        {
                                                            "user_id": {
                                                                "_eq": "X-Hasura-User-Id"
                                                            }
                                                        },
                                                        {
                                                            "permission_name": {
                                                                "_eq": "entryexit.student_entryexit_records.read"
                                                            }
                                                        }
                                                    ]
                                                }
                                            },
                                            {
                                                "deleted_at": {
                                                    "_is_null": true
                                                }
                                            }
                                        ]
                                    }
                                }
                            },
                            {
                                "name": "USER_GROUP_ADMIN",
                                "filter": {
                                    "user_access_paths": {
                                        "_and": [
                                            {
                                                "student_entryexit_records_location_permission": {
                                                    "_and": [
                                                        {
                                                            "user_id": {
                                                                "_eq": "X-Hasura-User-Id"
                                                            }
                                                        },
                                                        {
                                                            "permission_name": {
                                                                "_eq": "entryexit.student_entryexit_records.read"
                                                            }
                                                        }
                                                    ]
                                                }
                                            },
                                            {
                                                "deleted_at": {
                                                    "_is_null": true
                                                }
                                            }
                                        ]
                                    }
                                }
                            },
                            {
                                "name": "USER_GROUP_SCHOOL_ADMIN",
                                "filter": {
                                    "user_access_paths": {
                                        "_and": [
                                            {
                                                "student_entryexit_records_location_permission": {
                                                    "_and": [
                                                        {
                                                            "user_id": {
                                                                "_eq": "X-Hasura-User-Id"
                                                            }
                                                        },
                                                        {
                                                            "permission_name": {
                                                                "_eq": "entryexit.student_entryexit_records.read"
                                                            }
                                                        }
                                                    ]
                                                }
                                            },
                                            {
                                                "deleted_at": {
                                                    "_is_null": true
                                                }
                                            }
                                        ]
                                    }
                                }
                            },
                            {
                                "name": "USER_GROUP_TEACHER",
                                "filter": {
                                    "user_access_paths": {
                                        "_and": [
                                            {
                                                "student_entryexit_records_location_permission": {
                                                    "_and": [
                                                        {
                                                            "user_id": {
                                                                "_eq": "X-Hasura-User-Id"
                                                            }
                                                        },
                                                        {
                                                            "permission_name": {
                                                                "_eq": "entryexit.student_entryexit_records.read"
                                                            }
                                                        }
                                                    ]
                                                }
                                            },
                                            {
                                                "deleted_at": {
                                                    "_is_null": true
                                                }
                                            }
                                        ]
                                    }
                                }
                            }
                        ],
                        "insert_permission": [],
                        "delete_permission": [],
                        "update_permission": []
                    }
                },
                "postgres": {
                    "stage_dir": "migrations/entryexitmgmt/1027_migrate.up.sql",
                    "policies": [
                        {
                            "name": "rls_student_entryexit_records_location",
                            "content": "DROP POLICY IF EXISTS rls_student_entryexit_records on \"student_entryexit_records\";\nCREATE POLICY rls_student_entryexit_records_location ON \"student_entryexit_records\" AS PERMISSIVE FOR ALL TO PUBLIC\nusing (\ntrue \u003c= (\n\tselect\t\t\t\n\t\ttrue\n\tfrom\n\t\t\t\t\tgranted_permissions p\n\tjoin user_access_paths usp on\n\t\t\t\t\tusp.location_id = p.location_id\n\twhere\n\t\tp.user_id = current_setting('app.user_id')\n\t\tand p.permission_id = (\n\t\t\tselect\n\t\t\t\tp2.permission_id\n\t\t\tfrom\n\t\t\t\t\"permission\" p2\n\t\t\twhere\n\t\t\t\tp2.permission_name = 'entryexit.student_entryexit_records.read'\n\t\t\t\tand p2.resource_path = current_setting('permission.resource_path'))\n\t\tand usp.\"user_id\" = student_entryexit_records.student_id\n\t\tand usp.deleted_at is null\n\tlimit 1\n\t)\n)\nwith check (\ntrue \u003c= (\n\tselect\t\t\t\n\t\ttrue\n\tfrom\n\t\t\t\t\tgranted_permissions p\n\tjoin user_access_paths usp on\n\t\t\t\t\tusp.location_id = p.location_id\n\twhere\n\t\tp.user_id = current_setting('app.user_id')\n\t\tand p.permission_id = (\n\t\t\tselect\n\t\t\t\tp2.permission_id\n\t\t\tfrom\n\t\t\t\t\"permission\" p2\n\t\t\twhere\n\t\t\t\tp2.permission_name = 'entryexit.student_entryexit_records.write'\n\t\t\t\tand p2.resource_path = current_setting('permission.resource_path'))\n\t\tand usp.\"user_id\" = student_entryexit_records.student_id\n\t\tand usp.deleted_at is null\n\tlimit 1\n\t)\n);"
                        }
                    ]
                },
                "accessPathTable": {
                    "name": "user_access_paths",
                    "columnMapping": {
                        "student_id": "user_id"
                    }
                },
                "locationCol": "location_id",
                "permissionPrefix": "entryexit.student_entryexit_records",
                "permissions": {
                    "postgres": [],
                    "hasura": []
                },
                "ownerCol": null,
                "use_custom_policy": null,
                "hasura_policies": null,
                "postgres_policies": null,
                "use_custom_hasura_policy": null
            }
        ]
    },
    {
        "filename": "accesscontrol/entryexitmgmt/entryexit.student_qr.yaml",
        "service": "entryexitmgmt",
        "revision": 1,
        "table_name": "student_qr",
        "created_at": "2022-12-20T09:07:11.857325944+08:00",
        "updated_at": "2022-12-20T09:07:11.857326061+08:00",
        "stages": [
            {
                "template": "1",
                "hasura": {
                    "stage_dir": "deployments/helm/manabie-all-in-one/charts/entryexitmgmt/files/hasura/metadata/tables.yaml",
                    "permissions": [
                        "SELECT",
                        "INSERT",
                        "UPDATE",
                        "DELETE"
                    ],
                    "relationship": "student_qr_location_permission",
                    "first_level_query": "user_access_paths",
                    "hasura_policies": {
                        "select_permission": [
                            {
                                "name": "MANABIE",
                                "filter": {
                                    "user_access_paths": {
                                        "_and": [
                                            {
                                                "student_qr_location_permission": {
                                                    "_and": [
                                                        {
                                                            "user_id": {
                                                                "_eq": "X-Hasura-User-Id"
                                                            }
                                                        },
                                                        {
                                                            "permission_name": {
                                                                "_eq": "entryexit.student_qr.read"
                                                            }
                                                        }
                                                    ]
                                                }
                                            },
                                            {
                                                "deleted_at": {
                                                    "_is_null": true
                                                }
                                            }
                                        ]
                                    }
                                }
                            },
                            {
                                "name": "USER_GROUP_ADMIN",
                                "filter": {
                                    "user_access_paths": {
                                        "_and": [
                                            {
                                                "student_qr_location_permission": {
                                                    "_and": [
                                                        {
                                                            "user_id": {
                                                                "_eq": "X-Hasura-User-Id"
                                                            }
                                                        },
                                                        {
                                                            "permission_name": {
                                                                "_eq": "entryexit.student_qr.read"
                                                            }
                                                        }
                                                    ]
                                                }
                                            },
                                            {
                                                "deleted_at": {
                                                    "_is_null": true
                                                }
                                            }
                                        ]
                                    }
                                }
                            },
                            {
                                "name": "USER_GROUP_SCHOOL_ADMIN",
                                "filter": {
                                    "user_access_paths": {
                                        "_and": [
                                            {
                                                "student_qr_location_permission": {
                                                    "_and": [
                                                        {
                                                            "user_id": {
                                                                "_eq": "X-Hasura-User-Id"
                                                            }
                                                        },
                                                        {
                                                            "permission_name": {
                                                                "_eq": "entryexit.student_qr.read"
                                                            }
                                                        }
                                                    ]
                                                }
                                            },
                                            {
                                                "deleted_at": {
                                                    "_is_null": true
                                                }
                                            }
                                        ]
                                    }
                                }
                            },
                            {
                                "name": "USER_GROUP_TEACHER",
                                "filter": {
                                    "user_access_paths": {
                                        "_and": [
                                            {
                                                "student_qr_location_permission": {
                                                    "_and": [
                                                        {
                                                            "user_id": {
                                                                "_eq": "X-Hasura-User-Id"
                                                            }
                                                        },
                                                        {
                                                            "permission_name": {
                                                                "_eq": "entryexit.student_qr.read"
                                                            }
                                                        }
                                                    ]
                                                }
                                            },
                                            {
                                                "deleted_at": {
                                                    "_is_null": true
                                                }
                                            }
                                        ]
                                    }
                                }
                            }
                        ],
                        "insert_permission": [],
                        "delete_permission": [],
                        "update_permission": []
                    }
                },
                "postgres": {
                    "stage_dir": "migrations/entryexitmgmt/1028_migrate.up.sql",
                    "policies": [
                        {
                            "name": "rls_student_qr_location",
                            "content": "DROP POLICY IF EXISTS rls_student_qr on \"student_qr\";\nCREATE POLICY rls_student_qr_location ON \"student_qr\" AS PERMISSIVE FOR ALL TO PUBLIC\nusing (\ntrue \u003c= (\n\tselect\t\t\t\n\t\ttrue\n\tfrom\n\t\t\t\t\tgranted_permissions p\n\tjoin user_access_paths usp on\n\t\t\t\t\tusp.location_id = p.location_id\n\twhere\n\t\tp.user_id = current_setting('app.user_id')\n\t\tand p.permission_id = (\n\t\t\tselect\n\t\t\t\tp2.permission_id\n\t\t\tfrom\n\t\t\t\t\"permission\" p2\n\t\t\twhere\n\t\t\t\tp2.permission_name = 'entryexit.student_qr.read'\n\t\t\t\tand p2.resource_path = current_setting('permission.resource_path'))\n\t\tand usp.\"user_id\" = student_qr.student_id\n\t\tand usp.deleted_at is null\n\tlimit 1\n\t)\n)\nwith check (\ntrue \u003c= (\n\tselect\t\t\t\n\t\ttrue\n\tfrom\n\t\t\t\t\tgranted_permissions p\n\tjoin user_access_paths usp on\n\t\t\t\t\tusp.location_id = p.location_id\n\twhere\n\t\tp.user_id = current_setting('app.user_id')\n\t\tand p.permission_id = (\n\t\t\tselect\n\t\t\t\tp2.permission_id\n\t\t\tfrom\n\t\t\t\t\"permission\" p2\n\t\t\twhere\n\t\t\t\tp2.permission_name = 'entryexit.student_qr.write'\n\t\t\t\tand p2.resource_path = current_setting('permission.resource_path'))\n\t\tand usp.\"user_id\" = student_qr.student_id\n\t\tand usp.deleted_at is null\n\tlimit 1\n\t)\n);"
                        }
                    ]
                },
                "accessPathTable": {
                    "name": "user_access_paths",
                    "columnMapping": {
                        "student_id": "user_id"
                    }
                },
                "locationCol": "location_id",
                "permissionPrefix": "entryexit.student_qr",
                "permissions": {
                    "postgres": [],
                    "hasura": []
                },
                "ownerCol": null,
                "use_custom_policy": null,
                "hasura_policies": null,
                "postgres_policies": null,
                "use_custom_hasura_policy": null
            }
        ]
    },
    {
        "filename": "accesscontrol/entryexitmgmt/users.students.yaml",
        "service": "entryexitmgmt",
        "revision": 1,
        "table_name": "students",
        "created_at": "2022-12-20T09:07:11.861250738+08:00",
        "updated_at": "2022-12-20T09:07:11.861250878+08:00",
        "stages": [
            {
                "template": "1.1",
                "hasura": {
                    "stage_dir": "deployments/helm/manabie-all-in-one/charts/entryexitmgmt/files/hasura/metadata/tables.yaml",
                    "permissions": [
                        "SELECT",
                        "INSERT",
                        "UPDATE",
                        "DELETE"
                    ],
                    "relationship": "students_location_permission",
                    "first_level_query": "user_access_paths",
                    "hasura_policies": {
                        "select_permission": [
                            {
                                "name": "MANABIE",
                                "filter": {
                                    "user_access_paths": {
                                        "_and": [
                                            {
                                                "students_location_permission": {
                                                    "_and": [
                                                        {
                                                            "user_id": {
                                                                "_eq": "X-Hasura-User-Id"
                                                            }
                                                        },
                                                        {
                                                            "permission_name": {
                                                                "_eq": "user.student.read"
                                                            }
                                                        }
                                                    ]
                                                }
                                            },
                                            {
                                                "deleted_at": {
                                                    "_is_null": true
                                                }
                                            }
                                        ]
                                    }
                                }
                            },
                            {
                                "name": "USER_GROUP_ADMIN",
                                "filter": {
                                    "user_access_paths": {
                                        "_and": [
                                            {
                                                "students_location_permission": {
                                                    "_and": [
                                                        {
                                                            "user_id": {
                                                                "_eq": "X-Hasura-User-Id"
                                                            }
                                                        },
                                                        {
                                                            "permission_name": {
                                                                "_eq": "user.student.read"
                                                            }
                                                        }
                                                    ]
                                                }
                                            },
                                            {
                                                "deleted_at": {
                                                    "_is_null": true
                                                }
                                            }
                                        ]
                                    }
                                }
                            },
                            {
                                "name": "USER_GROUP_SCHOOL_ADMIN",
                                "filter": {
                                    "user_access_paths": {
                                        "_and": [
                                            {
                                                "students_location_permission": {
                                                    "_and": [
                                                        {
                                                            "user_id": {
                                                                "_eq": "X-Hasura-User-Id"
                                                            }
                                                        },
                                                        {
                                                            "permission_name": {
                                                                "_eq": "user.student.read"
                                                            }
                                                        }
                                                    ]
                                                }
                                            },
                                            {
                                                "deleted_at": {
                                                    "_is_null": true
                                                }
                                            }
                                        ]
                                    }
                                }
                            },
                            {
                                "name": "USER_GROUP_TEACHER",
                                "filter": {
                                    "user_access_paths": {
                                        "_and": [
                                            {
                                                "students_location_permission": {
                                                    "_and": [
                                                        {
                                                            "user_id": {
                                                                "_eq": "X-Hasura-User-Id"
                                                            }
                                                        },
                                                        {
                                                            "permission_name": {
                                                                "_eq": "user.student.read"
                                                            }
                                                        }
                                                    ]
                                                }
                                            },
                                            {
                                                "deleted_at": {
                                                    "_is_null": true
                                                }
                                            }
                                        ]
                                    }
                                }
                            }
                        ],
                        "insert_permission": [],
                        "delete_permission": [],
                        "update_permission": []
                    }
                },
                "postgres": {
                    "stage_dir": "migrations/entryexitmgmt/1029_migrate.up.sql",
                    "policies": [
                        {
                            "name": "rls_students_select_location",
                            "content": "CREATE POLICY rls_students_select_location ON \"students\" AS PERMISSIVE FOR select TO PUBLIC\nusing (\ntrue \u003c= (\n\tselect\t\t\t\n\t\ttrue\n\tfrom\n\t\t\t\t\tgranted_permissions p\n\tjoin user_access_paths usp on\n\t\t\t\t\tusp.location_id = p.location_id\n\twhere\n\t\tp.user_id = current_setting('app.user_id')\n\t\tand p.permission_id = (\n\t\t\tselect\n\t\t\t\tp2.permission_id\n\t\t\tfrom\n\t\t\t\t\"permission\" p2\n\t\t\twhere\n\t\t\t\tp2.permission_name = 'user.student.read'\n\t\t\t\tand p2.resource_path = current_setting('permission.resource_path'))\n\t\tand usp.\"user_id\" = students.student_id\n\t\tand usp.deleted_at is null\n\tlimit 1\n\t)\n)\n;"
                        },
                        {
                            "name": "rls_students_update_location",
                            "content": "CREATE POLICY rls_students_update_location ON \"students\" AS PERMISSIVE FOR update TO PUBLIC\nusing (\ntrue \u003c= (\n\tselect\t\t\t\n\t\ttrue\n\tfrom\n\t\t\t\t\tgranted_permissions p\n\tjoin user_access_paths usp on\n\t\t\t\t\tusp.location_id = p.location_id\n\twhere\n\t\tp.user_id = current_setting('app.user_id')\n\t\tand p.permission_id = (\n\t\t\tselect\n\t\t\t\tp2.permission_id\n\t\t\tfrom\n\t\t\t\t\"permission\" p2\n\t\t\twhere\n\t\t\t\tp2.permission_name = 'user.student.write'\n\t\t\t\tand p2.resource_path = current_setting('permission.resource_path'))\n\t\tand usp.\"user_id\" = students.student_id\n\t\tand usp.deleted_at is null\n\tlimit 1\n\t)\n)with check (\ntrue \u003c= (\n\tselect\t\t\t\n\t\ttrue\n\tfrom\n\t\t\t\t\tgranted_permissions p\n\tjoin user_access_paths usp on\n\t\t\t\t\tusp.location_id = p.location_id\n\twhere\n\t\tp.user_id = current_setting('app.user_id')\n\t\tand p.permission_id = (\n\t\t\tselect\n\t\t\t\tp2.permission_id\n\t\t\tfrom\n\t\t\t\t\"permission\" p2\n\t\t\twhere\n\t\t\t\tp2.permission_name = 'user.student.write'\n\t\t\t\tand p2.resource_path = current_setting('permission.resource_path'))\n\t\tand usp.\"user_id\" = students.student_id\n\t\tand usp.deleted_at is null\n\tlimit 1\n\t)\n)\n;"
                        },
                        {
                            "name": "rls_students_delete_location",
                            "content": "CREATE POLICY rls_students_delete_location ON \"students\" AS PERMISSIVE FOR delete TO PUBLIC\nusing (\ntrue \u003c= (\n\tselect\t\t\t\n\t\ttrue\n\tfrom\n\t\t\t\t\tgranted_permissions p\n\tjoin user_access_paths usp on\n\t\t\t\t\tusp.location_id = p.location_id\n\twhere\n\t\tp.user_id = current_setting('app.user_id')\n\t\tand p.permission_id = (\n\t\t\tselect\n\t\t\t\tp2.permission_id\n\t\t\tfrom\n\t\t\t\t\"permission\" p2\n\t\t\twhere\n\t\t\t\tp2.permission_name = 'user.student.write'\n\t\t\t\tand p2.resource_path = current_setting('permission.resource_path'))\n\t\tand usp.\"user_id\" = students.student_id\n\t\tand usp.deleted_at is null\n\tlimit 1\n\t)\n)\n;"
                        },
                        {
                            "name": "rls_students_insert_location",
                            "content": "CREATE POLICY rls_students_insert_location ON \"students\" AS PERMISSIVE FOR INSERT TO PUBLIC\nwith check (\n\t1 = 1\n);\n"
                        }
                    ]
                },
                "accessPathTable": {
                    "name": "user_access_paths",
                    "columnMapping": {
                        "student_id": "user_id"
                    }
                },
                "locationCol": "location_id",
                "permissionPrefix": "user.student",
                "permissions": {
                    "postgres": [],
                    "hasura": []
                },
                "ownerCol": null,
                "use_custom_policy": null,
                "hasura_policies": null,
                "postgres_policies": null,
                "use_custom_hasura_policy": null
            }
        ]
    },
    {
        "filename": "accesscontrol/entryexitmgmt/users.user_access_paths.yaml",
        "service": "entryexitmgmt",
        "revision": 1,
        "table_name": "user_access_paths",
        "created_at": "2022-12-20T09:07:11.872115787+08:00",
        "updated_at": "2022-12-20T09:07:11.872115902+08:00",
        "stages": [
            {
                "template": "1",
                "hasura": {
                    "stage_dir": "deployments/helm/manabie-all-in-one/charts/entryexitmgmt/files/hasura/metadata/tables.yaml",
                    "permissions": [
                        "SELECT",
                        "INSERT",
                        "UPDATE",
                        "DELETE"
                    ],
                    "relationship": "user_access_paths_location_permission",
                    "first_level_query": "user_access_paths_location_permission",
                    "hasura_policies": {
                        "select_permission": [
                            {
                                "name": "MANABIE",
                                "filter": {
                                    "user_access_paths_location_permission": {
                                        "_and": [
                                            {
                                                "user_id": {
                                                    "_eq": "X-Hasura-User-Id"
                                                }
                                            },
                                            {
                                                "permission_name": {
                                                    "_eq": "user.user.read"
                                                }
                                            }
                                        ]
                                    }
                                }
                            },
                            {
                                "name": "USER_GROUP_SCHOOL_ADMIN",
                                "filter": {
                                    "user_access_paths_location_permission": {
                                        "_and": [
                                            {
                                                "user_id": {
                                                    "_eq": "X-Hasura-User-Id"
                                                }
                                            },
                                            {
                                                "permission_name": {
                                                    "_eq": "user.user.read"
                                                }
                                            }
                                        ]
                                    }
                                }
                            },
                            {
                                "name": "USER_GROUP_TEACHER",
                                "filter": {
                                    "user_access_paths_location_permission": {
                                        "_and": [
                                            {
                                                "user_id": {
                                                    "_eq": "X-Hasura-User-Id"
                                                }
                                            },
                                            {
                                                "permission_name": {
                                                    "_eq": "user.user.read"
                                                }
                                            }
                                        ]
                                    }
                                }
                            }
                        ],
                        "insert_permission": [],
                        "delete_permission": [],
                        "update_permission": []
                    }
                },
                "postgres": {
                    "stage_dir": "migrations/entryexitmgmt/1030_migrate.up.sql",
                    "policies": [
                        {
                            "name": "rls_user_access_paths_location",
                            "content": "DROP POLICY IF EXISTS rls_user_access_paths on \"user_access_paths\";\nCREATE POLICY rls_user_access_paths_location ON \"user_access_paths\" AS PERMISSIVE FOR ALL TO PUBLIC\nusing (\n\tlocation_id in (\n\t\tselect\t\t\t\n\t\t\tp.location_id\n\t\tfrom\n\t\t\t\t\t\tgranted_permissions p\n\t\twhere\n\t\t\tp.user_id = current_setting('app.user_id')\n\t\t\tand p.permission_id = (\n\t\t\t\tselect\n\t\t\t\t\tp2.permission_id\n\t\t\t\tfrom\n\t\t\t\t\t\"permission\" p2\n\t\t\t\twhere\n\t\t\t\t\tp2.permission_name = 'user.user.read'\n\t\t\t\t\tand p2.resource_path = current_setting('permission.resource_path'))\n\t\t)\n)\nwith check (\n\tlocation_id in (\n\t\tselect\t\t\t\n\t\t\tp.location_id\n\t\tfrom\n\t\t\t\t\t\tgranted_permissions p\n\t\twhere\n\t\t\tp.user_id = current_setting('app.user_id')\n\t\t\tand p.permission_id = (\n\t\t\t\tselect\n\t\t\t\t\tp2.permission_id\n\t\t\t\tfrom\n\t\t\t\t\t\"permission\" p2\n\t\t\t\twhere\n\t\t\t\t\tp2.permission_name = 'user.user.write'\n\t\t\t\t\tand p2.resource_path = current_setting('permission.resource_path'))\n\t\t)\n);"
                        }
                    ]
                },
                "accessPathTable": null,
                "locationCol": null,
                "permissionPrefix": "user.user",
                "permissions": {
                    "postgres": [],
                    "hasura": []
                },
                "ownerCol": null,
                "use_custom_policy": null,
                "hasura_policies": null,
                "postgres_policies": null,
                "use_custom_hasura_policy": null
            }
        ]
    },
    {
        "filename": "accesscontrol/entryexitmgmt/users.users.yaml",
        "service": "entryexitmgmt",
        "revision": 1,
        "table_name": "users",
        "created_at": "2022-12-20T09:07:11.881920203+08:00",
        "updated_at": "2022-12-20T09:07:11.881920442+08:00",
        "stages": [
            {
                "template": "1.1",
                "hasura": {
                    "stage_dir": "deployments/helm/manabie-all-in-one/charts/entryexitmgmt/files/hasura/metadata/tables.yaml",
                    "permissions": [
                        "SELECT",
                        "INSERT",
                        "UPDATE",
                        "DELETE"
                    ],
                    "relationship": "users_location_permission",
                    "first_level_query": "user_access_paths",
                    "hasura_policies": {
                        "select_permission": [
                            {
                                "name": "USER_GROUP_ADMIN",
                                "filter": {
                                    "user_access_paths": {
                                        "_and": [
                                            {
                                                "users_location_permission": {
                                                    "_and": [
                                                        {
                                                            "user_id": {
                                                                "_eq": "X-Hasura-User-Id"
                                                            }
                                                        },
                                                        {
                                                            "permission_name": {
                                                                "_eq": "user.user.read"
                                                            }
                                                        }
                                                    ]
                                                }
                                            },
                                            {
                                                "deleted_at": {
                                                    "_is_null": true
                                                }
                                            }
                                        ]
                                    }
                                }
                            },
                            {
                                "name": "USER_GROUP_SCHOOL_ADMIN",
                                "filter": {
                                    "user_access_paths": {
                                        "_and": [
                                            {
                                                "users_location_permission": {
                                                    "_and": [
                                                        {
                                                            "user_id": {
                                                                "_eq": "X-Hasura-User-Id"
                                                            }
                                                        },
                                                        {
                                                            "permission_name": {
                                                                "_eq": "user.user.read"
                                                            }
                                                        }
                                                    ]
                                                }
                                            },
                                            {
                                                "deleted_at": {
                                                    "_is_null": true
                                                }
                                            }
                                        ]
                                    }
                                }
                            },
                            {
                                "name": "USER_GROUP_TEACHER",
                                "filter": {
                                    "user_access_paths": {
                                        "_and": [
                                            {
                                                "users_location_permission": {
                                                    "_and": [
                                                        {
                                                            "user_id": {
                                                                "_eq": "X-Hasura-User-Id"
                                                            }
                                                        },
                                                        {
                                                            "permission_name": {
                                                                "_eq": "user.user.read"
                                                            }
                                                        }
                                                    ]
                                                }
                                            },
                                            {
                                                "deleted_at": {
                                                    "_is_null": true
                                                }
                                            }
                                        ]
                                    }
                                }
                            }
                        ],
                        "insert_permission": [],
                        "delete_permission": [],
                        "update_permission": []
                    }
                },
                "postgres": {
                    "stage_dir": "migrations/entryexitmgmt/1031_migrate.up.sql",
                    "policies": [
                        {
                            "name": "rls_users_select_location",
                            "content": "CREATE POLICY rls_users_select_location ON \"users\" AS PERMISSIVE FOR select TO PUBLIC\nusing (\ntrue \u003c= (\n\tselect\t\t\t\n\t\ttrue\n\tfrom\n\t\t\t\t\tgranted_permissions p\n\tjoin user_access_paths usp on\n\t\t\t\t\tusp.location_id = p.location_id\n\twhere\n\t\tp.user_id = current_setting('app.user_id')\n\t\tand p.permission_id = (\n\t\t\tselect\n\t\t\t\tp2.permission_id\n\t\t\tfrom\n\t\t\t\t\"permission\" p2\n\t\t\twhere\n\t\t\t\tp2.permission_name = 'user.user.read'\n\t\t\t\tand p2.resource_path = current_setting('permission.resource_path'))\n\t\tand usp.\"user_id\" = users.user_id\n\t\tand usp.deleted_at is null\n\tlimit 1\n\t)\n)\n;"
                        },
                        {
                            "name": "rls_users_update_location",
                            "content": "CREATE POLICY rls_users_update_location ON \"users\" AS PERMISSIVE FOR update TO PUBLIC\nusing (\ntrue \u003c= (\n\tselect\t\t\t\n\t\ttrue\n\tfrom\n\t\t\t\t\tgranted_permissions p\n\tjoin user_access_paths usp on\n\t\t\t\t\tusp.location_id = p.location_id\n\twhere\n\t\tp.user_id = current_setting('app.user_id')\n\t\tand p.permission_id = (\n\t\t\tselect\n\t\t\t\tp2.permission_id\n\t\t\tfrom\n\t\t\t\t\"permission\" p2\n\t\t\twhere\n\t\t\t\tp2.permission_name = 'user.user.write'\n\t\t\t\tand p2.resource_path = current_setting('permission.resource_path'))\n\t\tand usp.\"user_id\" = users.user_id\n\t\tand usp.deleted_at is null\n\tlimit 1\n\t)\n)with check (\ntrue \u003c= (\n\tselect\t\t\t\n\t\ttrue\n\tfrom\n\t\t\t\t\tgranted_permissions p\n\tjoin user_access_paths usp on\n\t\t\t\t\tusp.location_id = p.location_id\n\twhere\n\t\tp.user_id = current_setting('app.user_id')\n\t\tand p.permission_id = (\n\t\t\tselect\n\t\t\t\tp2.permission_id\n\t\t\tfrom\n\t\t\t\t\"permission\" p2\n\t\t\twhere\n\t\t\t\tp2.permission_name = 'user.user.write'\n\t\t\t\tand p2.resource_path = current_setting('permission.resource_path'))\n\t\tand usp.\"user_id\" = users.user_id\n\t\tand usp.deleted_at is null\n\tlimit 1\n\t)\n)\n;"
                        },
                        {
                            "name": "rls_users_delete_location",
                            "content": "CREATE POLICY rls_users_delete_location ON \"users\" AS PERMISSIVE FOR delete TO PUBLIC\nusing (\ntrue \u003c= (\n\tselect\t\t\t\n\t\ttrue\n\tfrom\n\t\t\t\t\tgranted_permissions p\n\tjoin user_access_paths usp on\n\t\t\t\t\tusp.location_id = p.location_id\n\twhere\n\t\tp.user_id = current_setting('app.user_id')\n\t\tand p.permission_id = (\n\t\t\tselect\n\t\t\t\tp2.permission_id\n\t\t\tfrom\n\t\t\t\t\"permission\" p2\n\t\t\twhere\n\t\t\t\tp2.permission_name = 'user.user.write'\n\t\t\t\tand p2.resource_path = current_setting('permission.resource_path'))\n\t\tand usp.\"user_id\" = users.user_id\n\t\tand usp.deleted_at is null\n\tlimit 1\n\t)\n)\n;"
                        },
                        {
                            "name": "rls_users_insert_location",
                            "content": "CREATE POLICY rls_users_insert_location ON \"users\" AS PERMISSIVE FOR INSERT TO PUBLIC\nwith check (\n\t1 = 1\n);\n"
                        }
                    ]
                },
                "accessPathTable": {
                    "name": "user_access_paths",
                    "columnMapping": {
                        "user_id": "user_id"
                    }
                },
                "locationCol": "location_id",
                "permissionPrefix": "user.user",
                "permissions": {
                    "postgres": [],
                    "hasura": []
                },
                "ownerCol": null,
                "use_custom_policy": null,
                "hasura_policies": null,
                "postgres_policies": null,
                "use_custom_hasura_policy": null
            },
            {
                "template": "4",
                "hasura": {
                    "stage_dir": "deployments/helm/manabie-all-in-one/charts/entryexitmgmt/files/hasura/metadata/tables.yaml",
                    "permissions": [
                        "SELECT",
                        "INSERT",
                        "UPDATE",
                        "DELETE"
                    ],
                    "relationship": "users_location_permission",
                    "first_level_query": "user_id",
                    "hasura_policies": {
                        "select_permission": [
                            {
                                "name": "USER_GROUP_ADMIN",
                                "filter": {
                                    "user_id": {
                                        "_eq": "X-Hasura-User-Id"
                                    }
                                }
                            },
                            {
                                "name": "USER_GROUP_SCHOOL_ADMIN",
                                "filter": {
                                    "user_id": {
                                        "_eq": "X-Hasura-User-Id"
                                    }
                                }
                            },
                            {
                                "name": "USER_GROUP_TEACHER",
                                "filter": {
                                    "user_id": {
                                        "_eq": "X-Hasura-User-Id"
                                    }
                                }
                            }
                        ],
                        "insert_permission": [],
                        "delete_permission": [],
                        "update_permission": []
                    }
                },
                "postgres": {
                    "stage_dir": "migrations/entryexitmgmt/1032_migrate.up.sql",
                    "policies": [
                        {
                            "name": "rls_users_permission_v4",
                            "content": "DROP POLICY IF EXISTS rls_users on \"users\";\nCREATE POLICY rls_users_permission_v4 ON \"users\" AS PERMISSIVE FOR ALL TO PUBLIC\nusing (\n\tcurrent_setting('app.user_id') = user_id\n)\nwith check (\n\tcurrent_setting('app.user_id') = user_id\n);"
                        }
                    ]
                },
                "accessPathTable": null,
                "locationCol": null,
                "permissionPrefix": null,
                "permissions": {
                    "postgres": [],
                    "hasura": []
                },
                "ownerCol": "user_id",
                "use_custom_policy": null,
                "hasura_policies": null,
                "postgres_policies": null,
                "use_custom_hasura_policy": null
            }
        ]
    },
    {
        "filename": "accesscontrol/fatima/payment.bill_item.yaml",
        "service": "fatima",
        "revision": 2,
        "table_name": "bill_item",
        "created_at": "2023-04-25T09:38:14.775650458Z",
        "updated_at": "2023-04-25T09:38:14.775650492Z",
        "stages": [
            {
                "template": "1",
                "hasura": null,
                "postgres": {
                    "stage_dir": "migrations/fatima/1127_migrate.up.sql",
                    "policies": [
                        {
                            "name": "rls_bill_item_location",
                            "content": "DROP POLICY IF EXISTS rls_bill_item on \"bill_item\";\nCREATE POLICY rls_bill_item_location ON \"bill_item\" AS PERMISSIVE FOR ALL TO PUBLIC\nusing (\n\tlocation_id in (\n\t\tselect\t\t\t\n\t\t\tp.location_id\n\t\tfrom\n\t\t\t\t\t\tgranted_permissions p\n\t\twhere\n\t\t\tp.user_id = current_setting('app.user_id')\n\t\t\tand p.permission_id = (\n\t\t\t\tselect\n\t\t\t\t\tp2.permission_id\n\t\t\t\tfrom\n\t\t\t\t\t\"permission\" p2\n\t\t\t\twhere\n\t\t\t\t\tp2.permission_name = 'payment.bill_item.read'\n\t\t\t\t\tand p2.resource_path = current_setting('permission.resource_path'))\n\t\t)\n)\nwith check (\n\tlocation_id in (\n\t\tselect\t\t\t\n\t\t\tp.location_id\n\t\tfrom\n\t\t\t\t\t\tgranted_permissions p\n\t\twhere\n\t\t\tp.user_id = current_setting('app.user_id')\n\t\t\tand p.permission_id = (\n\t\t\t\tselect\n\t\t\t\t\tp2.permission_id\n\t\t\t\tfrom\n\t\t\t\t\t\"permission\" p2\n\t\t\t\twhere\n\t\t\t\t\tp2.permission_name = 'payment.bill_item.write'\n\t\t\t\t\tand p2.resource_path = current_setting('permission.resource_path'))\n\t\t)\n);"
                        }
                    ]
                },
                "accessPathTable": null,
                "locationCol": null,
                "permissionPrefix": "payment.bill_item",
                "permissions": {
                    "postgres": [],
                    "hasura": null
                },
                "ownerCol": null,
                "use_custom_policy": null,
                "hasura_policies": null,
                "postgres_policies": null,
                "use_custom_hasura_policy": null
            },
            {
                "template": "1.2",
                "hasura": null,
                "postgres": null,
                "accessPathTable": null,
                "locationCol": null,
                "permissionPrefix": null,
                "permissions": null,
                "ownerCol": null,
                "use_custom_policy": true,
                "hasura_policies": null,
                "postgres_policies": [
                    {
                        "name": "rls_bill_item_read_all",
                        "using": "1 = 1\n",
                        "with_check": "",
                        "for": "select"
                    }
                ],
                "use_custom_hasura_policy": null
            }
        ]
    },
    {
        "filename": "accesscontrol/fatima/payment.order.yaml",
        "service": "fatima",
        "revision": 2,
        "table_name": "order",
        "created_at": "2023-04-25T09:38:14.783183343Z",
        "updated_at": "2023-04-25T09:38:14.783183373Z",
        "stages": [
            {
                "template": "1",
                "hasura": null,
                "postgres": {
                    "stage_dir": "migrations/fatima/1128_migrate.up.sql",
                    "policies": [
                        {
                            "name": "rls_order_location",
                            "content": "DROP POLICY IF EXISTS rls_order on \"order\";\nCREATE POLICY rls_order_location ON \"order\" AS PERMISSIVE FOR ALL TO PUBLIC\nusing (\n\tlocation_id in (\n\t\tselect\t\t\t\n\t\t\tp.location_id\n\t\tfrom\n\t\t\t\t\t\tgranted_permissions p\n\t\twhere\n\t\t\tp.user_id = current_setting('app.user_id')\n\t\t\tand p.permission_id = (\n\t\t\t\tselect\n\t\t\t\t\tp2.permission_id\n\t\t\t\tfrom\n\t\t\t\t\t\"permission\" p2\n\t\t\t\twhere\n\t\t\t\t\tp2.permission_name = 'payment.order.read'\n\t\t\t\t\tand p2.resource_path = current_setting('permission.resource_path'))\n\t\t)\n)\nwith check (\n\tlocation_id in (\n\t\tselect\t\t\t\n\t\t\tp.location_id\n\t\tfrom\n\t\t\t\t\t\tgranted_permissions p\n\t\twhere\n\t\t\tp.user_id = current_setting('app.user_id')\n\t\t\tand p.permission_id = (\n\t\t\t\tselect\n\t\t\t\t\tp2.permission_id\n\t\t\t\tfrom\n\t\t\t\t\t\"permission\" p2\n\t\t\t\twhere\n\t\t\t\t\tp2.permission_name = 'payment.order.write'\n\t\t\t\t\tand p2.resource_path = current_setting('permission.resource_path'))\n\t\t)\n);"
                        }
                    ]
                },
                "accessPathTable": null,
                "locationCol": null,
                "permissionPrefix": "payment.order",
                "permissions": {
                    "postgres": [],
                    "hasura": null
                },
                "ownerCol": null,
                "use_custom_policy": null,
                "hasura_policies": null,
                "postgres_policies": null,
                "use_custom_hasura_policy": null
            },
            {
                "template": "1.2",
                "hasura": null,
                "postgres": null,
                "accessPathTable": null,
                "locationCol": null,
                "permissionPrefix": null,
                "permissions": null,
                "ownerCol": null,
                "use_custom_policy": true,
                "hasura_policies": null,
                "postgres_policies": [
                    {
                        "name": "rls_order_read_all",
                        "using": "1 = 1\n",
                        "with_check": "",
                        "for": "select"
                    }
                ],
                "use_custom_hasura_policy": null
            }
        ]
    },
    {
        "filename": "accesscontrol/fatima/payment.student_product.yaml",
        "service": "fatima",
        "revision": 2,
        "table_name": "student_product",
        "created_at": "2023-04-25T09:38:14.788131376Z",
        "updated_at": "2023-04-25T09:38:14.788131408Z",
        "stages": [
            {
                "template": "1",
                "hasura": null,
                "postgres": {
                    "stage_dir": "migrations/fatima/1129_migrate.up.sql",
                    "policies": [
                        {
                            "name": "rls_student_product_location",
                            "content": "DROP POLICY IF EXISTS rls_student_product on \"student_product\";\nCREATE POLICY rls_student_product_location ON \"student_product\" AS PERMISSIVE FOR ALL TO PUBLIC\nusing (\n\tlocation_id in (\n\t\tselect\t\t\t\n\t\t\tp.location_id\n\t\tfrom\n\t\t\t\t\t\tgranted_permissions p\n\t\twhere\n\t\t\tp.user_id = current_setting('app.user_id')\n\t\t\tand p.permission_id = (\n\t\t\t\tselect\n\t\t\t\t\tp2.permission_id\n\t\t\t\tfrom\n\t\t\t\t\t\"permission\" p2\n\t\t\t\twhere\n\t\t\t\t\tp2.permission_name = 'payment.student_product.read'\n\t\t\t\t\tand p2.resource_path = current_setting('permission.resource_path'))\n\t\t)\n)\nwith check (\n\tlocation_id in (\n\t\tselect\t\t\t\n\t\t\tp.location_id\n\t\tfrom\n\t\t\t\t\t\tgranted_permissions p\n\t\twhere\n\t\t\tp.user_id = current_setting('app.user_id')\n\t\t\tand p.permission_id = (\n\t\t\t\tselect\n\t\t\t\t\tp2.permission_id\n\t\t\t\tfrom\n\t\t\t\t\t\"permission\" p2\n\t\t\t\twhere\n\t\t\t\t\tp2.permission_name = 'payment.student_product.write'\n\t\t\t\t\tand p2.resource_path = current_setting('permission.resource_path'))\n\t\t)\n);"
                        }
                    ]
                },
                "accessPathTable": null,
                "locationCol": null,
                "permissionPrefix": "payment.student_product",
                "permissions": {
                    "postgres": [],
                    "hasura": null
                },
                "ownerCol": null,
                "use_custom_policy": null,
                "hasura_policies": null,
                "postgres_policies": null,
                "use_custom_hasura_policy": null
            },
            {
                "template": "1.2",
                "hasura": null,
                "postgres": null,
                "accessPathTable": null,
                "locationCol": null,
                "permissionPrefix": null,
                "permissions": null,
                "ownerCol": null,
                "use_custom_policy": true,
                "hasura_policies": null,
                "postgres_policies": [
                    {
                        "name": "rls_student_product_read_all",
                        "using": "1 = 1\n",
                        "with_check": "",
                        "for": "select"
                    }
                ],
                "use_custom_hasura_policy": null
            }
        ]
    },
    {
        "filename": "accesscontrol/lessonmgmt/lesson.lesson.yaml",
        "service": "lessonmgmt",
        "revision": 2,
        "table_name": "lessons",
        "created_at": "2023-04-27T15:19:07.839870156+07:00",
        "updated_at": "2023-04-27T15:19:07.839870202+07:00",
        "stages": [
            {
                "template": "1",
                "hasura": {
                    "stage_dir": "deployments/helm/manabie-all-in-one/charts/lessonmgmt/files/hasura/metadata/tables.yaml",
                    "permissions": [
                        "SELECT",
                        "INSERT",
                        "UPDATE",
                        "DELETE"
                    ],
                    "relationship": "lessons_location_permission",
                    "first_level_query": "lessons_location_permission",
                    "hasura_policies": {
                        "select_permission": [
                            {
                                "name": "MANABIE",
                                "filter": {
                                    "lessons_location_permission": {
                                        "_and": [
                                            {
                                                "user_id": {
                                                    "_eq": "X-Hasura-User-Id"
                                                }
                                            },
                                            {
                                                "permission_name": {
                                                    "_eq": "lesson.lesson.read"
                                                }
                                            }
                                        ]
                                    }
                                }
                            },
                            {
                                "name": "USER_GROUP_ADMIN",
                                "filter": {
                                    "lessons_location_permission": {
                                        "_and": [
                                            {
                                                "user_id": {
                                                    "_eq": "X-Hasura-User-Id"
                                                }
                                            },
                                            {
                                                "permission_name": {
                                                    "_eq": "lesson.lesson.read"
                                                }
                                            }
                                        ]
                                    }
                                }
                            },
                            {
                                "name": "USER_GROUP_SCHOOL_ADMIN",
                                "filter": {
                                    "lessons_location_permission": {
                                        "_and": [
                                            {
                                                "user_id": {
                                                    "_eq": "X-Hasura-User-Id"
                                                }
                                            },
                                            {
                                                "permission_name": {
                                                    "_eq": "lesson.lesson.read"
                                                }
                                            }
                                        ]
                                    }
                                }
                            },
                            {
                                "name": "USER_GROUP_SCHOOL_STAFF",
                                "filter": {
                                    "lessons_location_permission": {
                                        "_and": [
                                            {
                                                "user_id": {
                                                    "_eq": "X-Hasura-User-Id"
                                                }
                                            },
                                            {
                                                "permission_name": {
                                                    "_eq": "lesson.lesson.read"
                                                }
                                            }
                                        ]
                                    }
                                }
                            },
                            {
                                "name": "USER_GROUP_TEACHER",
                                "filter": {
                                    "lessons_location_permission": {
                                        "_and": [
                                            {
                                                "user_id": {
                                                    "_eq": "X-Hasura-User-Id"
                                                }
                                            },
                                            {
                                                "permission_name": {
                                                    "_eq": "lesson.lesson.read"
                                                }
                                            }
                                        ]
                                    }
                                }
                            }
                        ],
                        "insert_permission": [],
                        "delete_permission": [],
                        "update_permission": []
                    }
                },
                "postgres": {
                    "stage_dir": "migrations/lessonmgmt/1046_migrate.up.sql",
                    "policies": [
                        {
                            "name": "rls_lessons_location",
                            "content": "DROP POLICY IF EXISTS rls_lessons on \"lessons\";\nCREATE POLICY rls_lessons_location ON \"lessons\" AS PERMISSIVE FOR ALL TO PUBLIC\nusing (\n\tcenter_id in (\n\t\tselect\t\t\t\n\t\t\tp.location_id\n\t\tfrom\n\t\t\t\t\t\tgranted_permissions p\n\t\twhere\n\t\t\tp.user_id = current_setting('app.user_id')\n\t\t\tand p.permission_id = (\n\t\t\t\tselect\n\t\t\t\t\tp2.permission_id\n\t\t\t\tfrom\n\t\t\t\t\t\"permission\" p2\n\t\t\t\twhere\n\t\t\t\t\tp2.permission_name = 'lesson.lesson.read'\n\t\t\t\t\tand p2.resource_path = current_setting('permission.resource_path'))\n\t\t)\n)\nwith check (\n\tcenter_id in (\n\t\tselect\t\t\t\n\t\t\tp.location_id\n\t\tfrom\n\t\t\t\t\t\tgranted_permissions p\n\t\twhere\n\t\t\tp.user_id = current_setting('app.user_id')\n\t\t\tand p.permission_id = (\n\t\t\t\tselect\n\t\t\t\t\tp2.permission_id\n\t\t\t\tfrom\n\t\t\t\t\t\"permission\" p2\n\t\t\t\twhere\n\t\t\t\t\tp2.permission_name = 'lesson.lesson.write'\n\t\t\t\t\tand p2.resource_path = current_setting('permission.resource_path'))\n\t\t)\n);"
                        }
                    ]
                },
                "accessPathTable": null,
                "locationCol": "center_id",
                "permissionPrefix": "lesson.lesson",
                "permissions": {
                    "postgres": [],
                    "hasura": []
                },
                "ownerCol": null,
                "use_custom_policy": null,
                "hasura_policies": null,
                "postgres_policies": null,
                "use_custom_hasura_policy": null
            }
        ]
    },
    {
        "filename": "accesscontrol/lessonmgmt/master.course.yaml",
        "service": "lessonmgmt",
        "revision": 1,
        "table_name": "courses",
        "created_at": "2023-06-14T10:09:01.4616096+07:00",
        "updated_at": "2023-06-14T10:09:01.461609629+07:00",
        "stages": [
            {
                "template": "3",
                "hasura": {
                    "stage_dir": "deployments/helm/manabie-all-in-one/charts/lessonmgmt/files/hasura/metadata/tables.yaml",
                    "permissions": [
                        "SELECT",
                        "INSERT",
                        "UPDATE",
                        "DELETE"
                    ],
                    "relationship": "courses_location_permission",
                    "first_level_query": "_exists",
                    "hasura_policies": {
                        "select_permission": [
                            {
                                "name": "MANABIE",
                                "filter": {
                                    "_exists": {
                                        "_table": {
                                            "name": "granted_permissions",
                                            "schema": "public"
                                        },
                                        "_where": {
                                            "_and": [
                                                {
                                                    "user_id": {
                                                        "_eq": "X-Hasura-User-Id"
                                                    }
                                                },
                                                {
                                                    "permission_name": {
                                                        "_eq": "master.course.read"
                                                    }
                                                }
                                            ]
                                        }
                                    }
                                }
                            },
                            {
                                "name": "USER_GROUP_ADMIN",
                                "filter": {
                                    "_exists": {
                                        "_table": {
                                            "name": "granted_permissions",
                                            "schema": "public"
                                        },
                                        "_where": {
                                            "_and": [
                                                {
                                                    "user_id": {
                                                        "_eq": "X-Hasura-User-Id"
                                                    }
                                                },
                                                {
                                                    "permission_name": {
                                                        "_eq": "master.course.read"
                                                    }
                                                }
                                            ]
                                        }
                                    }
                                }
                            },
                            {
                                "name": "USER_GROUP_SCHOOL_ADMIN",
                                "filter": {
                                    "_exists": {
                                        "_table": {
                                            "name": "granted_permissions",
                                            "schema": "public"
                                        },
                                        "_where": {
                                            "_and": [
                                                {
                                                    "user_id": {
                                                        "_eq": "X-Hasura-User-Id"
                                                    }
                                                },
                                                {
                                                    "permission_name": {
                                                        "_eq": "master.course.read"
                                                    }
                                                }
                                            ]
                                        }
                                    }
                                }
                            },
                            {
                                "name": "USER_GROUP_SCHOOL_STAFF",
                                "filter": {
                                    "_exists": {
                                        "_table": {
                                            "name": "granted_permissions",
                                            "schema": "public"
                                        },
                                        "_where": {
                                            "_and": [
                                                {
                                                    "user_id": {
                                                        "_eq": "X-Hasura-User-Id"
                                                    }
                                                },
                                                {
                                                    "permission_name": {
                                                        "_eq": "master.course.read"
                                                    }
                                                }
                                            ]
                                        }
                                    }
                                }
                            },
                            {
                                "name": "USER_GROUP_TEACHER",
                                "filter": {
                                    "_exists": {
                                        "_table": {
                                            "name": "granted_permissions",
                                            "schema": "public"
                                        },
                                        "_where": {
                                            "_and": [
                                                {
                                                    "user_id": {
                                                        "_eq": "X-Hasura-User-Id"
                                                    }
                                                },
                                                {
                                                    "permission_name": {
                                                        "_eq": "master.course.read"
                                                    }
                                                }
                                            ]
                                        }
                                    }
                                }
                            }
                        ],
                        "insert_permission": [],
                        "delete_permission": [],
                        "update_permission": []
                    }
                },
                "postgres": {
                    "stage_dir": "migrations/lessonmgmt/1064_migrate.up.sql",
                    "policies": [
                        {
                            "name": "rls_courses_permission_v3",
                            "content": "DROP POLICY IF EXISTS rls_courses on \"courses\";\nCREATE POLICY rls_courses_permission_v3 ON \"courses\" AS PERMISSIVE FOR ALL TO PUBLIC\nusing (\n\ttrue \u003c= (\n\t\tselect\t\t\t\n\t\t\ttrue\n\t\tfrom\n\t\t\tgranted_permissions p\n\t\twhere\n\t\t\tp.user_id = current_setting('app.user_id')\n\t\t\tand p.permission_id = (\n\t\t\t\tselect\n\t\t\t\t\tp2.permission_id\n\t\t\t\tfrom\n\t\t\t\t\t\"permission\" p2\n\t\t\t\twhere\n\t\t\t\t\tp2.permission_name = 'master.course.read'\n\t\t\t\t\tand p2.resource_path = current_setting('permission.resource_path'))\n\t\tlimit 1\n\t\t)\n)\nwith check (\n\ttrue \u003c= (\n\t\tselect\t\t\t\n\t\t\ttrue\n\t\tfrom\n\t\t\tgranted_permissions p\n\t\twhere\n\t\t\tp.user_id = current_setting('app.user_id')\n\t\t\tand p.permission_id = (\n\t\t\t\tselect\n\t\t\t\t\tp2.permission_id\n\t\t\t\tfrom\n\t\t\t\t\t\"permission\" p2\n\t\t\t\twhere\n\t\t\t\t\tp2.permission_name = 'master.course.write'\n\t\t\t\t\tand p2.resource_path = current_setting('permission.resource_path'))\n\t\tlimit 1\n\t\t)\n);"
                        }
                    ]
                },
                "accessPathTable": null,
                "locationCol": null,
                "permissionPrefix": "master.course",
                "permissions": {
                    "postgres": [],
                    "hasura": []
                },
                "ownerCol": null,
                "use_custom_policy": null,
                "hasura_policies": null,
                "postgres_policies": null,
                "use_custom_hasura_policy": null
            }
        ]
    },
    {
        "filename": "accesscontrol/lessonmgmt/master.location.yaml",
        "service": "lessonmgmt",
        "revision": 1,
        "table_name": "locations",
        "created_at": "2023-06-15T18:10:19.510807562+07:00",
        "updated_at": "2023-06-15T18:10:19.510807606+07:00",
        "stages": [
            {
                "template": "1",
                "hasura": {
                    "stage_dir": "deployments/helm/manabie-all-in-one/charts/lessonmgmt/files/hasura/metadata/tables.yaml",
                    "permissions": [
                        "SELECT",
                        "INSERT",
                        "UPDATE",
                        "DELETE"
                    ],
                    "relationship": "",
                    "first_level_query": "",
                    "hasura_policies": {
                        "select_permission": [
                            {
                                "name": "MANABIE",
                                "filter": [
                                    {
                                        "locations_location_permission": {
                                            "_and": [
                                                {
                                                    "user_id": {
                                                        "_eq": "X-Hasura-User-Id"
                                                    }
                                                },
                                                {
                                                    "permission_name": {
                                                        "_eq": "master.location.read"
                                                    }
                                                }
                                            ]
                                        }
                                    }
                                ]
                            },
                            {
                                "name": "USER_GROUP_ADMIN",
                                "filter": [
                                    {
                                        "locations_location_permission": {
                                            "_and": [
                                                {
                                                    "user_id": {
                                                        "_eq": "X-Hasura-User-Id"
                                                    }
                                                },
                                                {
                                                    "permission_name": {
                                                        "_eq": "master.location.read"
                                                    }
                                                }
                                            ]
                                        }
                                    }
                                ]
                            },
                            {
                                "name": "USER_GROUP_SCHOOL_ADMIN",
                                "filter": [
                                    {
                                        "locations_location_permission": {
                                            "_and": [
                                                {
                                                    "user_id": {
                                                        "_eq": "X-Hasura-User-Id"
                                                    }
                                                },
                                                {
                                                    "permission_name": {
                                                        "_eq": "master.location.read"
                                                    }
                                                }
                                            ]
                                        }
                                    }
                                ]
                            },
                            {
                                "name": "USER_GROUP_SCHOOL_STAFF",
                                "filter": [
                                    {
                                        "locations_location_permission": {
                                            "_and": [
                                                {
                                                    "user_id": {
                                                        "_eq": "X-Hasura-User-Id"
                                                    }
                                                },
                                                {
                                                    "permission_name": {
                                                        "_eq": "master.location.read"
                                                    }
                                                }
                                            ]
                                        }
                                    }
                                ]
                            },
                            {
                                "name": "USER_GROUP_TEACHER",
                                "filter": [
                                    {
                                        "locations_location_permission": {
                                            "_and": [
                                                {
                                                    "user_id": {
                                                        "_eq": "X-Hasura-User-Id"
                                                    }
                                                },
                                                {
                                                    "permission_name": {
                                                        "_eq": "master.location.read"
                                                    }
                                                }
                                            ]
                                        }
                                    }
                                ]
                            }
                        ],
                        "insert_permission": [],
                        "delete_permission": [],
                        "update_permission": []
                    }
                },
                "postgres": null,
                "accessPathTable": null,
                "locationCol": null,
                "permissionPrefix": null,
                "permissions": null,
                "ownerCol": null,
                "use_custom_policy": true,
                "hasura_policies": {
                    "select_permission": [
                        {
                            "name": "MANABIE",
                            "filter": [
                                {
                                    "locations_location_permission": {
                                        "_and": [
                                            {
                                                "user_id": {
                                                    "_eq": "X-Hasura-User-Id"
                                                }
                                            },
                                            {
                                                "permission_name": {
                                                    "_eq": "master.location.read"
                                                }
                                            }
                                        ]
                                    }
                                }
                            ]
                        },
                        {
                            "name": "USER_GROUP_ADMIN",
                            "filter": [
                                {
                                    "locations_location_permission": {
                                        "_and": [
                                            {
                                                "user_id": {
                                                    "_eq": "X-Hasura-User-Id"
                                                }
                                            },
                                            {
                                                "permission_name": {
                                                    "_eq": "master.location.read"
                                                }
                                            }
                                        ]
                                    }
                                }
                            ]
                        },
                        {
                            "name": "USER_GROUP_SCHOOL_ADMIN",
                            "filter": [
                                {
                                    "locations_location_permission": {
                                        "_and": [
                                            {
                                                "user_id": {
                                                    "_eq": "X-Hasura-User-Id"
                                                }
                                            },
                                            {
                                                "permission_name": {
                                                    "_eq": "master.location.read"
                                                }
                                            }
                                        ]
                                    }
                                }
                            ]
                        },
                        {
                            "name": "USER_GROUP_SCHOOL_STAFF",
                            "filter": [
                                {
                                    "locations_location_permission": {
                                        "_and": [
                                            {
                                                "user_id": {
                                                    "_eq": "X-Hasura-User-Id"
                                                }
                                            },
                                            {
                                                "permission_name": {
                                                    "_eq": "master.location.read"
                                                }
                                            }
                                        ]
                                    }
                                }
                            ]
                        },
                        {
                            "name": "USER_GROUP_TEACHER",
                            "filter": [
                                {
                                    "locations_location_permission": {
                                        "_and": [
                                            {
                                                "user_id": {
                                                    "_eq": "X-Hasura-User-Id"
                                                }
                                            },
                                            {
                                                "permission_name": {
                                                    "_eq": "master.location.read"
                                                }
                                            }
                                        ]
                                    }
                                }
                            ]
                        }
                    ],
                    "insert_permission": null,
                    "delete_permission": null,
                    "update_permission": null,
                    "object_custom_relationship": [
                        {
                            "table_name": "locations",
                            "manual_config": {
                                "Name": "locations_location_permission",
                                "Using": {
                                    "ForeignKeyConstraintOn": "",
                                    "ManualConfiguration": {
                                        "RemoteTable": {
                                            "Schema": "public",
                                            "Name": "granted_permissions"
                                        },
                                        "ColumnMapping": {
                                            "location_id": "location_id"
                                        }
                                    }
                                }
                            }
                        },
                        {
                            "table_name": "granted_permissions",
                            "manual_config": {
                                "Name": "locations_location_permission",
                                "Using": {
                                    "ForeignKeyConstraintOn": "",
                                    "ManualConfiguration": {
                                        "RemoteTable": {
                                            "Schema": "public",
                                            "Name": "locations"
                                        },
                                        "ColumnMapping": {
                                            "location_id": "location_id"
                                        }
                                    }
                                }
                            }
                        }
                    ]
                },
                "postgres_policies": [
                    {
                        "name": "rls_locations_location",
                        "using": "location_id in (\n  select\t\t\t\n    p.location_id\n  from\n          granted_permissions p\n  where\n    p.user_id = current_setting('app.user_id')\n    and p.permission_id = (\n      select\n        p2.permission_id\n      from\n        \"permission\" p2\n      where\n        p2.permission_name = 'master.location.read'\n        and p2.resource_path = current_setting('permission.resource_path'))\n  )\n",
                        "with_check": "exists (\n  select\t\t\t\n    true\n  from\n          granted_permissions p\n  where\n    p.user_id = current_setting('app.user_id')\n    and p.permission_id = (\n      select\n        p2.permission_id\n      from\n        \"permission\" p2\n      where\n        p2.permission_name = 'master.location.write'\n        and p2.resource_path = current_setting('permission.resource_path'))\n  )\n",
                        "for": "all"
                    }
                ],
                "use_custom_hasura_policy": true
            }
        ]
    },
    {
        "filename": "accesscontrol/lessonmgmt/users.staff.yaml",
        "service": "lessonmgmt",
        "revision": 1,
        "table_name": "staff",
        "created_at": "2023-04-25T09:29:34.588909701+07:00",
        "updated_at": "2023-04-25T09:29:34.588909743+07:00",
        "stages": [
            {
                "template": "1.1",
                "hasura": null,
                "postgres": {
                    "stage_dir": "migrations/lessonmgmt/1047_migrate.up.sql",
                    "policies": [
                        {
                            "name": "rls_staff_select_location",
                            "content": "CREATE POLICY rls_staff_select_location ON \"staff\" AS PERMISSIVE FOR select TO PUBLIC\nusing (\ntrue \u003c= (\n\tselect\t\t\t\n\t\ttrue\n\tfrom\n\t\t\t\t\tgranted_permissions p\n\tjoin user_access_paths usp on\n\t\t\t\t\tusp.location_id = p.location_id\n\twhere\n\t\tp.user_id = current_setting('app.user_id')\n\t\tand p.permission_id = (\n\t\t\tselect\n\t\t\t\tp2.permission_id\n\t\t\tfrom\n\t\t\t\t\"permission\" p2\n\t\t\twhere\n\t\t\t\tp2.permission_name = 'user.staff.read'\n\t\t\t\tand p2.resource_path = current_setting('permission.resource_path'))\n\t\tand usp.\"user_id\" = staff.staff_id\n\t\tand usp.deleted_at is null\n\tlimit 1\n\t)\n)\n;"
                        },
                        {
                            "name": "rls_staff_update_location",
                            "content": "CREATE POLICY rls_staff_update_location ON \"staff\" AS PERMISSIVE FOR update TO PUBLIC\nusing (\ntrue \u003c= (\n\tselect\t\t\t\n\t\ttrue\n\tfrom\n\t\t\t\t\tgranted_permissions p\n\tjoin user_access_paths usp on\n\t\t\t\t\tusp.location_id = p.location_id\n\twhere\n\t\tp.user_id = current_setting('app.user_id')\n\t\tand p.permission_id = (\n\t\t\tselect\n\t\t\t\tp2.permission_id\n\t\t\tfrom\n\t\t\t\t\"permission\" p2\n\t\t\twhere\n\t\t\t\tp2.permission_name = 'user.staff.write'\n\t\t\t\tand p2.resource_path = current_setting('permission.resource_path'))\n\t\tand usp.\"user_id\" = staff.staff_id\n\t\tand usp.deleted_at is null\n\tlimit 1\n\t)\n)with check (\ntrue \u003c= (\n\tselect\t\t\t\n\t\ttrue\n\tfrom\n\t\t\t\t\tgranted_permissions p\n\tjoin user_access_paths usp on\n\t\t\t\t\tusp.location_id = p.location_id\n\twhere\n\t\tp.user_id = current_setting('app.user_id')\n\t\tand p.permission_id = (\n\t\t\tselect\n\t\t\t\tp2.permission_id\n\t\t\tfrom\n\t\t\t\t\"permission\" p2\n\t\t\twhere\n\t\t\t\tp2.permission_name = 'user.staff.write'\n\t\t\t\tand p2.resource_path = current_setting('permission.resource_path'))\n\t\tand usp.\"user_id\" = staff.staff_id\n\t\tand usp.deleted_at is null\n\tlimit 1\n\t)\n)\n;"
                        },
                        {
                            "name": "rls_staff_delete_location",
                            "content": "CREATE POLICY rls_staff_delete_location ON \"staff\" AS PERMISSIVE FOR delete TO PUBLIC\nusing (\ntrue \u003c= (\n\tselect\t\t\t\n\t\ttrue\n\tfrom\n\t\t\t\t\tgranted_permissions p\n\tjoin user_access_paths usp on\n\t\t\t\t\tusp.location_id = p.location_id\n\twhere\n\t\tp.user_id = current_setting('app.user_id')\n\t\tand p.permission_id = (\n\t\t\tselect\n\t\t\t\tp2.permission_id\n\t\t\tfrom\n\t\t\t\t\"permission\" p2\n\t\t\twhere\n\t\t\t\tp2.permission_name = 'user.staff.write'\n\t\t\t\tand p2.resource_path = current_setting('permission.resource_path'))\n\t\tand usp.\"user_id\" = staff.staff_id\n\t\tand usp.deleted_at is null\n\tlimit 1\n\t)\n)\n;"
                        },
                        {
                            "name": "rls_staff_insert_location",
                            "content": "CREATE POLICY rls_staff_insert_location ON \"staff\" AS PERMISSIVE FOR INSERT TO PUBLIC\nwith check (\n\t1 = 1\n);\n"
                        }
                    ]
                },
                "accessPathTable": {
                    "name": "user_access_paths",
                    "columnMapping": {
                        "staff_id": "user_id"
                    }
                },
                "locationCol": "location_id",
                "permissionPrefix": "user.staff",
                "permissions": {
                    "postgres": [],
                    "hasura": null
                },
                "ownerCol": null,
                "use_custom_policy": null,
                "hasura_policies": null,
                "postgres_policies": null,
                "use_custom_hasura_policy": null
            }
        ]
    },
    {
        "filename": "accesscontrol/lessonmgmt/users.students.yaml",
        "service": "lessonmgmt",
        "revision": 1,
        "table_name": "students",
        "created_at": "2023-05-15T16:51:48.448331654+07:00",
        "updated_at": "2023-05-15T16:51:48.448331712+07:00",
        "stages": [
            {
                "template": "1.1",
                "hasura": null,
                "postgres": {
                    "stage_dir": "migrations/lessonmgmt/1049_migrate.up.sql",
                    "policies": [
                        {
                            "name": "rls_students_select_location",
                            "content": "CREATE POLICY rls_students_select_location ON \"students\" AS PERMISSIVE FOR select TO PUBLIC\nusing (\nstudent_id in (\n\tselect\t\t\t\n\t\tusp.\"user_id\"\n\tfrom\n\t\t\t\t\tgranted_permissions p\n\tjoin user_access_paths usp on\n\t\t\t\t\tusp.location_id = p.location_id\n\twhere\n\t\tp.user_id = current_setting('app.user_id')\n\t\tand p.permission_id = (\n\t\t\tselect\n\t\t\t\tp2.permission_id\n\t\t\tfrom\n\t\t\t\t\"permission\" p2\n\t\t\twhere\n\t\t\t\tp2.permission_name = 'user.student.read'\n\t\t\t\tand p2.resource_path = current_setting('permission.resource_path'))\n\t\tand usp.deleted_at is null\n\t)\n)\n;"
                        },
                        {
                            "name": "rls_students_update_location",
                            "content": "CREATE POLICY rls_students_update_location ON \"students\" AS PERMISSIVE FOR update TO PUBLIC\nusing (\nstudent_id in (\n\tselect\t\t\t\n\t\tusp.\"user_id\"\n\tfrom\n\t\t\t\t\tgranted_permissions p\n\tjoin user_access_paths usp on\n\t\t\t\t\tusp.location_id = p.location_id\n\twhere\n\t\tp.user_id = current_setting('app.user_id')\n\t\tand p.permission_id = (\n\t\t\tselect\n\t\t\t\tp2.permission_id\n\t\t\tfrom\n\t\t\t\t\"permission\" p2\n\t\t\twhere\n\t\t\t\tp2.permission_name = 'user.student.write'\n\t\t\t\tand p2.resource_path = current_setting('permission.resource_path'))\n\t\tand usp.deleted_at is null\n\t)\n)with check (\nstudent_id in (\n\tselect\t\t\t\n\t\tusp.\"user_id\"\n\tfrom\n\t\t\t\t\tgranted_permissions p\n\tjoin user_access_paths usp on\n\t\t\t\t\tusp.location_id = p.location_id\n\twhere\n\t\tp.user_id = current_setting('app.user_id')\n\t\tand p.permission_id = (\n\t\t\tselect\n\t\t\t\tp2.permission_id\n\t\t\tfrom\n\t\t\t\t\"permission\" p2\n\t\t\twhere\n\t\t\t\tp2.permission_name = 'user.student.write'\n\t\t\t\tand p2.resource_path = current_setting('permission.resource_path'))\n\t\tand usp.deleted_at is null\n\t)\n)\n;"
                        },
                        {
                            "name": "rls_students_delete_location",
                            "content": "CREATE POLICY rls_students_delete_location ON \"students\" AS PERMISSIVE FOR delete TO PUBLIC\nusing (\nstudent_id in (\n\tselect\t\t\t\n\t\tusp.\"user_id\"\n\tfrom\n\t\t\t\t\tgranted_permissions p\n\tjoin user_access_paths usp on\n\t\t\t\t\tusp.location_id = p.location_id\n\twhere\n\t\tp.user_id = current_setting('app.user_id')\n\t\tand p.permission_id = (\n\t\t\tselect\n\t\t\t\tp2.permission_id\n\t\t\tfrom\n\t\t\t\t\"permission\" p2\n\t\t\twhere\n\t\t\t\tp2.permission_name = 'user.student.write'\n\t\t\t\tand p2.resource_path = current_setting('permission.resource_path'))\n\t\tand usp.deleted_at is null\n\t)\n)\n;"
                        },
                        {
                            "name": "rls_students_insert_location",
                            "content": "CREATE POLICY rls_students_insert_location ON \"students\" AS PERMISSIVE FOR INSERT TO PUBLIC\nwith check (\n\t1 = 1\n);\n"
                        }
                    ]
                },
                "accessPathTable": {
                    "name": "user_access_paths",
                    "columnMapping": {
                        "student_id": "user_id"
                    }
                },
                "locationCol": "location_id",
                "permissionPrefix": "user.student",
                "permissions": {
                    "postgres": [],
                    "hasura": null
                },
                "ownerCol": null,
                "use_custom_policy": null,
                "hasura_policies": null,
                "postgres_policies": null,
                "use_custom_hasura_policy": null
            }
        ]
    },
    {
        "filename": "accesscontrol/lessonmgmt/users.user_access_paths.yaml",
        "service": "lessonmgmt",
        "revision": 1,
        "table_name": "user_access_paths",
        "created_at": "2023-04-25T09:29:34.58916452+07:00",
        "updated_at": "2023-04-25T09:29:34.589164574+07:00",
        "stages": [
            {
                "template": "1",
                "hasura": null,
                "postgres": {
                    "stage_dir": "migrations/lessonmgmt/1048_migrate.up.sql",
                    "policies": [
                        {
                            "name": "rls_user_access_paths_location",
                            "content": "DROP POLICY IF EXISTS rls_user_access_paths on \"user_access_paths\";\nCREATE POLICY rls_user_access_paths_location ON \"user_access_paths\" AS PERMISSIVE FOR ALL TO PUBLIC\nusing (\n\tlocation_id in (\n\t\tselect\t\t\t\n\t\t\tp.location_id\n\t\tfrom\n\t\t\t\t\t\tgranted_permissions p\n\t\twhere\n\t\t\tp.user_id = current_setting('app.user_id')\n\t\t\tand p.permission_id = (\n\t\t\t\tselect\n\t\t\t\t\tp2.permission_id\n\t\t\t\tfrom\n\t\t\t\t\t\"permission\" p2\n\t\t\t\twhere\n\t\t\t\t\tp2.permission_name = 'user.user.read'\n\t\t\t\t\tand p2.resource_path = current_setting('permission.resource_path'))\n\t\t)\n)\nwith check (\n\tlocation_id in (\n\t\tselect\t\t\t\n\t\t\tp.location_id\n\t\tfrom\n\t\t\t\t\t\tgranted_permissions p\n\t\twhere\n\t\t\tp.user_id = current_setting('app.user_id')\n\t\t\tand p.permission_id = (\n\t\t\t\tselect\n\t\t\t\t\tp2.permission_id\n\t\t\t\tfrom\n\t\t\t\t\t\"permission\" p2\n\t\t\t\twhere\n\t\t\t\t\tp2.permission_name = 'user.user.write'\n\t\t\t\t\tand p2.resource_path = current_setting('permission.resource_path'))\n\t\t)\n);"
                        }
                    ]
                },
                "accessPathTable": null,
                "locationCol": null,
                "permissionPrefix": "user.user",
                "permissions": {
                    "postgres": [],
                    "hasura": null
                },
                "ownerCol": null,
                "use_custom_policy": null,
                "hasura_policies": null,
                "postgres_policies": null,
                "use_custom_hasura_policy": null
            }
        ]
    },
    {
        "filename": "accesscontrol/mastermgmt/archtechture.ac_hasura_test_template_1.yaml",
        "service": "mastermgmt",
        "revision": 2,
        "table_name": "ac_hasura_test_template_1",
        "created_at": "2022-10-17T13:58:12.614483151+07:00",
        "updated_at": "2022-10-17T13:58:12.614483221+07:00",
        "stages": [
            {
                "template": "1",
                "hasura": {
                    "stage_dir": "deployments/helm/manabie-all-in-one/charts/mastermgmt/files/hasura/metadata/tables.yaml",
                    "permissions": [
                        "SELECT",
                        "INSERT",
                        "UPDATE",
                        "DELETE"
                    ],
                    "relationship": "ac_hasura_test_template_1_location_permission",
                    "first_level_query": "",
                    "hasura_policies": {
                        "select_permission": [
                            {
                                "name": "USER_GROUP_ADMIN",
                                "filter": {
                                    "ac_hasura_test_template_1_location_permission": {
                                        "_and": [
                                            {
                                                "user_id": {
                                                    "_eq": "X-Hasura-User-Id"
                                                }
                                            },
                                            {
                                                "permission_name": {
                                                    "_eq": "accesscontrol.b.read"
                                                }
                                            }
                                        ]
                                    }
                                }
                            },
                            {
                                "name": "MANABIE",
                                "filter": {
                                    "ac_hasura_test_template_1_location_permission": {
                                        "_and": [
                                            {
                                                "user_id": {
                                                    "_eq": "X-Hasura-User-Id"
                                                }
                                            },
                                            {
                                                "permission_name": {
                                                    "_eq": "accesscontrol.b.read"
                                                }
                                            }
                                        ]
                                    }
                                }
                            }
                        ],
                        "insert_permission": [
                            {
                                "name": "USER_GROUP_ADMIN",
                                "check": {
                                    "ac_hasura_test_template_1_location_permission": {
                                        "_and": [
                                            {
                                                "user_id": {
                                                    "_eq": "X-Hasura-User-Id"
                                                }
                                            },
                                            {
                                                "permission_name": {
                                                    "_eq": "accesscontrol.b.write"
                                                }
                                            }
                                        ]
                                    }
                                }
                            }
                        ],
                        "delete_permission": [
                            {
                                "name": "USER_GROUP_ADMIN",
                                "check": {
                                    "ac_hasura_test_template_1_location_permission": {
                                        "_and": [
                                            {
                                                "user_id": {
                                                    "_eq": "X-Hasura-User-Id"
                                                }
                                            },
                                            {
                                                "permission_name": {
                                                    "_eq": "accesscontrol.b.write"
                                                }
                                            }
                                        ]
                                    }
                                }
                            }
                        ],
                        "update_permission": [
                            {
                                "name": "USER_GROUP_ADMIN",
                                "filter": {
                                    "ac_hasura_test_template_1_location_permission": {
                                        "_and": [
                                            {
                                                "user_id": {
                                                    "_eq": "X-Hasura-User-Id"
                                                }
                                            },
                                            {
                                                "permission_name": {
                                                    "_eq": "accesscontrol.b.write"
                                                }
                                            }
                                        ]
                                    }
                                },
                                "check": {
                                    "ac_hasura_test_template_1_location_permission": {
                                        "_and": [
                                            {
                                                "user_id": {
                                                    "_eq": "X-Hasura-User-Id"
                                                }
                                            },
                                            {
                                                "permission_name": {
                                                    "_eq": "accesscontrol.b.write"
                                                }
                                            }
                                        ]
                                    }
                                }
                            }
                        ]
                    }
                },
                "postgres": null,
                "accessPathTable": null,
                "locationCol": "location_id",
                "permissionPrefix": "accesscontrol.b",
                "permissions": {
                    "postgres": null,
                    "hasura": []
                },
                "ownerCol": null,
                "use_custom_policy": null,
                "hasura_policies": null,
                "postgres_policies": null,
                "use_custom_hasura_policy": null
            }
        ]
    },
    {
        "filename": "accesscontrol/mastermgmt/archtechture.ac_test_template_1.yaml",
        "service": "mastermgmt",
        "revision": 3,
        "table_name": "ac_test_template_1",
        "created_at": "2022-10-17T13:58:12.614499869+07:00",
        "updated_at": "2022-10-17T13:58:12.61449991+07:00",
        "stages": [
            {
                "template": "1",
                "hasura": null,
                "postgres": {
                    "stage_dir": "migrations/mastermgmt/1024_migrate.up.sql",
                    "policies": [
                        {
                            "name": "rls_ac_test_template_1_location",
                            "content": "DROP POLICY IF EXISTS rls_ac_test_template_1 on ac_test_template_1;\nCREATE POLICY rls_ac_test_template_1_location ON ac_test_template_1 AS PERMISSIVE FOR ALL TO PUBLIC\nusing (\ntrue \u003c= (\n\tselect\t\t\t\n\t\ttrue\n\tfrom\n\t\t\t\t\tgranted_permissions p\n\tjoin ac_test_template_1_access_paths usp on\n\t\t\t\t\tusp.location_id = p.location_id\n\twhere\n\t\tp.user_id = current_setting('app.user_id')\n\t\tand p.permission_name = 'accesscontrol.b.read'\n\t\tand usp.\"ac_test_template_1_id\" = ac_test_template_1.ac_test_template_1_id\n\t\tand usp.deleted_at is null\n\tlimit 1\n\t)\n)\nwith check (\ntrue \u003c= (\n\tselect\t\t\t\n\t\ttrue\n\tfrom\n\t\t\t\t\tgranted_permissions p\n\tjoin ac_test_template_1_access_paths usp on\n\t\t\t\t\tusp.location_id = p.location_id\n\twhere\n\t\tp.user_id = current_setting('app.user_id')\n\t\tand p.permission_name = 'accesscontrol.b.write'\n\t\tand usp.\"ac_test_template_1_id\" = ac_test_template_1.ac_test_template_1_id\n\t\tand usp.deleted_at is null\n\tlimit 1\n\t)\n);"
                        }
                    ]
                },
                "accessPathTable": {
                    "name": "ac_test_template_1_access_paths",
                    "columnMapping": {
                        "ac_test_template_1_id": "ac_test_template_1_id"
                    }
                },
                "locationCol": "location_id",
                "permissionPrefix": "accesscontrol.b",
                "permissions": {
                    "postgres": [],
                    "hasura": null
                },
                "ownerCol": null,
                "use_custom_policy": null,
                "hasura_policies": null,
                "postgres_policies": null,
                "use_custom_hasura_policy": null
            }
        ]
    },
    {
        "filename": "accesscontrol/mastermgmt/archtechture.ac_test_template_11_4.yaml",
        "service": "mastermgmt",
        "revision": 3,
        "table_name": "ac_test_template_11_4",
        "created_at": "2022-10-17T13:58:12.61450795+07:00",
        "updated_at": "2022-10-17T13:58:12.614507982+07:00",
        "stages": [
            {
                "template": "1.1",
                "hasura": null,
                "postgres": null,
                "accessPathTable": null,
                "locationCol": null,
                "permissionPrefix": null,
                "permissions": null,
                "ownerCol": null,
                "use_custom_policy": true,
                "hasura_policies": null,
                "postgres_policies": [
                    {
                        "name": "rls_ac_test_template_11_4_select_location",
                        "using": "true \u003c= (\n  select\t\t\t\n    true\n  from\n          granted_permissions p\n  join ac_test_template_11_4_access_paths usp on\n          usp.location_id = p.location_id\n  where\n    p.user_id = current_setting('app.user_id')\n    and p.permission_name = 'accesscontrol.ac_test_template_11_4.read'\n    and usp.\"ac_test_template_11_4_id\" = ac_test_template_11_4.ac_test_template_11_4_id\n  limit 1\n  )\n",
                        "with_check": "",
                        "for": "select"
                    },
                    {
                        "name": "rls_ac_test_template_11_4_insert_location",
                        "using": "",
                        "with_check": "(\n  1 = 1\n)\n",
                        "for": "insert"
                    },
                    {
                        "name": "rls_ac_test_template_11_4_update_location",
                        "using": "true \u003c= (\n  select\t\t\t\n    true\n  from\n          granted_permissions p\n  join ac_test_template_11_4_access_paths usp on\n          usp.location_id = p.location_id\n  where\n    p.user_id = current_setting('app.user_id')\n    and p.permission_name = 'accesscontrol.ac_test_template_11_4.write'\n    and usp.\"ac_test_template_11_4_id\" = ac_test_template_11_4.ac_test_template_11_4_id\n  limit 1\n  )\n",
                        "with_check": "true \u003c= (\n  select\t\t\t\n    true\n  from\n          granted_permissions p\n  join ac_test_template_11_4_access_paths usp on\n          usp.location_id = p.location_id\n  where\n    p.user_id = current_setting('app.user_id')\n    and p.permission_name = 'accesscontrol.ac_test_template_11_4.write'\n    and usp.\"ac_test_template_11_4_id\" = ac_test_template_11_4.ac_test_template_11_4_id\n  limit 1\n  )\n",
                        "for": "update"
                    },
                    {
                        "name": "rls_ac_test_template_11_4_delete_location",
                        "using": "true \u003c= (\n  select\t\t\t\n    true\n  from\n          granted_permissions p\n  join ac_test_template_11_4_access_paths usp on\n          usp.location_id = p.location_id\n  where\n    p.user_id = current_setting('app.user_id')\n    and p.permission_name = 'accesscontrol.ac_test_template_11_4.write'\n    and usp.\"ac_test_template_11_4_id\" = ac_test_template_11_4.ac_test_template_11_4_id\n  limit 1\n  )\n",
                        "with_check": "",
                        "for": "delete"
                    },
                    {
                        "name": "rls_ac_test_template_11_4_permission_v4",
                        "using": "current_setting('app.user_id') = owners\n",
                        "with_check": "",
                        "for": "all"
                    }
                ],
                "use_custom_hasura_policy": null
            }
        ]
    },
    {
        "filename": "accesscontrol/mastermgmt/archtechture.ac_test_template_4.yaml",
        "service": "mastermgmt",
        "revision": 3,
        "table_name": "ac_test_template_4",
        "created_at": "2022-10-17T13:58:12.614513612+07:00",
        "updated_at": "2022-10-17T13:58:12.614513645+07:00",
        "stages": [
            {
                "template": "4",
                "hasura": {
                    "stage_dir": "deployments/helm/manabie-all-in-one/charts/mastermgmt/files/hasura/metadata/tables.yaml",
                    "permissions": [
                        "SELECT",
                        "INSERT",
                        "UPDATE",
                        "DELETE"
                    ],
                    "relationship": "ac_test_template_4_location_permission",
                    "first_level_query": "owners",
                    "hasura_policies": {
                        "select_permission": [
                            {
                                "name": "USER_GROUP_ADMIN",
                                "filter": {
                                    "owners": {
                                        "_eq": "X-Hasura-User-Id"
                                    }
                                }
                            },
                            {
                                "name": "MANABIE",
                                "filter": {
                                    "owners": {
                                        "_eq": "X-Hasura-User-Id"
                                    }
                                }
                            }
                        ],
                        "insert_permission": [
                            {
                                "name": "USER_GROUP_ADMIN",
                                "check": {
                                    "owners": {
                                        "_eq": "X-Hasura-User-Id"
                                    }
                                }
                            }
                        ],
                        "delete_permission": [
                            {
                                "name": "USER_GROUP_ADMIN",
                                "filter": {
                                    "owners": {
                                        "_eq": "X-Hasura-User-Id"
                                    }
                                },
                                "check": {
                                    "owners": {
                                        "_eq": "X-Hasura-User-Id"
                                    }
                                }
                            }
                        ],
                        "update_permission": [
                            {
                                "name": "USER_GROUP_ADMIN",
                                "filter": {
                                    "owners": {
                                        "_eq": "X-Hasura-User-Id"
                                    }
                                },
                                "check": {
                                    "owners": {
                                        "_eq": "X-Hasura-User-Id"
                                    }
                                }
                            }
                        ]
                    }
                },
                "postgres": {
                    "stage_dir": "migrations/mastermgmt/1026_migrate.up.sql",
                    "policies": [
                        {
                            "name": "rls_ac_test_template_4_permission_v4",
                            "content": "DROP POLICY IF EXISTS rls_ac_test_template_4 on ac_test_template_4;\nCREATE POLICY rls_ac_test_template_4_permission_v4 ON ac_test_template_4 AS PERMISSIVE FOR ALL TO PUBLIC\nusing (\n\tcurrent_setting('app.user_id') = owners\n)\nwith check (\n\tcurrent_setting('app.user_id') = owners\n);"
                        }
                    ]
                },
                "accessPathTable": null,
                "locationCol": null,
                "permissionPrefix": null,
                "permissions": {
                    "postgres": [],
                    "hasura": []
                },
                "ownerCol": "owners",
                "use_custom_policy": null,
                "hasura_policies": null,
                "postgres_policies": null,
                "use_custom_hasura_policy": null
            }
        ]
    },
    {
        "filename": "accesscontrol/notificationmgmt/master.location.yaml",
        "service": "notificationmgmt",
        "revision": 1,
        "table_name": "locations",
        "created_at": "2023-04-25T16:35:51.57062507+07:00",
        "updated_at": "2023-04-25T16:35:51.570625125+07:00",
        "stages": [
            {
                "template": "1",
                "hasura": null,
                "postgres": null,
                "accessPathTable": null,
                "locationCol": null,
                "permissionPrefix": null,
                "permissions": null,
                "ownerCol": null,
                "use_custom_policy": true,
                "hasura_policies": null,
                "postgres_policies": [
                    {
                        "name": "rls_locations_location",
                        "using": "location_id in (\n  select\n    p.location_id\n  from\n          granted_permissions p\n  where\n    p.user_id = current_setting('app.user_id')\n    and p.permission_id = (\n      select\n        p2.permission_id\n      from\n        \"permission\" p2\n      where\n        p2.permission_name = 'master.location.read'\n        and p2.resource_path = current_setting('permission.resource_path'))\n  )\n",
                        "with_check": "exists (\n  select\n    true\n  from\n          granted_permissions p\n  where\n    p.user_id = current_setting('app.user_id')\n    and p.permission_id = (\n      select\n        p2.permission_id\n      from\n        \"permission\" p2\n      where\n        p2.permission_name = 'master.location.write'\n        and p2.resource_path = current_setting('permission.resource_path'))\n  )\n",
                        "for": "all"
                    }
                ],
                "use_custom_hasura_policy": null
            }
        ]
    },
    {
        "filename": "accesscontrol/notificationmgmt/users.user_access_paths.yaml",
        "service": "notificationmgmt",
        "revision": 1,
        "table_name": "user_access_paths",
        "created_at": "2023-04-25T16:35:51.570943635+07:00",
        "updated_at": "2023-04-25T16:35:51.570943684+07:00",
        "stages": [
            {
                "template": "1",
                "hasura": null,
                "postgres": {
                    "stage_dir": "migrations/notificationmgmt/1010_migrate.up.sql",
                    "policies": [
                        {
                            "name": "rls_user_access_paths_location",
                            "content": "DROP POLICY IF EXISTS rls_user_access_paths on \"user_access_paths\";\nCREATE POLICY rls_user_access_paths_location ON \"user_access_paths\" AS PERMISSIVE FOR ALL TO PUBLIC\nusing (\n\tlocation_id in (\n\t\tselect\t\t\t\n\t\t\tp.location_id\n\t\tfrom\n\t\t\t\t\t\tgranted_permissions p\n\t\twhere\n\t\t\tp.user_id = current_setting('app.user_id')\n\t\t\tand p.permission_id = (\n\t\t\t\tselect\n\t\t\t\t\tp2.permission_id\n\t\t\t\tfrom\n\t\t\t\t\t\"permission\" p2\n\t\t\t\twhere\n\t\t\t\t\tp2.permission_name = 'user.user.read'\n\t\t\t\t\tand p2.resource_path = current_setting('permission.resource_path'))\n\t\t)\n)\nwith check (\n\tlocation_id in (\n\t\tselect\t\t\t\n\t\t\tp.location_id\n\t\tfrom\n\t\t\t\t\t\tgranted_permissions p\n\t\twhere\n\t\t\tp.user_id = current_setting('app.user_id')\n\t\t\tand p.permission_id = (\n\t\t\t\tselect\n\t\t\t\t\tp2.permission_id\n\t\t\t\tfrom\n\t\t\t\t\t\"permission\" p2\n\t\t\t\twhere\n\t\t\t\t\tp2.permission_name = 'user.user.write'\n\t\t\t\t\tand p2.resource_path = current_setting('permission.resource_path'))\n\t\t)\n);"
                        }
                    ]
                },
                "accessPathTable": null,
                "locationCol": null,
                "permissionPrefix": "user.user",
                "permissions": {
                    "postgres": [],
                    "hasura": null
                },
                "ownerCol": null,
                "use_custom_policy": null,
                "hasura_policies": null,
                "postgres_policies": null,
                "use_custom_hasura_policy": null
            }
        ]
    },
    {
        "filename": "accesscontrol/notificationmgmt/users.users.yaml",
        "service": "notificationmgmt",
        "revision": 1,
        "table_name": "users",
        "created_at": "2023-04-25T16:07:46.528075705+07:00",
        "updated_at": "2023-04-25T16:07:46.528075772+07:00",
        "stages": [
            {
                "template": "1.1",
                "hasura": null,
                "postgres": {
                    "stage_dir": "migrations/notificationmgmt/1007_migrate.up.sql",
                    "policies": [
                        {
                            "name": "rls_users_select_location",
                            "content": "CREATE POLICY rls_users_select_location ON \"users\" AS PERMISSIVE FOR select TO PUBLIC\nusing (\ntrue \u003c= (\n\tselect\t\t\t\n\t\ttrue\n\tfrom\n\t\t\t\t\tgranted_permissions p\n\tjoin user_access_paths usp on\n\t\t\t\t\tusp.location_id = p.location_id\n\twhere\n\t\tp.user_id = current_setting('app.user_id')\n\t\tand p.permission_id = (\n\t\t\tselect\n\t\t\t\tp2.permission_id\n\t\t\tfrom\n\t\t\t\t\"permission\" p2\n\t\t\twhere\n\t\t\t\tp2.permission_name = 'user.user.read'\n\t\t\t\tand p2.resource_path = current_setting('permission.resource_path'))\n\t\tand usp.\"user_id\" = users.user_id\n\t\tand usp.deleted_at is null\n\tlimit 1\n\t)\n)\n;"
                        },
                        {
                            "name": "rls_users_update_location",
                            "content": "CREATE POLICY rls_users_update_location ON \"users\" AS PERMISSIVE FOR update TO PUBLIC\nusing (\ntrue \u003c= (\n\tselect\t\t\t\n\t\ttrue\n\tfrom\n\t\t\t\t\tgranted_permissions p\n\tjoin user_access_paths usp on\n\t\t\t\t\tusp.location_id = p.location_id\n\twhere\n\t\tp.user_id = current_setting('app.user_id')\n\t\tand p.permission_id = (\n\t\t\tselect\n\t\t\t\tp2.permission_id\n\t\t\tfrom\n\t\t\t\t\"permission\" p2\n\t\t\twhere\n\t\t\t\tp2.permission_name = 'user.user.write'\n\t\t\t\tand p2.resource_path = current_setting('permission.resource_path'))\n\t\tand usp.\"user_id\" = users.user_id\n\t\tand usp.deleted_at is null\n\tlimit 1\n\t)\n)with check (\ntrue \u003c= (\n\tselect\t\t\t\n\t\ttrue\n\tfrom\n\t\t\t\t\tgranted_permissions p\n\tjoin user_access_paths usp on\n\t\t\t\t\tusp.location_id = p.location_id\n\twhere\n\t\tp.user_id = current_setting('app.user_id')\n\t\tand p.permission_id = (\n\t\t\tselect\n\t\t\t\tp2.permission_id\n\t\t\tfrom\n\t\t\t\t\"permission\" p2\n\t\t\twhere\n\t\t\t\tp2.permission_name = 'user.user.write'\n\t\t\t\tand p2.resource_path = current_setting('permission.resource_path'))\n\t\tand usp.\"user_id\" = users.user_id\n\t\tand usp.deleted_at is null\n\tlimit 1\n\t)\n)\n;"
                        },
                        {
                            "name": "rls_users_delete_location",
                            "content": "CREATE POLICY rls_users_delete_location ON \"users\" AS PERMISSIVE FOR delete TO PUBLIC\nusing (\ntrue \u003c= (\n\tselect\t\t\t\n\t\ttrue\n\tfrom\n\t\t\t\t\tgranted_permissions p\n\tjoin user_access_paths usp on\n\t\t\t\t\tusp.location_id = p.location_id\n\twhere\n\t\tp.user_id = current_setting('app.user_id')\n\t\tand p.permission_id = (\n\t\t\tselect\n\t\t\t\tp2.permission_id\n\t\t\tfrom\n\t\t\t\t\"permission\" p2\n\t\t\twhere\n\t\t\t\tp2.permission_name = 'user.user.write'\n\t\t\t\tand p2.resource_path = current_setting('permission.resource_path'))\n\t\tand usp.\"user_id\" = users.user_id\n\t\tand usp.deleted_at is null\n\tlimit 1\n\t)\n)\n;"
                        },
                        {
                            "name": "rls_users_insert_location",
                            "content": "CREATE POLICY rls_users_insert_location ON \"users\" AS PERMISSIVE FOR INSERT TO PUBLIC\nwith check (\n\t1 = 1\n);\n"
                        }
                    ]
                },
                "accessPathTable": {
                    "name": "user_access_paths",
                    "columnMapping": {
                        "user_id": "user_id"
                    }
                },
                "locationCol": "location_id",
                "permissionPrefix": "user.user",
                "permissions": {
                    "postgres": [],
                    "hasura": null
                },
                "ownerCol": null,
                "use_custom_policy": null,
                "hasura_policies": null,
                "postgres_policies": null,
                "use_custom_hasura_policy": null
            },
            {
                "template": "4",
                "hasura": null,
                "postgres": {
                    "stage_dir": "migrations/notificationmgmt/1008_migrate.up.sql",
                    "policies": [
                        {
                            "name": "rls_users_permission_v4",
                            "content": "DROP POLICY IF EXISTS rls_users on \"users\";\nCREATE POLICY rls_users_permission_v4 ON \"users\" AS PERMISSIVE FOR ALL TO PUBLIC\nusing (\n\tcurrent_setting('app.user_id') = user_id\n)\nwith check (\n\tcurrent_setting('app.user_id') = user_id\n);"
                        }
                    ]
                },
                "accessPathTable": null,
                "locationCol": null,
                "permissionPrefix": null,
                "permissions": {
                    "postgres": [],
                    "hasura": null
                },
                "ownerCol": "user_id",
                "use_custom_policy": null,
                "hasura_policies": null,
                "postgres_policies": null,
                "use_custom_hasura_policy": null
            }
        ]
    },
    {
        "filename": "accesscontrol/timesheet/timesheet.timesheet.yaml",
        "service": "timesheet",
        "revision": 1,
        "table_name": "timesheet",
        "created_at": "2023-01-04T11:29:20.060448887+07:00",
        "updated_at": "2023-01-04T11:29:20.060448946+07:00",
        "stages": [
            {
                "template": "1",
                "hasura": {
                    "stage_dir": "deployments/helm/manabie-all-in-one/charts/timesheet/files/hasura/metadata/tables.yaml",
                    "permissions": [
                        "SELECT",
                        "INSERT",
                        "UPDATE",
                        "DELETE"
                    ],
                    "relationship": "timesheet_location_permission",
                    "first_level_query": "timesheet_location_permission",
                    "hasura_policies": {
                        "select_permission": [
                            {
                                "name": "MANABIE",
                                "filter": {
                                    "timesheet_location_permission": {
                                        "_and": [
                                            {
                                                "user_id": {
                                                    "_eq": "X-Hasura-User-Id"
                                                }
                                            },
                                            {
                                                "permission_name": {
                                                    "_eq": "timesheet.timesheet.read"
                                                }
                                            }
                                        ]
                                    }
                                }
                            },
                            {
                                "name": "USER_GROUP_SCHOOL_ADMIN",
                                "filter": {
                                    "timesheet_location_permission": {
                                        "_and": [
                                            {
                                                "user_id": {
                                                    "_eq": "X-Hasura-User-Id"
                                                }
                                            },
                                            {
                                                "permission_name": {
                                                    "_eq": "timesheet.timesheet.read"
                                                }
                                            }
                                        ]
                                    }
                                }
                            },
                            {
                                "name": "USER_GROUP_SCHOOL_STAFF",
                                "filter": {
                                    "timesheet_location_permission": {
                                        "_and": [
                                            {
                                                "user_id": {
                                                    "_eq": "X-Hasura-User-Id"
                                                }
                                            },
                                            {
                                                "permission_name": {
                                                    "_eq": "timesheet.timesheet.read"
                                                }
                                            }
                                        ]
                                    }
                                }
                            },
                            {
                                "name": "USER_GROUP_TEACHER",
                                "filter": {
                                    "timesheet_location_permission": {
                                        "_and": [
                                            {
                                                "user_id": {
                                                    "_eq": "X-Hasura-User-Id"
                                                }
                                            },
                                            {
                                                "permission_name": {
                                                    "_eq": "timesheet.timesheet.read"
                                                }
                                            }
                                        ]
                                    }
                                }
                            }
                        ],
                        "insert_permission": [],
                        "delete_permission": [],
                        "update_permission": []
                    }
                },
                "postgres": {
                    "stage_dir": "migrations/timesheet/1065_migrate.up.sql",
                    "policies": [
                        {
                            "name": "rls_timesheet_location",
                            "content": "DROP POLICY IF EXISTS rls_timesheet on \"timesheet\";\nCREATE POLICY rls_timesheet_location ON \"timesheet\" AS PERMISSIVE FOR ALL TO PUBLIC\nusing (\n\tlocation_id in (\n\t\tselect\t\t\t\n\t\t\tp.location_id\n\t\tfrom\n\t\t\t\t\t\tgranted_permissions p\n\t\twhere\n\t\t\tp.user_id = current_setting('app.user_id')\n\t\t\tand p.permission_id = (\n\t\t\t\tselect\n\t\t\t\t\tp2.permission_id\n\t\t\t\tfrom\n\t\t\t\t\t\"permission\" p2\n\t\t\t\twhere\n\t\t\t\t\tp2.permission_name = 'timesheet.timesheet.read'\n\t\t\t\t\tand p2.resource_path = current_setting('permission.resource_path'))\n\t\t)\n)\nwith check (\n\tlocation_id in (\n\t\tselect\t\t\t\n\t\t\tp.location_id\n\t\tfrom\n\t\t\t\t\t\tgranted_permissions p\n\t\twhere\n\t\t\tp.user_id = current_setting('app.user_id')\n\t\t\tand p.permission_id = (\n\t\t\t\tselect\n\t\t\t\t\tp2.permission_id\n\t\t\t\tfrom\n\t\t\t\t\t\"permission\" p2\n\t\t\t\twhere\n\t\t\t\t\tp2.permission_name = 'timesheet.timesheet.write'\n\t\t\t\t\tand p2.resource_path = current_setting('permission.resource_path'))\n\t\t)\n);"
                        }
                    ]
                },
                "accessPathTable": null,
                "locationCol": "location_id",
                "permissionPrefix": "timesheet.timesheet",
                "permissions": {
                    "postgres": [],
                    "hasura": []
                },
                "ownerCol": "staff_id",
                "use_custom_policy": null,
                "hasura_policies": null,
                "postgres_policies": null,
                "use_custom_hasura_policy": null
            },
            {
                "template": "4",
                "hasura": {
                    "stage_dir": "deployments/helm/manabie-all-in-one/charts/timesheet/files/hasura/metadata/tables.yaml",
                    "permissions": [
                        "SELECT",
                        "INSERT",
                        "UPDATE",
                        "DELETE"
                    ],
                    "relationship": "timesheet_location_permission",
                    "first_level_query": "staff_id",
                    "hasura_policies": {
                        "select_permission": [
                            {
                                "name": "MANABIE",
                                "filter": {
                                    "staff_id": {
                                        "_eq": "X-Hasura-User-Id"
                                    }
                                }
                            },
                            {
                                "name": "USER_GROUP_SCHOOL_ADMIN",
                                "filter": {
                                    "staff_id": {
                                        "_eq": "X-Hasura-User-Id"
                                    }
                                }
                            },
                            {
                                "name": "USER_GROUP_SCHOOL_STAFF",
                                "filter": {
                                    "staff_id": {
                                        "_eq": "X-Hasura-User-Id"
                                    }
                                }
                            },
                            {
                                "name": "USER_GROUP_TEACHER",
                                "filter": {
                                    "staff_id": {
                                        "_eq": "X-Hasura-User-Id"
                                    }
                                }
                            }
                        ],
                        "insert_permission": [],
                        "delete_permission": [],
                        "update_permission": []
                    }
                },
                "postgres": {
                    "stage_dir": "migrations/timesheet/1066_migrate.up.sql",
                    "policies": [
                        {
                            "name": "rls_timesheet_permission_v4",
                            "content": "DROP POLICY IF EXISTS rls_timesheet on \"timesheet\";\nCREATE POLICY rls_timesheet_permission_v4 ON \"timesheet\" AS PERMISSIVE FOR ALL TO PUBLIC\nusing (\n\tcurrent_setting('app.user_id') = staff_id\n)\nwith check (\n\tcurrent_setting('app.user_id') = staff_id\n);"
                        }
                    ]
                },
                "accessPathTable": null,
                "locationCol": null,
                "permissionPrefix": null,
                "permissions": {
                    "postgres": [],
                    "hasura": []
                },
                "ownerCol": "staff_id",
                "use_custom_policy": null,
                "hasura_policies": null,
                "postgres_policies": null,
                "use_custom_hasura_policy": null
            }
        ]
    },
    {
        "filename": "accesscontrol/timesheet/user.user_access_paths.yaml",
        "service": "timesheet",
        "revision": 1,
        "table_name": "user_access_paths",
        "created_at": "2023-01-04T11:29:20.063527209+07:00",
        "updated_at": "2023-01-04T11:29:20.063527274+07:00",
        "stages": [
            {
                "template": "1",
                "hasura": {
                    "stage_dir": "deployments/helm/manabie-all-in-one/charts/timesheet/files/hasura/metadata/tables.yaml",
                    "permissions": [
                        "SELECT",
                        "INSERT",
                        "UPDATE",
                        "DELETE"
                    ],
                    "relationship": "user_access_paths_location_permission",
                    "first_level_query": "user_access_paths_location_permission",
                    "hasura_policies": {
                        "select_permission": [
                            {
                                "name": "MANABIE",
                                "filter": {
                                    "user_access_paths_location_permission": {
                                        "_and": [
                                            {
                                                "user_id": {
                                                    "_eq": "X-Hasura-User-Id"
                                                }
                                            },
                                            {
                                                "permission_name": {
                                                    "_eq": "user.user.read"
                                                }
                                            }
                                        ]
                                    }
                                }
                            },
                            {
                                "name": "USER_GROUP_SCHOOL_ADMIN",
                                "filter": {
                                    "user_access_paths_location_permission": {
                                        "_and": [
                                            {
                                                "user_id": {
                                                    "_eq": "X-Hasura-User-Id"
                                                }
                                            },
                                            {
                                                "permission_name": {
                                                    "_eq": "user.user.read"
                                                }
                                            }
                                        ]
                                    }
                                }
                            }
                        ],
                        "insert_permission": [],
                        "delete_permission": [],
                        "update_permission": []
                    }
                },
                "postgres": {
                    "stage_dir": "migrations/timesheet/1067_migrate.up.sql",
                    "policies": [
                        {
                            "name": "rls_user_access_paths_location",
                            "content": "DROP POLICY IF EXISTS rls_user_access_paths on \"user_access_paths\";\nCREATE POLICY rls_user_access_paths_location ON \"user_access_paths\" AS PERMISSIVE FOR ALL TO PUBLIC\nusing (\n\tlocation_id in (\n\t\tselect\t\t\t\n\t\t\tp.location_id\n\t\tfrom\n\t\t\t\t\t\tgranted_permissions p\n\t\twhere\n\t\t\tp.user_id = current_setting('app.user_id')\n\t\t\tand p.permission_id = (\n\t\t\t\tselect\n\t\t\t\t\tp2.permission_id\n\t\t\t\tfrom\n\t\t\t\t\t\"permission\" p2\n\t\t\t\twhere\n\t\t\t\t\tp2.permission_name = 'user.user.read'\n\t\t\t\t\tand p2.resource_path = current_setting('permission.resource_path'))\n\t\t)\n)\nwith check (\n\tlocation_id in (\n\t\tselect\t\t\t\n\t\t\tp.location_id\n\t\tfrom\n\t\t\t\t\t\tgranted_permissions p\n\t\twhere\n\t\t\tp.user_id = current_setting('app.user_id')\n\t\t\tand p.permission_id = (\n\t\t\t\tselect\n\t\t\t\t\tp2.permission_id\n\t\t\t\tfrom\n\t\t\t\t\t\"permission\" p2\n\t\t\t\twhere\n\t\t\t\t\tp2.permission_name = 'user.user.write'\n\t\t\t\t\tand p2.resource_path = current_setting('permission.resource_path'))\n\t\t)\n);"
                        }
                    ]
                },
                "accessPathTable": null,
                "locationCol": null,
                "permissionPrefix": "user.user",
                "permissions": {
                    "postgres": [],
                    "hasura": []
                },
                "ownerCol": null,
                "use_custom_policy": null,
                "hasura_policies": null,
                "postgres_policies": null,
                "use_custom_hasura_policy": null
            }
        ]
    },
    {
        "filename": "accesscontrol/timesheet/user.users.yaml",
        "service": "timesheet",
        "revision": 1,
        "table_name": "users",
        "created_at": "2023-01-04T11:29:20.066815086+07:00",
        "updated_at": "2023-01-04T11:29:20.066815156+07:00",
        "stages": [
            {
                "template": "1.1",
                "hasura": {
                    "stage_dir": "deployments/helm/manabie-all-in-one/charts/timesheet/files/hasura/metadata/tables.yaml",
                    "permissions": [
                        "SELECT",
                        "INSERT",
                        "UPDATE",
                        "DELETE"
                    ],
                    "relationship": "users_location_permission",
                    "first_level_query": "user_access_paths",
                    "hasura_policies": {
                        "select_permission": [
                            {
                                "name": "MANABIE",
                                "filter": {
                                    "user_access_paths": {
                                        "_and": [
                                            {
                                                "users_location_permission": {
                                                    "_and": [
                                                        {
                                                            "user_id": {
                                                                "_eq": "X-Hasura-User-Id"
                                                            }
                                                        },
                                                        {
                                                            "permission_name": {
                                                                "_eq": "user.user.read"
                                                            }
                                                        }
                                                    ]
                                                }
                                            },
                                            {
                                                "deleted_at": {
                                                    "_is_null": true
                                                }
                                            }
                                        ]
                                    }
                                }
                            },
                            {
                                "name": "USER_GROUP_SCHOOL_ADMIN",
                                "filter": {
                                    "user_access_paths": {
                                        "_and": [
                                            {
                                                "users_location_permission": {
                                                    "_and": [
                                                        {
                                                            "user_id": {
                                                                "_eq": "X-Hasura-User-Id"
                                                            }
                                                        },
                                                        {
                                                            "permission_name": {
                                                                "_eq": "user.user.read"
                                                            }
                                                        }
                                                    ]
                                                }
                                            },
                                            {
                                                "deleted_at": {
                                                    "_is_null": true
                                                }
                                            }
                                        ]
                                    }
                                }
                            },
                            {
                                "name": "USER_GROUP_SCHOOL_STAFF",
                                "filter": {
                                    "user_access_paths": {
                                        "_and": [
                                            {
                                                "users_location_permission": {
                                                    "_and": [
                                                        {
                                                            "user_id": {
                                                                "_eq": "X-Hasura-User-Id"
                                                            }
                                                        },
                                                        {
                                                            "permission_name": {
                                                                "_eq": "user.user.read"
                                                            }
                                                        }
                                                    ]
                                                }
                                            },
                                            {
                                                "deleted_at": {
                                                    "_is_null": true
                                                }
                                            }
                                        ]
                                    }
                                }
                            },
                            {
                                "name": "USER_GROUP_TEACHER",
                                "filter": {
                                    "user_access_paths": {
                                        "_and": [
                                            {
                                                "users_location_permission": {
                                                    "_and": [
                                                        {
                                                            "user_id": {
                                                                "_eq": "X-Hasura-User-Id"
                                                            }
                                                        },
                                                        {
                                                            "permission_name": {
                                                                "_eq": "user.user.read"
                                                            }
                                                        }
                                                    ]
                                                }
                                            },
                                            {
                                                "deleted_at": {
                                                    "_is_null": true
                                                }
                                            }
                                        ]
                                    }
                                }
                            }
                        ],
                        "insert_permission": [],
                        "delete_permission": [],
                        "update_permission": []
                    }
                },
                "postgres": {
                    "stage_dir": "migrations/timesheet/1068_migrate.up.sql",
                    "policies": [
                        {
                            "name": "rls_users_select_location",
                            "content": "CREATE POLICY rls_users_select_location ON \"users\" AS PERMISSIVE FOR select TO PUBLIC\nusing (\ntrue \u003c= (\n\tselect\t\t\t\n\t\ttrue\n\tfrom\n\t\t\t\t\tgranted_permissions p\n\tjoin user_access_paths usp on\n\t\t\t\t\tusp.location_id = p.location_id\n\twhere\n\t\tp.user_id = current_setting('app.user_id')\n\t\tand p.permission_id = (\n\t\t\tselect\n\t\t\t\tp2.permission_id\n\t\t\tfrom\n\t\t\t\t\"permission\" p2\n\t\t\twhere\n\t\t\t\tp2.permission_name = 'user.user.read'\n\t\t\t\tand p2.resource_path = current_setting('permission.resource_path'))\n\t\tand usp.\"user_id\" = users.user_id\n\t\tand usp.deleted_at is null\n\tlimit 1\n\t)\n)\n;"
                        },
                        {
                            "name": "rls_users_update_location",
                            "content": "CREATE POLICY rls_users_update_location ON \"users\" AS PERMISSIVE FOR update TO PUBLIC\nusing (\ntrue \u003c= (\n\tselect\t\t\t\n\t\ttrue\n\tfrom\n\t\t\t\t\tgranted_permissions p\n\tjoin user_access_paths usp on\n\t\t\t\t\tusp.location_id = p.location_id\n\twhere\n\t\tp.user_id = current_setting('app.user_id')\n\t\tand p.permission_id = (\n\t\t\tselect\n\t\t\t\tp2.permission_id\n\t\t\tfrom\n\t\t\t\t\"permission\" p2\n\t\t\twhere\n\t\t\t\tp2.permission_name = 'user.user.write'\n\t\t\t\tand p2.resource_path = current_setting('permission.resource_path'))\n\t\tand usp.\"user_id\" = users.user_id\n\t\tand usp.deleted_at is null\n\tlimit 1\n\t)\n)with check (\ntrue \u003c= (\n\tselect\t\t\t\n\t\ttrue\n\tfrom\n\t\t\t\t\tgranted_permissions p\n\tjoin user_access_paths usp on\n\t\t\t\t\tusp.location_id = p.location_id\n\twhere\n\t\tp.user_id = current_setting('app.user_id')\n\t\tand p.permission_id = (\n\t\t\tselect\n\t\t\t\tp2.permission_id\n\t\t\tfrom\n\t\t\t\t\"permission\" p2\n\t\t\twhere\n\t\t\t\tp2.permission_name = 'user.user.write'\n\t\t\t\tand p2.resource_path = current_setting('permission.resource_path'))\n\t\tand usp.\"user_id\" = users.user_id\n\t\tand usp.deleted_at is null\n\tlimit 1\n\t)\n)\n;"
                        },
                        {
                            "name": "rls_users_delete_location",
                            "content": "CREATE POLICY rls_users_delete_location ON \"users\" AS PERMISSIVE FOR delete TO PUBLIC\nusing (\ntrue \u003c= (\n\tselect\t\t\t\n\t\ttrue\n\tfrom\n\t\t\t\t\tgranted_permissions p\n\tjoin user_access_paths usp on\n\t\t\t\t\tusp.location_id = p.location_id\n\twhere\n\t\tp.user_id = current_setting('app.user_id')\n\t\tand p.permission_id = (\n\t\t\tselect\n\t\t\t\tp2.permission_id\n\t\t\tfrom\n\t\t\t\t\"permission\" p2\n\t\t\twhere\n\t\t\t\tp2.permission_name = 'user.user.write'\n\t\t\t\tand p2.resource_path = current_setting('permission.resource_path'))\n\t\tand usp.\"user_id\" = users.user_id\n\t\tand usp.deleted_at is null\n\tlimit 1\n\t)\n)\n;"
                        },
                        {
                            "name": "rls_users_insert_location",
                            "content": "CREATE POLICY rls_users_insert_location ON \"users\" AS PERMISSIVE FOR INSERT TO PUBLIC\nwith check (\n\t1 = 1\n);\n"
                        }
                    ]
                },
                "accessPathTable": {
                    "name": "user_access_paths",
                    "columnMapping": {
                        "user_id": "user_id"
                    }
                },
                "locationCol": "location_id",
                "permissionPrefix": "user.user",
                "permissions": {
                    "postgres": [],
                    "hasura": []
                },
                "ownerCol": null,
                "use_custom_policy": null,
                "hasura_policies": null,
                "postgres_policies": null,
                "use_custom_hasura_policy": null
            }
        ]
    },
    {
        "filename": "accesscontrol/tom/master.location.yaml",
        "service": "tom",
        "revision": 1,
        "table_name": "locations",
        "created_at": "2023-08-02T15:42:28.5158035+07:00",
        "updated_at": "2023-08-02T15:42:28.515803552+07:00",
        "stages": [
            {
                "template": "1",
                "hasura": null,
                "postgres": null,
                "accessPathTable": null,
                "locationCol": null,
                "permissionPrefix": null,
                "permissions": null,
                "ownerCol": null,
                "use_custom_policy": true,
                "hasura_policies": null,
                "postgres_policies": [
                    {
                        "name": "rls_locations_location",
                        "using": "location_id in (\n  select\n    p.location_id\n  from\n          granted_permissions p\n  where\n    p.user_id = current_setting('app.user_id')\n    and p.permission_id = (\n      select\n        p2.permission_id\n      from\n        \"permission\" p2\n      where\n        p2.permission_name = 'master.location.read'\n        and p2.resource_path = current_setting('permission.resource_path'))\n  )\n",
                        "with_check": "exists (\n  select\n    true\n  from\n          granted_permissions p\n  where\n    p.user_id = current_setting('app.user_id')\n    and p.permission_id = (\n      select\n        p2.permission_id\n      from\n        \"permission\" p2\n      where\n        p2.permission_name = 'master.location.write'\n        and p2.resource_path = current_setting('permission.resource_path'))\n  )\n",
                        "for": "all"
                    }
                ],
                "use_custom_hasura_policy": null
            }
        ]
    },
    {
        "filename": "accesscontrol/invoicemgmt/payment.bill_item.yaml",
        "service": "invoicemgmt",
        "revision": 1,
        "table_name": "bill_item",
        "created_at": "2022-12-21T16:36:53.675134278+08:00",
        "updated_at": "2022-12-21T16:36:53.675134336+08:00",
        "stages": [
            {
                "template": "1",
                "hasura": {
                    "stage_dir": "deployments/helm/manabie-all-in-one/charts/invoicemgmt/files/hasura/metadata/tables.yaml",
                    "permissions": [
                        "SELECT",
                        "INSERT",
                        "UPDATE",
                        "DELETE"
                    ],
                    "relationship": "bill_item_location_permission",
                    "first_level_query": "bill_item_location_permission",
                    "hasura_policies": {
                        "select_permission": [
                            {
                                "name": "MANABIE",
                                "filter": {
                                    "bill_item_location_permission": {
                                        "_and": [
                                            {
                                                "user_id": {
                                                    "_eq": "X-Hasura-User-Id"
                                                }
                                            },
                                            {
                                                "permission_name": {
                                                    "_eq": "payment.bill_item.read"
                                                }
                                            }
                                        ]
                                    }
                                }
                            },
                            {
                                "name": "USER_GROUP_SCHOOL_ADMIN",
                                "filter": {
                                    "bill_item_location_permission": {
                                        "_and": [
                                            {
                                                "user_id": {
                                                    "_eq": "X-Hasura-User-Id"
                                                }
                                            },
                                            {
                                                "permission_name": {
                                                    "_eq": "payment.bill_item.read"
                                                }
                                            }
                                        ]
                                    }
                                }
                            },
                            {
                                "name": "USER_GROUP_ADMIN",
                                "filter": {
                                    "bill_item_location_permission": {
                                        "_and": [
                                            {
                                                "user_id": {
                                                    "_eq": "X-Hasura-User-Id"
                                                }
                                            },
                                            {
                                                "permission_name": {
                                                    "_eq": "payment.bill_item.read"
                                                }
                                            }
                                        ]
                                    }
                                }
                            }
                        ],
                        "insert_permission": [],
                        "delete_permission": [],
                        "update_permission": []
                    }
                },
                "postgres": {
                    "stage_dir": "migrations/invoicemgmt/1088_migrate.up.sql",
                    "policies": [
                        {
                            "name": "rls_bill_item_location",
                            "content": "DROP POLICY IF EXISTS rls_bill_item on \"bill_item\";\nCREATE POLICY rls_bill_item_location ON \"bill_item\" AS PERMISSIVE FOR ALL TO PUBLIC\nusing (\n\tlocation_id in (\n\t\tselect\t\t\t\n\t\t\tp.location_id\n\t\tfrom\n\t\t\t\t\t\tgranted_permissions p\n\t\twhere\n\t\t\tp.user_id = current_setting('app.user_id')\n\t\t\tand p.permission_id = (\n\t\t\t\tselect\n\t\t\t\t\tp2.permission_id\n\t\t\t\tfrom\n\t\t\t\t\t\"permission\" p2\n\t\t\t\twhere\n\t\t\t\t\tp2.permission_name = 'payment.bill_item.read'\n\t\t\t\t\tand p2.resource_path = current_setting('permission.resource_path'))\n\t\t)\n)\nwith check (\n\tlocation_id in (\n\t\tselect\t\t\t\n\t\t\tp.location_id\n\t\tfrom\n\t\t\t\t\t\tgranted_permissions p\n\t\twhere\n\t\t\tp.user_id = current_setting('app.user_id')\n\t\t\tand p.permission_id = (\n\t\t\t\tselect\n\t\t\t\t\tp2.permission_id\n\t\t\t\tfrom\n\t\t\t\t\t\"permission\" p2\n\t\t\t\twhere\n\t\t\t\t\tp2.permission_name = 'payment.bill_item.write'\n\t\t\t\t\tand p2.resource_path = current_setting('permission.resource_path'))\n\t\t)\n);"
                        }
                    ]
                },
                "accessPathTable": null,
                "locationCol": null,
                "permissionPrefix": "payment.bill_item",
                "permissions": {
                    "postgres": [],
                    "hasura": []
                },
                "ownerCol": null,
                "use_custom_policy": null,
                "hasura_policies": null,
                "postgres_policies": null,
                "use_custom_hasura_policy": null
            }
        ]
    },
    {
        "filename": "accesscontrol/invoicemgmt/payment.invoice.yaml",
        "service": "invoicemgmt",
        "revision": 2,
        "table_name": "invoice",
        "created_at": "2023-08-16T17:49:04.324654731+08:00",
        "updated_at": "2023-08-16T17:49:04.324654852+08:00",
        "stages": [
            {
                "template": "1",
                "hasura": {
                    "stage_dir": "deployments/helm/manabie-all-in-one/charts/invoicemgmt/files/hasura/metadata/tables.yaml",
                    "permissions": [
                        "SELECT",
                        "INSERT",
                        "UPDATE",
                        "DELETE"
                    ],
                    "relationship": "invoice_location_permission",
                    "first_level_query": "user_access_paths",
                    "hasura_policies": {
                        "select_permission": [
                            {
                                "name": "MANABIE",
                                "filter": {
                                    "user_access_paths": {
                                        "_and": [
                                            {
                                                "invoice_location_permission": {
                                                    "_and": [
                                                        {
                                                            "user_id": {
                                                                "_eq": "X-Hasura-User-Id"
                                                            }
                                                        },
                                                        {
                                                            "permission_name": {
                                                                "_eq": "payment.invoice.read"
                                                            }
                                                        }
                                                    ]
                                                }
                                            },
                                            {
                                                "deleted_at": {
                                                    "_is_null": true
                                                }
                                            }
                                        ]
                                    }
                                }
                            },
                            {
                                "name": "USER_GROUP_SCHOOL_ADMIN",
                                "filter": {
                                    "user_access_paths": {
                                        "_and": [
                                            {
                                                "invoice_location_permission": {
                                                    "_and": [
                                                        {
                                                            "user_id": {
                                                                "_eq": "X-Hasura-User-Id"
                                                            }
                                                        },
                                                        {
                                                            "permission_name": {
                                                                "_eq": "payment.invoice.read"
                                                            }
                                                        }
                                                    ]
                                                }
                                            },
                                            {
                                                "deleted_at": {
                                                    "_is_null": true
                                                }
                                            }
                                        ]
                                    }
                                }
                            },
                            {
                                "name": "USER_GROUP_TEACHER",
                                "filter": {
                                    "user_access_paths": {
                                        "_and": [
                                            {
                                                "invoice_location_permission": {
                                                    "_and": [
                                                        {
                                                            "user_id": {
                                                                "_eq": "X-Hasura-User-Id"
                                                            }
                                                        },
                                                        {
                                                            "permission_name": {
                                                                "_eq": "payment.invoice.read"
                                                            }
                                                        }
                                                    ]
                                                }
                                            },
                                            {
                                                "deleted_at": {
                                                    "_is_null": true
                                                }
                                            }
                                        ]
                                    }
                                }
                            }
                        ],
                        "insert_permission": [],
                        "delete_permission": [],
                        "update_permission": []
                    }
                },
                "postgres": {
                    "stage_dir": "migrations/invoicemgmt/1139_migrate.up.sql",
                    "policies": [
                        {
                            "name": "rls_invoice_location",
                            "content": "DROP POLICY IF EXISTS rls_invoice on \"invoice\";\nCREATE POLICY rls_invoice_location ON \"invoice\" AS PERMISSIVE FOR ALL TO PUBLIC\nusing (\nstudent_id in (\n\tselect\t\t\t\n\t\tusp.\"user_id\"\n\tfrom\n\t\t\t\t\tgranted_permissions p\n\tjoin user_access_paths usp on\n\t\t\t\t\tusp.location_id = p.location_id\n\twhere\n\t\tp.user_id = current_setting('app.user_id')\n\t\tand p.permission_id = (\n\t\t\tselect\n\t\t\t\tp2.permission_id\n\t\t\tfrom\n\t\t\t\t\"permission\" p2\n\t\t\twhere\n\t\t\t\tp2.permission_name = 'payment.invoice.read'\n\t\t\t\tand p2.resource_path = current_setting('permission.resource_path'))\n\t\tand usp.deleted_at is null\n\t)\n)\nwith check (\nstudent_id in (\n\tselect\t\t\t\n\t\tusp.\"user_id\"\n\tfrom\n\t\t\t\t\tgranted_permissions p\n\tjoin user_access_paths usp on\n\t\t\t\t\tusp.location_id = p.location_id\n\twhere\n\t\tp.user_id = current_setting('app.user_id')\n\t\tand p.permission_id = (\n\t\t\tselect\n\t\t\t\tp2.permission_id\n\t\t\tfrom\n\t\t\t\t\"permission\" p2\n\t\t\twhere\n\t\t\t\tp2.permission_name = 'payment.invoice.write'\n\t\t\t\tand p2.resource_path = current_setting('permission.resource_path'))\n\t\tand usp.deleted_at is null\n\t)\n);"
                        }
                    ]
                },
                "accessPathTable": {
                    "name": "user_access_paths",
                    "columnMapping": {
                        "student_id": "user_id"
                    }
                },
                "locationCol": "location_id",
                "permissionPrefix": "payment.invoice",
                "permissions": {
                    "postgres": [],
                    "hasura": []
                },
                "ownerCol": null,
                "use_custom_policy": null,
                "hasura_policies": null,
                "postgres_policies": null,
                "use_custom_hasura_policy": null,
                "postgres_policy_version": 1
            }
        ]
    },
    {
        "filename": "accesscontrol/invoicemgmt/payment.order.yaml",
        "service": "invoicemgmt",
        "revision": 1,
        "table_name": "order",
        "created_at": "2022-12-21T16:36:53.718879964+08:00",
        "updated_at": "2022-12-21T16:36:53.718880033+08:00",
        "stages": [
            {
                "template": "1",
                "hasura": null,
                "postgres": {
                    "stage_dir": "migrations/invoicemgmt/1091_migrate.up.sql",
                    "policies": [
                        {
                            "name": "rls_order_location",
                            "content": "DROP POLICY IF EXISTS rls_order on \"order\";\nCREATE POLICY rls_order_location ON \"order\" AS PERMISSIVE FOR ALL TO PUBLIC\nusing (\n\tlocation_id in (\n\t\tselect\t\t\t\n\t\t\tp.location_id\n\t\tfrom\n\t\t\t\t\t\tgranted_permissions p\n\t\twhere\n\t\t\tp.user_id = current_setting('app.user_id')\n\t\t\tand p.permission_id = (\n\t\t\t\tselect\n\t\t\t\t\tp2.permission_id\n\t\t\t\tfrom\n\t\t\t\t\t\"permission\" p2\n\t\t\t\twhere\n\t\t\t\t\tp2.permission_name = 'payment.order.read'\n\t\t\t\t\tand p2.resource_path = current_setting('permission.resource_path'))\n\t\t)\n)\nwith check (\n\tlocation_id in (\n\t\tselect\t\t\t\n\t\t\tp.location_id\n\t\tfrom\n\t\t\t\t\t\tgranted_permissions p\n\t\twhere\n\t\t\tp.user_id = current_setting('app.user_id')\n\t\t\tand p.permission_id = (\n\t\t\t\tselect\n\t\t\t\t\tp2.permission_id\n\t\t\t\tfrom\n\t\t\t\t\t\"permission\" p2\n\t\t\t\twhere\n\t\t\t\t\tp2.permission_name = 'payment.order.write'\n\t\t\t\t\tand p2.resource_path = current_setting('permission.resource_path'))\n\t\t)\n);"
                        }
                    ]
                },
                "accessPathTable": null,
                "locationCol": null,
                "permissionPrefix": "payment.order",
                "permissions": {
                    "postgres": [],
                    "hasura": null
                },
                "ownerCol": null,
                "use_custom_policy": null,
                "hasura_policies": null,
                "postgres_policies": null,
                "use_custom_hasura_policy": null
            }
        ]
    },
    {
        "filename": "accesscontrol/invoicemgmt/payment.payment.yaml",
        "service": "invoicemgmt",
        "revision": 2,
        "table_name": "payment",
        "created_at": "2023-08-16T17:49:04.325634231+08:00",
        "updated_at": "2023-08-16T17:49:04.325634277+08:00",
        "stages": [
            {
                "template": "1",
                "hasura": null,
                "postgres": {
                    "stage_dir": "migrations/invoicemgmt/1141_migrate.up.sql",
                    "policies": [
                        {
                            "name": "rls_payment_location",
                            "content": "DROP POLICY IF EXISTS rls_payment on \"payment\";\nCREATE POLICY rls_payment_location ON \"payment\" AS PERMISSIVE FOR ALL TO PUBLIC\nusing (\nstudent_id in (\n\tselect\t\t\t\n\t\tusp.\"user_id\"\n\tfrom\n\t\t\t\t\tgranted_permissions p\n\tjoin user_access_paths usp on\n\t\t\t\t\tusp.location_id = p.location_id\n\twhere\n\t\tp.user_id = current_setting('app.user_id')\n\t\tand p.permission_id = (\n\t\t\tselect\n\t\t\t\tp2.permission_id\n\t\t\tfrom\n\t\t\t\t\"permission\" p2\n\t\t\twhere\n\t\t\t\tp2.permission_name = 'payment.payment.read'\n\t\t\t\tand p2.resource_path = current_setting('permission.resource_path'))\n\t\tand usp.deleted_at is null\n\t)\n)\nwith check (\nstudent_id in (\n\tselect\t\t\t\n\t\tusp.\"user_id\"\n\tfrom\n\t\t\t\t\tgranted_permissions p\n\tjoin user_access_paths usp on\n\t\t\t\t\tusp.location_id = p.location_id\n\twhere\n\t\tp.user_id = current_setting('app.user_id')\n\t\tand p.permission_id = (\n\t\t\tselect\n\t\t\t\tp2.permission_id\n\t\t\tfrom\n\t\t\t\t\"permission\" p2\n\t\t\twhere\n\t\t\t\tp2.permission_name = 'payment.payment.write'\n\t\t\t\tand p2.resource_path = current_setting('permission.resource_path'))\n\t\tand usp.deleted_at is null\n\t)\n);"
                        }
                    ]
                },
                "accessPathTable": {
                    "name": "user_access_paths",
                    "columnMapping": {
                        "student_id": "user_id"
                    }
                },
                "locationCol": "location_id",
                "permissionPrefix": "payment.payment",
                "permissions": {
                    "postgres": [],
                    "hasura": null
                },
                "ownerCol": null,
                "use_custom_policy": null,
                "hasura_policies": null,
                "postgres_policies": null,
                "use_custom_hasura_policy": null,
                "postgres_policy_version": 1
            }
        ]
    },
    {
        "filename": "accesscontrol/invoicemgmt/users.students.yaml",
        "service": "invoicemgmt",
        "revision": 1,
        "table_name": "students",
        "created_at": "2022-12-21T16:36:53.740424833+08:00",
        "updated_at": "2022-12-21T16:36:53.740424883+08:00",
        "stages": [
            {
                "template": "1.1",
                "hasura": {
                    "stage_dir": "deployments/helm/manabie-all-in-one/charts/invoicemgmt/files/hasura/metadata/tables.yaml",
                    "permissions": [
                        "SELECT",
                        "INSERT",
                        "UPDATE",
                        "DELETE"
                    ],
                    "relationship": "students_location_permission",
                    "first_level_query": "user_access_paths",
                    "hasura_policies": {
                        "select_permission": [
                            {
                                "name": "MANABIE",
                                "filter": {
                                    "user_access_paths": {
                                        "_and": [
                                            {
                                                "students_location_permission": {
                                                    "_and": [
                                                        {
                                                            "user_id": {
                                                                "_eq": "X-Hasura-User-Id"
                                                            }
                                                        },
                                                        {
                                                            "permission_name": {
                                                                "_eq": "user.student.read"
                                                            }
                                                        }
                                                    ]
                                                }
                                            },
                                            {
                                                "deleted_at": {
                                                    "_is_null": true
                                                }
                                            }
                                        ]
                                    }
                                }
                            },
                            {
                                "name": "USER_GROUP_SCHOOL_ADMIN",
                                "filter": {
                                    "user_access_paths": {
                                        "_and": [
                                            {
                                                "students_location_permission": {
                                                    "_and": [
                                                        {
                                                            "user_id": {
                                                                "_eq": "X-Hasura-User-Id"
                                                            }
                                                        },
                                                        {
                                                            "permission_name": {
                                                                "_eq": "user.student.read"
                                                            }
                                                        }
                                                    ]
                                                }
                                            },
                                            {
                                                "deleted_at": {
                                                    "_is_null": true
                                                }
                                            }
                                        ]
                                    }
                                }
                            },
                            {
                                "name": "USER_GROUP_ADMIN",
                                "filter": {
                                    "user_access_paths": {
                                        "_and": [
                                            {
                                                "students_location_permission": {
                                                    "_and": [
                                                        {
                                                            "user_id": {
                                                                "_eq": "X-Hasura-User-Id"
                                                            }
                                                        },
                                                        {
                                                            "permission_name": {
                                                                "_eq": "user.student.read"
                                                            }
                                                        }
                                                    ]
                                                }
                                            },
                                            {
                                                "deleted_at": {
                                                    "_is_null": true
                                                }
                                            }
                                        ]
                                    }
                                }
                            },
                            {
                                "name": "USER_GROUP_TEACHER",
                                "filter": {
                                    "user_access_paths": {
                                        "_and": [
                                            {
                                                "students_location_permission": {
                                                    "_and": [
                                                        {
                                                            "user_id": {
                                                                "_eq": "X-Hasura-User-Id"
                                                            }
                                                        },
                                                        {
                                                            "permission_name": {
                                                                "_eq": "user.student.read"
                                                            }
                                                        }
                                                    ]
                                                }
                                            },
                                            {
                                                "deleted_at": {
                                                    "_is_null": true
                                                }
                                            }
                                        ]
                                    }
                                }
                            }
                        ],
                        "insert_permission": [],
                        "delete_permission": [],
                        "update_permission": []
                    }
                },
                "postgres": {
                    "stage_dir": "migrations/invoicemgmt/1094_migrate.up.sql",
                    "policies": [
                        {
                            "name": "rls_students_select_location",
                            "content": "CREATE POLICY rls_students_select_location ON \"students\" AS PERMISSIVE FOR select TO PUBLIC\nusing (\ntrue \u003c= (\n\tselect\t\t\t\n\t\ttrue\n\tfrom\n\t\t\t\t\tgranted_permissions p\n\tjoin user_access_paths usp on\n\t\t\t\t\tusp.location_id = p.location_id\n\twhere\n\t\tp.user_id = current_setting('app.user_id')\n\t\tand p.permission_id = (\n\t\t\tselect\n\t\t\t\tp2.permission_id\n\t\t\tfrom\n\t\t\t\t\"permission\" p2\n\t\t\twhere\n\t\t\t\tp2.permission_name = 'user.student.read'\n\t\t\t\tand p2.resource_path = current_setting('permission.resource_path'))\n\t\tand usp.\"user_id\" = students.student_id\n\t\tand usp.deleted_at is null\n\tlimit 1\n\t)\n)\n;"
                        },
                        {
                            "name": "rls_students_update_location",
                            "content": "CREATE POLICY rls_students_update_location ON \"students\" AS PERMISSIVE FOR update TO PUBLIC\nusing (\ntrue \u003c= (\n\tselect\t\t\t\n\t\ttrue\n\tfrom\n\t\t\t\t\tgranted_permissions p\n\tjoin user_access_paths usp on\n\t\t\t\t\tusp.location_id = p.location_id\n\twhere\n\t\tp.user_id = current_setting('app.user_id')\n\t\tand p.permission_id = (\n\t\t\tselect\n\t\t\t\tp2.permission_id\n\t\t\tfrom\n\t\t\t\t\"permission\" p2\n\t\t\twhere\n\t\t\t\tp2.permission_name = 'user.student.write'\n\t\t\t\tand p2.resource_path = current_setting('permission.resource_path'))\n\t\tand usp.\"user_id\" = students.student_id\n\t\tand usp.deleted_at is null\n\tlimit 1\n\t)\n)with check (\ntrue \u003c= (\n\tselect\t\t\t\n\t\ttrue\n\tfrom\n\t\t\t\t\tgranted_permissions p\n\tjoin user_access_paths usp on\n\t\t\t\t\tusp.location_id = p.location_id\n\twhere\n\t\tp.user_id = current_setting('app.user_id')\n\t\tand p.permission_id = (\n\t\t\tselect\n\t\t\t\tp2.permission_id\n\t\t\tfrom\n\t\t\t\t\"permission\" p2\n\t\t\twhere\n\t\t\t\tp2.permission_name = 'user.student.write'\n\t\t\t\tand p2.resource_path = current_setting('permission.resource_path'))\n\t\tand usp.\"user_id\" = students.student_id\n\t\tand usp.deleted_at is null\n\tlimit 1\n\t)\n)\n;"
                        },
                        {
                            "name": "rls_students_delete_location",
                            "content": "CREATE POLICY rls_students_delete_location ON \"students\" AS PERMISSIVE FOR delete TO PUBLIC\nusing (\ntrue \u003c= (\n\tselect\t\t\t\n\t\ttrue\n\tfrom\n\t\t\t\t\tgranted_permissions p\n\tjoin user_access_paths usp on\n\t\t\t\t\tusp.location_id = p.location_id\n\twhere\n\t\tp.user_id = current_setting('app.user_id')\n\t\tand p.permission_id = (\n\t\t\tselect\n\t\t\t\tp2.permission_id\n\t\t\tfrom\n\t\t\t\t\"permission\" p2\n\t\t\twhere\n\t\t\t\tp2.permission_name = 'user.student.write'\n\t\t\t\tand p2.resource_path = current_setting('permission.resource_path'))\n\t\tand usp.\"user_id\" = students.student_id\n\t\tand usp.deleted_at is null\n\tlimit 1\n\t)\n)\n;"
                        },
                        {
                            "name": "rls_students_insert_location",
                            "content": "CREATE POLICY rls_students_insert_location ON \"students\" AS PERMISSIVE FOR INSERT TO PUBLIC\nwith check (\n\t1 = 1\n);\n"
                        }
                    ]
                },
                "accessPathTable": {
                    "name": "user_access_paths",
                    "columnMapping": {
                        "student_id": "user_id"
                    }
                },
                "locationCol": "location_id",
                "permissionPrefix": "user.student",
                "permissions": {
                    "postgres": [],
                    "hasura": []
                },
                "ownerCol": null,
                "use_custom_policy": null,
                "hasura_policies": null,
                "postgres_policies": null,
                "use_custom_hasura_policy": null
            }
        ]
    },
    {
        "filename": "accesscontrol/invoicemgmt/users.user_access_paths.yaml",
        "service": "invoicemgmt",
        "revision": 1,
        "table_name": "user_access_paths",
        "created_at": "2022-12-21T16:36:53.759340012+08:00",
        "updated_at": "2022-12-21T16:36:53.75934014+08:00",
        "stages": [
            {
                "template": "1",
                "hasura": {
                    "stage_dir": "deployments/helm/manabie-all-in-one/charts/invoicemgmt/files/hasura/metadata/tables.yaml",
                    "permissions": [
                        "SELECT",
                        "INSERT",
                        "UPDATE",
                        "DELETE"
                    ],
                    "relationship": "user_access_paths_location_permission",
                    "first_level_query": "user_access_paths_location_permission",
                    "hasura_policies": {
                        "select_permission": [
                            {
                                "name": "MANABIE",
                                "filter": {
                                    "user_access_paths_location_permission": {
                                        "_and": [
                                            {
                                                "user_id": {
                                                    "_eq": "X-Hasura-User-Id"
                                                }
                                            },
                                            {
                                                "permission_name": {
                                                    "_eq": "user.user.read"
                                                }
                                            }
                                        ]
                                    }
                                }
                            },
                            {
                                "name": "USER_GROUP_SCHOOL_ADMIN",
                                "filter": {
                                    "user_access_paths_location_permission": {
                                        "_and": [
                                            {
                                                "user_id": {
                                                    "_eq": "X-Hasura-User-Id"
                                                }
                                            },
                                            {
                                                "permission_name": {
                                                    "_eq": "user.user.read"
                                                }
                                            }
                                        ]
                                    }
                                }
                            },
                            {
                                "name": "USER_GROUP_TEACHER",
                                "filter": {
                                    "user_access_paths_location_permission": {
                                        "_and": [
                                            {
                                                "user_id": {
                                                    "_eq": "X-Hasura-User-Id"
                                                }
                                            },
                                            {
                                                "permission_name": {
                                                    "_eq": "user.user.read"
                                                }
                                            }
                                        ]
                                    }
                                }
                            }
                        ],
                        "insert_permission": [],
                        "delete_permission": [],
                        "update_permission": []
                    }
                },
                "postgres": {
                    "stage_dir": "migrations/invoicemgmt/1095_migrate.up.sql",
                    "policies": [
                        {
                            "name": "rls_user_access_paths_location",
                            "content": "DROP POLICY IF EXISTS rls_user_access_paths on \"user_access_paths\";\nCREATE POLICY rls_user_access_paths_location ON \"user_access_paths\" AS PERMISSIVE FOR ALL TO PUBLIC\nusing (\n\tlocation_id in (\n\t\tselect\t\t\t\n\t\t\tp.location_id\n\t\tfrom\n\t\t\t\t\t\tgranted_permissions p\n\t\twhere\n\t\t\tp.user_id = current_setting('app.user_id')\n\t\t\tand p.permission_id = (\n\t\t\t\tselect\n\t\t\t\t\tp2.permission_id\n\t\t\t\tfrom\n\t\t\t\t\t\"permission\" p2\n\t\t\t\twhere\n\t\t\t\t\tp2.permission_name = 'user.user.read'\n\t\t\t\t\tand p2.resource_path = current_setting('permission.resource_path'))\n\t\t)\n)\nwith check (\n\tlocation_id in (\n\t\tselect\t\t\t\n\t\t\tp.location_id\n\t\tfrom\n\t\t\t\t\t\tgranted_permissions p\n\t\twhere\n\t\t\tp.user_id = current_setting('app.user_id')\n\t\t\tand p.permission_id = (\n\t\t\t\tselect\n\t\t\t\t\tp2.permission_id\n\t\t\t\tfrom\n\t\t\t\t\t\"permission\" p2\n\t\t\t\twhere\n\t\t\t\t\tp2.permission_name = 'user.user.write'\n\t\t\t\t\tand p2.resource_path = current_setting('permission.resource_path'))\n\t\t)\n);"
                        }
                    ]
                },
                "accessPathTable": null,
                "locationCol": null,
                "permissionPrefix": "user.user",
                "permissions": {
                    "postgres": [],
                    "hasura": []
                },
                "ownerCol": null,
                "use_custom_policy": null,
                "hasura_policies": null,
                "postgres_policies": null,
                "use_custom_hasura_policy": null
            }
        ]
    },
    {
        "filename": "accesscontrol/invoicemgmt/users.users.yaml",
        "service": "invoicemgmt",
        "revision": 1,
        "table_name": "users",
        "created_at": "2022-12-21T16:36:53.784372879+08:00",
        "updated_at": "2022-12-21T16:36:53.78437295+08:00",
        "stages": [
            {
                "template": "1.1",
                "hasura": {
                    "stage_dir": "deployments/helm/manabie-all-in-one/charts/invoicemgmt/files/hasura/metadata/tables.yaml",
                    "permissions": [
                        "SELECT",
                        "INSERT",
                        "UPDATE",
                        "DELETE"
                    ],
                    "relationship": "users_location_permission",
                    "first_level_query": "user_access_paths",
                    "hasura_policies": {
                        "select_permission": [
                            {
                                "name": "USER_GROUP_SCHOOL_ADMIN",
                                "filter": {
                                    "user_access_paths": {
                                        "_and": [
                                            {
                                                "users_location_permission": {
                                                    "_and": [
                                                        {
                                                            "user_id": {
                                                                "_eq": "X-Hasura-User-Id"
                                                            }
                                                        },
                                                        {
                                                            "permission_name": {
                                                                "_eq": "user.user.read"
                                                            }
                                                        }
                                                    ]
                                                }
                                            },
                                            {
                                                "deleted_at": {
                                                    "_is_null": true
                                                }
                                            }
                                        ]
                                    }
                                }
                            },
                            {
                                "name": "USER_GROUP_ADMIN",
                                "filter": {
                                    "user_access_paths": {
                                        "_and": [
                                            {
                                                "users_location_permission": {
                                                    "_and": [
                                                        {
                                                            "user_id": {
                                                                "_eq": "X-Hasura-User-Id"
                                                            }
                                                        },
                                                        {
                                                            "permission_name": {
                                                                "_eq": "user.user.read"
                                                            }
                                                        }
                                                    ]
                                                }
                                            },
                                            {
                                                "deleted_at": {
                                                    "_is_null": true
                                                }
                                            }
                                        ]
                                    }
                                }
                            },
                            {
                                "name": "USER_GROUP_TEACHER",
                                "filter": {
                                    "user_access_paths": {
                                        "_and": [
                                            {
                                                "users_location_permission": {
                                                    "_and": [
                                                        {
                                                            "user_id": {
                                                                "_eq": "X-Hasura-User-Id"
                                                            }
                                                        },
                                                        {
                                                            "permission_name": {
                                                                "_eq": "user.user.read"
                                                            }
                                                        }
                                                    ]
                                                }
                                            },
                                            {
                                                "deleted_at": {
                                                    "_is_null": true
                                                }
                                            }
                                        ]
                                    }
                                }
                            }
                        ],
                        "insert_permission": [],
                        "delete_permission": [],
                        "update_permission": []
                    }
                },
                "postgres": {
                    "stage_dir": "migrations/invoicemgmt/1096_migrate.up.sql",
                    "policies": [
                        {
                            "name": "rls_users_select_location",
                            "content": "CREATE POLICY rls_users_select_location ON \"users\" AS PERMISSIVE FOR select TO PUBLIC\nusing (\ntrue \u003c= (\n\tselect\t\t\t\n\t\ttrue\n\tfrom\n\t\t\t\t\tgranted_permissions p\n\tjoin user_access_paths usp on\n\t\t\t\t\tusp.location_id = p.location_id\n\twhere\n\t\tp.user_id = current_setting('app.user_id')\n\t\tand p.permission_id = (\n\t\t\tselect\n\t\t\t\tp2.permission_id\n\t\t\tfrom\n\t\t\t\t\"permission\" p2\n\t\t\twhere\n\t\t\t\tp2.permission_name = 'user.user.read'\n\t\t\t\tand p2.resource_path = current_setting('permission.resource_path'))\n\t\tand usp.\"user_id\" = users.user_id\n\t\tand usp.deleted_at is null\n\tlimit 1\n\t)\n)\n;"
                        },
                        {
                            "name": "rls_users_update_location",
                            "content": "CREATE POLICY rls_users_update_location ON \"users\" AS PERMISSIVE FOR update TO PUBLIC\nusing (\ntrue \u003c= (\n\tselect\t\t\t\n\t\ttrue\n\tfrom\n\t\t\t\t\tgranted_permissions p\n\tjoin user_access_paths usp on\n\t\t\t\t\tusp.location_id = p.location_id\n\twhere\n\t\tp.user_id = current_setting('app.user_id')\n\t\tand p.permission_id = (\n\t\t\tselect\n\t\t\t\tp2.permission_id\n\t\t\tfrom\n\t\t\t\t\"permission\" p2\n\t\t\twhere\n\t\t\t\tp2.permission_name = 'user.user.write'\n\t\t\t\tand p2.resource_path = current_setting('permission.resource_path'))\n\t\tand usp.\"user_id\" = users.user_id\n\t\tand usp.deleted_at is null\n\tlimit 1\n\t)\n)with check (\ntrue \u003c= (\n\tselect\t\t\t\n\t\ttrue\n\tfrom\n\t\t\t\t\tgranted_permissions p\n\tjoin user_access_paths usp on\n\t\t\t\t\tusp.location_id = p.location_id\n\twhere\n\t\tp.user_id = current_setting('app.user_id')\n\t\tand p.permission_id = (\n\t\t\tselect\n\t\t\t\tp2.permission_id\n\t\t\tfrom\n\t\t\t\t\"permission\" p2\n\t\t\twhere\n\t\t\t\tp2.permission_name = 'user.user.write'\n\t\t\t\tand p2.resource_path = current_setting('permission.resource_path'))\n\t\tand usp.\"user_id\" = users.user_id\n\t\tand usp.deleted_at is null\n\tlimit 1\n\t)\n)\n;"
                        },
                        {
                            "name": "rls_users_delete_location",
                            "content": "CREATE POLICY rls_users_delete_location ON \"users\" AS PERMISSIVE FOR delete TO PUBLIC\nusing (\ntrue \u003c= (\n\tselect\t\t\t\n\t\ttrue\n\tfrom\n\t\t\t\t\tgranted_permissions p\n\tjoin user_access_paths usp on\n\t\t\t\t\tusp.location_id = p.location_id\n\twhere\n\t\tp.user_id = current_setting('app.user_id')\n\t\tand p.permission_id = (\n\t\t\tselect\n\t\t\t\tp2.permission_id\n\t\t\tfrom\n\t\t\t\t\"permission\" p2\n\t\t\twhere\n\t\t\t\tp2.permission_name = 'user.user.write'\n\t\t\t\tand p2.resource_path = current_setting('permission.resource_path'))\n\t\tand usp.\"user_id\" = users.user_id\n\t\tand usp.deleted_at is null\n\tlimit 1\n\t)\n)\n;"
                        },
                        {
                            "name": "rls_users_insert_location",
                            "content": "CREATE POLICY rls_users_insert_location ON \"users\" AS PERMISSIVE FOR INSERT TO PUBLIC\nwith check (\n\t1 = 1\n);\n"
                        }
                    ]
                },
                "accessPathTable": {
                    "name": "user_access_paths",
                    "columnMapping": {
                        "user_id": "user_id"
                    }
                },
                "locationCol": "location_id",
                "permissionPrefix": "user.user",
                "permissions": {
                    "postgres": [],
                    "hasura": []
                },
                "ownerCol": null,
                "use_custom_policy": null,
                "hasura_policies": null,
                "postgres_policies": null,
                "use_custom_hasura_policy": null
            },
            {
                "template": "4",
                "hasura": {
                    "stage_dir": "deployments/helm/manabie-all-in-one/charts/invoicemgmt/files/hasura/metadata/tables.yaml",
                    "permissions": [
                        "SELECT",
                        "INSERT",
                        "UPDATE",
                        "DELETE"
                    ],
                    "relationship": "users_location_permission",
                    "first_level_query": "user_id",
                    "hasura_policies": {
                        "select_permission": [
                            {
                                "name": "USER_GROUP_SCHOOL_ADMIN",
                                "filter": {
                                    "user_id": {
                                        "_eq": "X-Hasura-User-Id"
                                    }
                                }
                            },
                            {
                                "name": "USER_GROUP_ADMIN",
                                "filter": {
                                    "user_id": {
                                        "_eq": "X-Hasura-User-Id"
                                    }
                                }
                            },
                            {
                                "name": "USER_GROUP_TEACHER",
                                "filter": {
                                    "user_id": {
                                        "_eq": "X-Hasura-User-Id"
                                    }
                                }
                            }
                        ],
                        "insert_permission": [],
                        "delete_permission": [],
                        "update_permission": []
                    }
                },
                "postgres": {
                    "stage_dir": "migrations/invoicemgmt/1097_migrate.up.sql",
                    "policies": [
                        {
                            "name": "rls_users_permission_v4",
                            "content": "DROP POLICY IF EXISTS rls_users on \"users\";\nCREATE POLICY rls_users_permission_v4 ON \"users\" AS PERMISSIVE FOR ALL TO PUBLIC\nusing (\n\tcurrent_setting('app.user_id') = user_id\n)\nwith check (\n\tcurrent_setting('app.user_id') = user_id\n);"
                        }
                    ]
                },
                "accessPathTable": null,
                "locationCol": null,
                "permissionPrefix": null,
                "permissions": {
                    "postgres": [],
                    "hasura": []
                },
                "ownerCol": "user_id",
                "use_custom_policy": null,
                "hasura_policies": null,
                "postgres_policies": null,
                "use_custom_hasura_policy": null
            }
        ]
    }
]